# BettaFish å¾®èˆ†ç³»ç»Ÿ - é¡¹ç›®å®Œæ•´åˆ†æ

## ç›®å½•

- [ä¸€ã€ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ](#ä¸€ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ)
- [äºŒã€å®Œæ•´ä»£ç è°ƒç”¨é“¾åˆ†æ](#äºŒå®Œæ•´ä»£ç è°ƒç”¨é“¾åˆ†æ)
- [ä¸‰ã€AIä½¿ç”¨æƒ…å†µè¯¦ç»†åˆ†æ](#ä¸‰aiä½¿ç”¨æƒ…å†µè¯¦ç»†åˆ†æ)
- [å››ã€æ•°æ®æµè½¬ä¸çŠ¶æ€ç®¡ç†](#å››æ•°æ®æµè½¬ä¸çŠ¶æ€ç®¡ç†)
- [äº”ã€å…³é”®æŠ€æœ¯è¦ç‚¹](#äº”å…³é”®æŠ€æœ¯è¦ç‚¹)

---

## ä¸€ã€ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

### 1.1 æ•´ä½“æ¶æ„

BettaFishï¼ˆå¾®èˆ†ï¼‰æ˜¯ä¸€ä¸ªåŸºäºå¤šæ™ºèƒ½ä½“åä½œçš„èˆ†æƒ…åˆ†æç³»ç»Ÿï¼Œé‡‡ç”¨**åˆ†å±‚æ¶æ„ + å¹¶è¡Œå¤„ç† + å¾ªç¯åæ€**çš„è®¾è®¡æ¨¡å¼ã€‚

```
ç”¨æˆ·æŸ¥è¯¢
    â†“
Flaskä¸»åº”ç”¨ (app.py:5000)
    â†“
å¹¶è¡Œå¯åŠ¨ä¸‰ä¸ªAgent
    â”œâ”€â”€ QueryEngine (Streamlit:8503)    - å›½å†…å¤–æ–°é—»æœç´¢
    â”œâ”€â”€ MediaEngine (Streamlit:8502)    - å¤šæ¨¡æ€å†…å®¹åˆ†æ
    â””â”€â”€ InsightEngine (Streamlit:8501)  - ç§æœ‰æ•°æ®åº“æŒ–æ˜
         â†“ (æ—¥å¿—å†™å…¥)
    ForumEngine (åå°ç›‘æ§çº¿ç¨‹)         - è®ºå›åä½œå¼•æ“
         â†“ (ç”Ÿæˆforum.log)
    ReportEngine                        - æœ€ç»ˆæŠ¥å‘Šç”Ÿæˆ
         â†“
    HTMLç»¼åˆæŠ¥å‘Š
```

### 1.2 æ ¸å¿ƒç»„ä»¶è¯´æ˜

| ç»„ä»¶ | èŒè´£ | ç«¯å£/ä½ç½® | æ•°æ®æ¥æº |
|------|------|-----------|----------|
| Flaskä¸»åº”ç”¨ | ç»Ÿä¸€è°ƒåº¦ã€å‰ç«¯ç•Œé¢ã€WebSocketé€šä¿¡ | 5000 | - |
| QueryEngine | ç²¾å‡†æ–°é—»æœç´¢ï¼ˆTavily APIï¼‰ | 8503 | å›½å†…å¤–æ–°é—»ç½‘ç«™ |
| MediaEngine | å¤šæ¨¡æ€æœç´¢ï¼ˆBocha APIï¼‰ | 8502 | æœç´¢å¼•æ“ç»“æ„åŒ–æ•°æ® |
| InsightEngine | æ•°æ®åº“æ·±åº¦æŒ–æ˜ | 8501 | MySQLç§æœ‰èˆ†æƒ…æ•°æ®åº“ |
| ForumEngine | ç›‘æ§Agentå‘è¨€ã€ç”Ÿæˆä¸»æŒäººæ€»ç»“ | åå°çº¿ç¨‹ | ä¸‰ä¸ªAgentçš„æ—¥å¿—æ–‡ä»¶ |
| ReportEngine | æ•´åˆæ‰€æœ‰åˆ†æç»“æœã€ç”ŸæˆHTMLæŠ¥å‘Š | Blueprint | å„AgentæŠ¥å‘Š+è®ºå›æ—¥å¿— |

---

## äºŒã€å®Œæ•´ä»£ç è°ƒç”¨é“¾åˆ†æ

### 2.1 ä¸»åº”ç”¨å¯åŠ¨æµç¨‹

#### æµç¨‹å›¾

```
app.pyå¯åŠ¨
    â”œâ”€ 1. å¯¼å…¥é…ç½® (config.py)
    â”‚   â””â”€ åŠ è½½.envæ–‡ä»¶é…ç½®ï¼ˆPydantic Settingsï¼‰
    â”‚
    â”œâ”€ 2. åˆå§‹åŒ–Flaskåº”ç”¨
    â”‚   â”œâ”€ åˆ›å»ºSocketIOå®ä¾‹ (WebSocketé€šä¿¡)
    â”‚   â”œâ”€ æ³¨å†ŒReportEngine Blueprint (/api/report)
    â”‚   â””â”€ åˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿ (logs/)
    â”‚
    â”œâ”€ 3. å‰ç«¯è§¦å‘ç³»ç»Ÿå¯åŠ¨ (POST /api/system/start)
    â”‚   â””â”€ initialize_system_components()
    â”‚       â”œâ”€ åœæ­¢æ—§çš„ForumEngine
    â”‚       â”œâ”€ å¹¶è¡Œå¯åŠ¨ä¸‰ä¸ªStreamlitåº”ç”¨
    â”‚       â”‚   â”œâ”€ start_streamlit_app('insight', 8501)
    â”‚       â”‚   â”œâ”€ start_streamlit_app('media', 8502)
    â”‚       â”‚   â””â”€ start_streamlit_app('query', 8503)
    â”‚       â”‚       â””â”€ subprocess.Popen(['streamlit', 'run', ...])
    â”‚       â”‚           â””â”€ å¯åŠ¨è¾“å‡ºç›‘æ§çº¿ç¨‹ read_process_output()
    â”‚       â”‚               â””â”€ å®æ—¶æ•è·stdout â†’ å†™å…¥logs/{app_name}.log
    â”‚       â”‚                   â””â”€ SocketIOæ¨é€ â†’ å‰ç«¯æ§åˆ¶å°
    â”‚       â”œâ”€ å¯åŠ¨ForumEngineç›‘æ§
    â”‚       â”‚   â””â”€ start_forum_engine()
    â”‚       â”‚       â””â”€ ForumEngine.monitor.start_forum_monitoring()
    â”‚       â”‚           â””â”€ å¯åŠ¨åå°ç›‘æ§çº¿ç¨‹ monitor_logs()
    â”‚       â””â”€ åˆå§‹åŒ–ReportEngine
    â”‚           â””â”€ initialize_report_engine()
    â”‚               â””â”€ åˆ›å»ºReportAgentå®ä¾‹ï¼ˆå¾…å‘½çŠ¶æ€ï¼‰
    â”‚
    â””â”€ 4. ç­‰å¾…ç”¨æˆ·æŸ¥è¯¢ (POST /api/search)
        â””â”€ åˆ†å‘æŸ¥è¯¢åˆ°ä¸‰ä¸ªStreamlitåº”ç”¨çš„APIç«¯ç‚¹
            â”œâ”€ POST http://localhost:8601/api/search (Insight)
            â”œâ”€ POST http://localhost:8602/api/search (Media)
            â””â”€ POST http://localhost:8603/api/search (Query)
```

#### å…³é”®ä»£ç è°ƒç”¨

**å¯åŠ¨Streamlitåº”ç”¨**
```python
# app.py:562-633
def start_streamlit_app(app_name, script_path, port):
    cmd = [sys.executable, '-m', 'streamlit', 'run', 
           script_path, '--server.port', str(port), ...]
    process = subprocess.Popen(cmd, stdout=subprocess.PIPE, ...)
    
    # å¯åŠ¨è¾“å‡ºç›‘æ§çº¿ç¨‹
    threading.Thread(target=read_process_output, 
                    args=(process, app_name), daemon=True).start()
```

**æ—¥å¿—ç›‘æ§ä¸æ¨é€**
```python
# app.py:492-560
def read_process_output(process, app_name):
    while True:
        output = process.stdout.readline()
        formatted_line = f"[{timestamp}] {line}"
        write_log_to_file(app_name, formatted_line)
        socketio.emit('console_output', {'app': app_name, 'line': formatted_line})
```

---

### 2.2 ä¸‰ä¸ªAgentçš„å·¥ä½œæµç¨‹ï¼ˆä»¥QueryEngineä¸ºä¾‹ï¼‰

æ‰€æœ‰ä¸‰ä¸ªAgentï¼ˆQuery/Media/Insightï¼‰éƒ½ç»§æ‰¿ç›¸åŒçš„å·¥ä½œæµç¨‹æ¨¡å¼ï¼Œåªæ˜¯ä½¿ç”¨çš„å·¥å…·å’Œæ•°æ®æºä¸åŒã€‚

#### 2.2.1 Agentæ ¸å¿ƒå·¥ä½œæµç¨‹

```
DeepSearchAgent.research(query)
    â†“
[æ­¥éª¤1] _generate_report_structure(query)
    â”œâ”€ ReportStructureNode.mutate_state()
    â”‚   â””â”€ LLMè°ƒç”¨: åˆ†ææŸ¥è¯¢ â†’ ç”ŸæˆæŠ¥å‘Šå¤§çº²
    â”‚       è¾“å…¥: ç”¨æˆ·æŸ¥è¯¢
    â”‚       è¾“å‡º: {"report_title": "...", "paragraphs": [...]}
    â”‚       ä½œç”¨: å°†å¤æ‚æŸ¥è¯¢åˆ†è§£ä¸ºå¤šä¸ªå¯ç ”ç©¶çš„æ®µè½
    â””â”€ æ›´æ–°State.paragraphs (ä¾‹å¦‚: 3-6ä¸ªæ®µè½)
    â†“
[æ­¥éª¤2] _process_paragraphs() - é€æ®µå¤„ç†
    å¯¹æ¯ä¸ªparagraphæ‰§è¡Œ:
    â”œâ”€ 2.1 _initial_search_and_summary(paragraph_index)
    â”‚   â”œâ”€ FirstSearchNode.run({"title": ..., "content": ...})
    â”‚   â”‚   â””â”€ LLMè°ƒç”¨: ç”Ÿæˆæœç´¢æŸ¥è¯¢å’Œå·¥å…·é€‰æ‹©
    â”‚   â”‚       è¾“å…¥: æ®µè½æ ‡é¢˜+å†…å®¹
    â”‚   â”‚       è¾“å‡º: {"search_query": "...", "search_tool": "...", "reasoning": "..."}
    â”‚   â”‚       ä½œç”¨: å°†ç ”ç©¶éœ€æ±‚è½¬åŒ–ä¸ºå…·ä½“çš„æœç´¢æŒ‡ä»¤
    â”‚   â”‚
    â”‚   â”œâ”€ execute_search_tool(search_tool, search_query)
    â”‚   â”‚   â””â”€ è°ƒç”¨å¤–éƒ¨APIï¼ˆTavily/Bocha/Databaseï¼‰
    â”‚   â”‚       è¿”å›: æœç´¢ç»“æœåˆ—è¡¨
    â”‚   â”‚
    â”‚   â””â”€ FirstSummaryNode.mutate_state(...)
    â”‚       â””â”€ LLMè°ƒç”¨: åŸºäºæœç´¢ç»“æœç”Ÿæˆåˆæ­¥æ€»ç»“
    â”‚           è¾“å…¥: æ®µè½è¦æ±‚ + æœç´¢ç»“æœï¼ˆæ ¼å¼åŒ–åï¼‰
    â”‚           è¾“å‡º: {"paragraph_latest_state": "åˆæ­¥æ€»ç»“å†…å®¹"}
    â”‚           ä½œç”¨: æå–å…³é”®ä¿¡æ¯ã€ç»„ç»‡æˆè¿è´¯æ®µè½
    â”‚
    â””â”€ 2.2 _reflection_loop(paragraph_index) - å¤šè½®åæ€
        å¾ªç¯MAX_REFLECTIONSæ¬¡ (é»˜è®¤3æ¬¡):
        â”œâ”€ ReflectionNode.run({"paragraph_latest_state": ...})
        â”‚   â””â”€ LLMè°ƒç”¨: åæ€å½“å‰æ€»ç»“ï¼Œå‘ç°ä¿¡æ¯ç¼ºå£
        â”‚       è¾“å…¥: å½“å‰æ®µè½æ€»ç»“
        â”‚       è¾“å‡º: {"search_query": "è¡¥å……æŸ¥è¯¢", "search_tool": "...", "reasoning": "..."}
        â”‚       ä½œç”¨: å‘ç°çŸ¥è¯†ç›²ç‚¹ã€æå‡ºè¡¥å……æœç´¢æ–¹å‘
        â”‚
        â”œâ”€ execute_search_tool(...) - æ‰§è¡Œè¡¥å……æœç´¢
        â”‚
        â””â”€ ReflectionSummaryNode.mutate_state(...)
            â””â”€ LLMè°ƒç”¨: èåˆæ–°ä¿¡æ¯ï¼Œæ›´æ–°æ€»ç»“
                è¾“å…¥: æ—§æ€»ç»“ + æ–°æœç´¢ç»“æœ
                è¾“å‡º: {"updated_paragraph_latest_state": "æ›´æ–°åçš„æ€»ç»“"}
                ä½œç”¨: å¢é‡æ›´æ–°ã€é¿å…ä¿¡æ¯ä¸¢å¤±
    â†“
[æ­¥éª¤3] _generate_final_report()
    â””â”€ ReportFormattingNode.run(report_data)
        â””â”€ LLMè°ƒç”¨: æ ¼å¼åŒ–å¹¶æ¶¦è‰²æœ€ç»ˆæŠ¥å‘Š
            è¾“å…¥: æ‰€æœ‰æ®µè½çš„æœ€ç»ˆæ€»ç»“
            è¾“å‡º: Markdownæ ¼å¼çš„å®Œæ•´æŠ¥å‘Š
            ä½œç”¨: ç»Ÿä¸€é£æ ¼ã€æ·»åŠ è¿‡æ¸¡ã€ä¼˜åŒ–å¯è¯»æ€§
    â†“
[æ­¥éª¤4] _save_report(final_report)
    â””â”€ ä¿å­˜åˆ° {engine}_streamlit_reports/*.md
```

#### 2.2.2 å·¥å…·é€‰æ‹©çš„å·®å¼‚åŒ–

**QueryEngine** (æŸ¥è¯¢å›½å†…å¤–æ–°é—»)
```python
# QueryEngine/agent.py:100-139
tools = {
    "basic_search_news": TavilyNewsAgency.basic_search_news,
    "deep_search_news": TavilyNewsAgency.deep_search_news,
    "search_news_last_24_hours": TavilyNewsAgency.search_news_last_24_hours,
    "search_news_last_week": TavilyNewsAgency.search_news_last_week,
    "search_images_for_news": TavilyNewsAgency.search_images_for_news,
    "search_news_by_date": TavilyNewsAgency.search_news_by_date
}
```

**MediaEngine** (å¤šæ¨¡æ€å†…å®¹æœç´¢)
```python
# MediaEngine/agent.py:98-131
tools = {
    "comprehensive_search": BochaMultimodalSearch.comprehensive_search,
    "web_search_only": BochaMultimodalSearch.web_search_only,
    "search_for_structured_data": BochaMultimodalSearch.search_for_structured_data,
    "search_last_24_hours": BochaMultimodalSearch.search_last_24_hours,
    "search_last_week": BochaMultimodalSearch.search_last_week
}
```

**InsightEngine** (æ•°æ®åº“æ·±åº¦æŒ–æ˜)
```python
# InsightEngine/agent.py:105-248
tools = {
    "search_hot_content": MediaCrawlerDB.search_hot_content,
    "search_topic_globally": MediaCrawlerDB.search_topic_globally,
    "search_topic_by_date": MediaCrawlerDB.search_topic_by_date,
    "get_comments_for_topic": MediaCrawlerDB.get_comments_for_topic,
    "search_topic_on_platform": MediaCrawlerDB.search_topic_on_platform
}
# é›†æˆä¸­é—´ä»¶
â”œâ”€ keyword_optimizer: å…³é”®è¯ä¼˜åŒ–ï¼ˆä½¿ç”¨Qwenå°å‚æ•°æ¨¡å‹ï¼‰
â””â”€ sentiment_analyzer: æƒ…æ„Ÿåˆ†æï¼ˆå¤šè¯­è¨€BERTæ¨¡å‹ï¼‰
```

#### 2.2.3 å·¥å…·é›†çš„å®ç°ç»†èŠ‚ä¸æ•°æ®æº

**Q1: MediaEngineçš„å¤šæ¨¡æ€æ•°æ®é¢„å¤„ç†**

**å…³é”®å‘ç°**ï¼šMediaEngine **æ²¡æœ‰æœ¬åœ°é¢„å¤„ç†**ï¼Œå®Œå…¨ä¾èµ–Bocha AI Search APIçš„äº‘ç«¯å¤„ç†ã€‚

æ•°æ®æµç¨‹ï¼š
```
ç”¨æˆ·æŸ¥è¯¢ â†’ LLMç”Ÿæˆæœç´¢query â†’ Bocha APIè°ƒç”¨ â†’ äº‘ç«¯å¤„ç†ï¼ˆå¤šæ¨¡æ€ç†è§£ï¼‰
    â†“
è¿”å›ç»“æ„åŒ–æ•°æ®:
â”œâ”€ webpages: ç½‘é¡µæœç´¢ç»“æœï¼ˆæ ‡é¢˜ã€URLã€æ‘˜è¦ï¼‰
â”œâ”€ images: å›¾ç‰‡ç»“æœï¼ˆå«ç¼©ç•¥å›¾ã€å°ºå¯¸ã€æ¥æºï¼‰
â”œâ”€ modal_cards: ç»“æ„åŒ–æ•°æ®å¡ç‰‡ï¼ˆå¤©æ°”ã€è‚¡ç¥¨ã€ç™¾ç§‘ã€åŒ»ç–—ç­‰ï¼‰
â””â”€ answer: AIç”Ÿæˆçš„æ€»ç»“ç­”æ¡ˆ
    â†“
Agentç«¯å¤„ç†ï¼ˆä»…æ ¼å¼è½¬æ¢ï¼‰:
â””â”€ Dict â†’ Dataclass (BochaResponse, WebpageResult, ImageResult, ModalCardResult)
    â†“
LLMåˆ†æå’Œæ€»ç»“
```

**é‡è¦ç‰¹æ€§**ï¼š
- **Modal Cardsï¼ˆæ¨¡æ€å¡ï¼‰**ï¼šBochaçš„æ ¸å¿ƒç‰¹è‰²ï¼Œèƒ½ç›´æ¥è¿”å›ç»“æ„åŒ–ä¿¡æ¯
  - ç¤ºä¾‹ï¼šæœç´¢"ä¸œæ–¹è´¢å¯Œè‚¡ç¥¨"å¯èƒ½è¿”å›stockç±»å‹çš„modal_cardï¼ŒåŒ…å«å®æ—¶ä»·æ ¼ã€æ¶¨è·Œå¹…ç­‰
  - æ”¯æŒç±»å‹ï¼šweather_china, stock, baike_pro, medical_commonç­‰
- **æ— éœ€æœ¬åœ°é¢„å¤„ç†**ï¼šå›¾åƒè¯†åˆ«ã€å®ä½“æå–ã€ç»“æ„åŒ–è§£æéƒ½ç”±Bocha APIå®Œæˆ
- **Agentåªåšé€‚é…**ï¼šå°†APIè¿”å›çš„JSONè½¬ä¸ºPythonå¯¹è±¡ï¼Œä¾¿äºåç»­ä½¿ç”¨

**é‡‘èåœºæ™¯çš„å¯ç¤º**ï¼š
- å¯ä»¥åˆ©ç”¨Bochaçš„stock modal_cardè·å–è‚¡ç¥¨åŸºç¡€ä¿¡æ¯
- ä½†**ä¸èƒ½ä¾èµ–**Modal Cardsï¼Œå› ä¸ºï¼š
  1. è¦†ç›–é¢æœ‰é™ï¼ˆå¯èƒ½åªæœ‰å¤§ç›˜è‚¡ï¼‰
  2. æ•°æ®æ·±åº¦ä¸å¤Ÿï¼ˆç¼ºä¹æŠ€æœ¯æŒ‡æ ‡ã€èµ„é‡‘æµå‘ï¼‰
  3. æ›´æ–°é¢‘ç‡ä¸ç¡®å®š
- **å»ºè®®**ï¼šä¿ç•™MediaEngineç”¨äºå¸‚åœºæ–°é—»å’Œèˆ†æƒ…ç›‘æ§ï¼Œæ•°æ®åˆ†æäº¤ç»™æ–°çš„MarketEngine

---

**Q2: QueryEngineçš„ç‰¹å®šç½‘ç«™çˆ¬å–èƒ½åŠ›**

**å…³é”®å‘ç°**ï¼šQueryEngine **ä¸æ˜¯çˆ¬è™«**ï¼Œè€Œæ˜¯ä½¿ç”¨**Tavily Search API**ï¼ˆç±»ä¼¼Google Search for Newsï¼‰ã€‚

æ¶æ„åˆ†æï¼š
```
QueryEngineå·¥å…·é›†:
â”œâ”€ basic_search_news: å¿«é€Ÿæ–°é—»æœç´¢ï¼Œè¿”å›7æ¡ç»“æœ
â”œâ”€ deep_search_news: æ·±åº¦æœç´¢ï¼Œè¿”å›20æ¡+AIç”Ÿæˆçš„æ‘˜è¦ç­”æ¡ˆ
â”œâ”€ search_news_last_24_hours: 24å°æ—¶å†…çš„æ–°é—»
â”œâ”€ search_news_last_week: è¿‡å»ä¸€å‘¨çš„æ–°é—»
â”œâ”€ search_images_for_news: æœç´¢æ–°é—»ç›¸å…³å›¾ç‰‡
â””â”€ search_news_by_date: æŒ‡å®šæ—¥æœŸèŒƒå›´æœç´¢ï¼ˆéœ€æä¾›start_dateå’Œend_dateï¼‰

æ•°æ®æ¥æº:
â””â”€ Tavily API â†’ çˆ¬å–å…¨çƒæ–°é—»ç½‘ç«™ â†’ è¿”å›æ ‡é¢˜ã€å†…å®¹ã€URLã€å‘å¸ƒæ—¥æœŸ
```

**ä¸æ”¯æŒçš„åŠŸèƒ½**ï¼š
- âŒ å®šåˆ¶åŒ–çˆ¬å–ç‰¹å®šç½‘ç«™ï¼ˆå¦‚åªçˆ¬æ–°æµªè´¢ç»ï¼‰
- âŒ ç»“æ„åŒ–æ•°æ®æå–ï¼ˆå¦‚ä»è¡¨æ ¼ä¸­æå–è´¢åŠ¡æ•°æ®ï¼‰
- âŒ éœ€è¦ç™»å½•çš„å†…å®¹ï¼ˆå¦‚ä»˜è´¹ç ”æŠ¥ï¼‰

**å¯ä»¥å®ç°çš„å˜é€šæ–¹æ¡ˆ**ï¼š
- âœ… æœç´¢æ—¶æŒ‡å®šç½‘ç«™ï¼šå¦‚`query="è´µå·èŒ…å° site:finance.sina.com.cn"`
- âœ… é€šè¿‡æ—¶é—´ç­›é€‰ï¼š`search_news_by_date()`å·¥å…·
- âœ… æ·±åº¦æœç´¢ï¼š`deep_search_news()`è¿”å›æ›´å¤šç»“æœ

**é‡‘èåœºæ™¯çš„æ”¹é€ æ–¹æ¡ˆ**ï¼š
```
MessageEngineå·¥å…·é›† (æ”¹é€ å):
â”œâ”€ ä¿ç•™: TavilyNewsAgency â†’ ç”¨äºæœç´¢è´¢ç»æ–°é—»ã€æ”¿ç­–æ–°é—»
â”œâ”€ æ–°å¢: AnnouncementParser â†’ çˆ¬å–äº¤æ˜“æ‰€å…¬å‘Š
â”‚   â”œâ”€ æ·±äº¤æ‰€: http://www.szse.cn/api/disc/announcement/annList
â”‚   â”œâ”€ ä¸Šäº¤æ‰€: http://query.sse.com.cn/security/stock/getStockAnnouncementList
â”‚   â””â”€ è§£æPDFè´¢æŠ¥ï¼Œæå–å…³é”®è´¢åŠ¡æŒ‡æ ‡
â”œâ”€ æ–°å¢: ResearchReportCrawler â†’ çˆ¬å–åˆ¸å•†ç ”æŠ¥ï¼ˆéœ€è¦æ•°æ®æºï¼‰
â””â”€ æ–°å¢: EventDrivenAnalyzer â†’ åˆ†æå†å²ç›¸ä¼¼äº‹ä»¶çš„è‚¡ä»·è¡¨ç°
```

---

**Q3: InsightEngineçš„MySQLæ•°æ®æ¥æº - MindSpiderç³»ç»Ÿ**

**å…³é”®å‘ç°**ï¼šæ•°æ®æ¥è‡ªé¡¹ç›®å†…ç½®çš„**MindSpiderèˆ†æƒ…çˆ¬è™«ç³»ç»Ÿ**ï¼ˆä½äº`MindSpider/`ç›®å½•ï¼‰ã€‚

**MindSpiderå®Œæ•´æ¶æ„**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         MindSpider èˆ†æƒ…çˆ¬è™«ç³»ç»Ÿ              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  ã€æ¨¡å—ä¸€ã€‘BroadTopicExtraction (è¯é¢˜æå–)   â”‚
â”‚  â”œâ”€ é‡‡é›†13ä¸ªå¹³å°çš„çƒ­ç‚¹æ–°é—»                    â”‚
â”‚  â”‚   â”œâ”€ å¾®åšçƒ­æœã€çŸ¥ä¹çƒ­æ¦œã€Bç«™çƒ­é—¨            â”‚
â”‚  â”‚   â”œâ”€ ä»Šæ—¥å¤´æ¡ã€GitHub Trending            â”‚
â”‚  â”‚   â””â”€ è±†ç“£ã€è™æ‰‘ã€é…·å®‰ç­‰                     â”‚
â”‚  â”œâ”€ ä½¿ç”¨DeepSeek APIåˆ†ææ–°é—»                â”‚
â”‚  â”œâ”€ AIæå–çƒ­ç‚¹è¯é¢˜å’Œå…³é”®è¯                   â”‚
â”‚  â””â”€ å­˜å‚¨åˆ°MySQL                             â”‚
â”‚      â”œâ”€ daily_news (æ¯æ—¥æ–°é—»è¡¨)              â”‚
â”‚      â”œâ”€ daily_topics (è¯é¢˜è¡¨)                â”‚
â”‚      â””â”€ topic_news_relation (å…³è”è¡¨)         â”‚
â”‚                                             â”‚
â”‚  ã€æ¨¡å—äºŒã€‘DeepSentimentCrawling (æ·±åº¦çˆ¬å–)  â”‚
â”‚  â”œâ”€ è¯»å–å…³é”®è¯                               â”‚
â”‚  â”œâ”€ ä½¿ç”¨Playwrightåœ¨7å¤§å¹³å°çˆ¬å–              â”‚
â”‚  â”‚   â”œâ”€ å°çº¢ä¹¦ (xhs)                         â”‚
â”‚  â”‚   â”œâ”€ æŠ–éŸ³ (douyin)                       â”‚
â”‚  â”‚   â”œâ”€ å¿«æ‰‹ (kuaishou)                     â”‚
â”‚  â”‚   â”œâ”€ Bç«™ (bilibili)                      â”‚
â”‚  â”‚   â”œâ”€ å¾®åš (weibo)                        â”‚
â”‚  â”‚   â”œâ”€ è´´å§ (tieba)                        â”‚
â”‚  â”‚   â””â”€ çŸ¥ä¹ (zhihu)                        â”‚
â”‚  â”œâ”€ çˆ¬å–å†…å®¹å’Œè¯„è®º                           â”‚
â”‚  â”œâ”€ æƒ…æ„Ÿåˆ†æï¼ˆå¯é€‰ï¼‰                         â”‚
â”‚  â””â”€ å­˜å‚¨åˆ°MySQL                             â”‚
â”‚      â”œâ”€ xhs_note, xhs_note_comment          â”‚
â”‚      â”œâ”€ douyin_aweme, douyin_aweme_comment  â”‚
â”‚      â”œâ”€ bilibili_video, bili_video_comment  â”‚
â”‚      â”œâ”€ weibo_note, weibo_note_comment      â”‚
â”‚      â””â”€ ...ï¼ˆå„å¹³å°å†…å®¹å’Œè¯„è®ºè¡¨ï¼‰             â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ InsightEngineè¯»å–æ•°æ®
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      InsightEngine/tools/search.py          â”‚
â”‚      (MediaCrawlerDBæŸ¥è¯¢å·¥å…·é›†)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”œâ”€ search_hot_content: æŸ¥æ‰¾çƒ­ç‚¹å†…å®¹         â”‚
â”‚  â”‚   â””â”€ æŒ‰ç»¼åˆçƒ­åº¦æ’åºï¼ˆç‚¹èµ+è¯„è®º+åˆ†äº«+è§‚çœ‹ï¼‰  â”‚
â”‚  â”œâ”€ search_topic_globally: å…¨å±€è¯é¢˜æœç´¢      â”‚
â”‚  â”‚   â””â”€ åœ¨æ‰€æœ‰å¹³å°è¡¨ä¸­æœç´¢å…³é”®è¯              â”‚
â”‚  â”œâ”€ search_topic_by_date: æŒ‰æ—¥æœŸæœç´¢         â”‚
â”‚  â”œâ”€ get_comments_for_topic: è·å–è¯„è®º         â”‚
â”‚  â””â”€ search_topic_on_platform: å¹³å°ç²¾æœ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ•°æ®åº“Schemaå…³é”®è¡¨**ï¼š
```sql
-- è¯é¢˜å’Œæ–°é—»ç®¡ç†
daily_news           -- æ¯æ—¥é‡‡é›†çš„çƒ­ç‚¹æ–°é—»
daily_topics         -- AIæå–çš„è¯é¢˜å’Œå…³é”®è¯
topic_news_relation  -- è¯é¢˜ä¸æ–°é—»çš„å…³è”
crawling_tasks       -- çˆ¬å–ä»»åŠ¡ç®¡ç†

-- å„å¹³å°å†…å®¹è¡¨ï¼ˆ7ä¸ªå¹³å°ï¼‰
xhs_note             -- å°çº¢ä¹¦ç¬”è®°
douyin_aweme         -- æŠ–éŸ³è§†é¢‘
kuaishou_video       -- å¿«æ‰‹è§†é¢‘
bilibili_video       -- Bç«™è§†é¢‘
weibo_note           -- å¾®åšå¸–å­
tieba_note           -- è´´å§å¸–å­
zhihu_content        -- çŸ¥ä¹å†…å®¹

-- å„å¹³å°è¯„è®ºè¡¨
xhs_note_comment
douyin_aweme_comment
bilibili_video_comment
weibo_note_comment
...
```

**å·¥ä½œæµç¨‹**ï¼š
1. **æ¯æ—¥å®šæ—¶ä»»åŠ¡**ï¼šè¿è¡Œ`python main.py --complete`
2. **è¯é¢˜æå–**ï¼šä»13ä¸ªå¹³å°é‡‡é›†çƒ­ç‚¹ â†’ AIåˆ†æ â†’ ç”Ÿæˆå…³é”®è¯
3. **æ·±åº¦çˆ¬å–**ï¼šåŸºäºå…³é”®è¯åœ¨7ä¸ªå¹³å°çˆ¬å–å†…å®¹å’Œè¯„è®º
4. **æ•°æ®å­˜å‚¨**ï¼šæ‰€æœ‰æ•°æ®å­˜å…¥MySQL
5. **InsightEngineä½¿ç”¨**ï¼šæŸ¥è¯¢æ•°æ®åº“è¿›è¡Œèˆ†æƒ…åˆ†æ

#### MindSpiderçš„æ•°æ®å¤„ç†æµç¨‹

**æ¨¡å—ä¸€ï¼šBroadTopicExtractionï¼ˆè¯é¢˜æå–ï¼‰çš„æ•°æ®å¤„ç†**

```
æ­¥éª¤1: æ”¶é›†æ–°é—»
â””â”€ NewsCollector.collect_and_save_news()
   â”œâ”€ ä»13ä¸ªå¹³å°çš„çƒ­æ¦œAPIè·å–æ–°é—»æ ‡é¢˜
   â”œâ”€ æ•°æ®ç»“æ„: {"title": "...", "source_platform": "å¾®åš", "url": "...", "rank": 1}
   â””â”€ ä¿å­˜åˆ°æ•°æ®åº“: daily_newsè¡¨

æ­¥éª¤2: AIæå–å…³é”®è¯å’Œç”Ÿæˆæ€»ç»“
â””â”€ TopicExtractor.extract_keywords_and_summary(news_list)
   â”œâ”€ æ„å»ºæ–°é—»æ‘˜è¦æ–‡æœ¬ï¼ˆæ‰€æœ‰æ ‡é¢˜æ‹¼æ¥ï¼‰
   â”œâ”€ è°ƒç”¨DeepSeek API
   â”‚   â”œâ”€ System Prompt: "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ–°é—»åˆ†æå¸ˆ"
   â”‚   â”œâ”€ User Prompt: åŒ…å«æ‰€æœ‰æ–°é—»æ ‡é¢˜ + æå–ä»»åŠ¡è¯´æ˜
   â”‚   â”œâ”€ è¦æ±‚è¾“å‡ºJSON: {"keywords": [...], "summary": "..."}
   â”‚   â””â”€ å‚æ•°: max_tokens=1500, temperature=0.3
   â”œâ”€ è§£æè¿”å›çš„JSON
   â”‚   â”œâ”€ æå–å…³é”®è¯åˆ—è¡¨ï¼ˆå»é‡ã€æ¸…ç†ï¼‰
   â”‚   â””â”€ æå–æ–°é—»åˆ†ææ€»ç»“ï¼ˆ150-300å­—ï¼‰
   â””â”€ å¦‚æœAPIè°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨fallbackæ–¹æ¡ˆ
       â””â”€ _extract_simple_keywords(): ç®€å•æ­£åˆ™åˆ†è¯

æ­¥éª¤3: ä¿å­˜åˆ°æ•°æ®åº“
â””â”€ DatabaseManager.save_daily_topics(keywords, summary, date)
   â”œâ”€ æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ä»Šæ—¥è®°å½•
   â”œâ”€ å°†å…³é”®è¯åˆ—è¡¨è½¬ä¸ºJSONå­—ç¬¦ä¸²
   â””â”€ INSERT INTO daily_topics (extract_date, keywords, summary, created_at)

æ­¥éª¤4: ç”Ÿæˆçˆ¬å–å…³é”®è¯
â””â”€ TopicExtractor.get_search_keywords(keywords, limit=10)
   â”œâ”€ è¿‡æ»¤æ¡ä»¶:
   â”‚   â”œâ”€ é•¿åº¦: 1 < len(keyword) < 20
   â”‚   â”œâ”€ ä¸æ˜¯çº¯æ•°å­—
   â”‚   â””â”€ ä¸æ˜¯çº¯è‹±æ–‡ï¼ˆé™¤éæ˜¯ä¸“æœ‰åè¯ï¼‰
   â””â”€ è¿”å›: é€‚åˆæœç´¢çš„å…³é”®è¯åˆ—è¡¨ï¼ˆé™åˆ¶10ä¸ªï¼‰
```

**å¤„ç†ç¤ºä¾‹**:
```python
# è¾“å…¥: 100æ¡çƒ­ç‚¹æ–°é—»
news_list = [
    {"title": "AIæŠ€æœ¯å–å¾—é‡å¤§çªç ´", "source_platform": "çŸ¥ä¹"},
    {"title": "è‚¡å¸‚ä»Šæ—¥å¤§æ¶¨", "source_platform": "æ–°æµªè´¢ç»"},
    ...
]

# AIåˆ†æè¾“å‡º:
{
    "keywords": [
        "AIæŠ€æœ¯", "è‚¡å¸‚", "å¤§æ¨¡å‹", "æŠ•èµ„", "åˆ›ä¸š", 
        "æ•™è‚²æ”¹é©", "æ–°èƒ½æºæ±½è½¦", "åŒ»ç–—å¥åº·", ...
    ],
    "summary": "ä»Šæ—¥çƒ­ç‚¹ä¸»è¦é›†ä¸­åœ¨ç§‘æŠ€åˆ›æ–°ã€é‡‘èå¸‚åœºå’Œç¤¾ä¼šæ°‘ç”Ÿé¢†åŸŸã€‚
    AIæŠ€æœ¯çš„çªç ´æ€§è¿›å±•å¼•å‘å¹¿æ³›å…³æ³¨ï¼Œæ˜¾ç¤ºå‡ºæˆ‘å›½åœ¨äººå·¥æ™ºèƒ½é¢†åŸŸçš„æŒç»­å‘å±•åŠ¿å¤´ã€‚
    è‚¡å¸‚çš„æ³¢åŠ¨åæ˜ äº†æŠ•èµ„è€…å¯¹ç»æµå‰æ™¯çš„å¤šå…ƒåˆ¤æ–­..."
}

# å­˜å‚¨ç»“æ„:
daily_topicsè¡¨:
| id | extract_date | keywords (JSON) | summary | created_at |
|----|-------------|-----------------|---------|------------|
| 1  | 2024-11-06  | ["AIæŠ€æœ¯","è‚¡å¸‚",...] | ä»Šæ—¥çƒ­ç‚¹ä¸»è¦... | 2024-11-06 10:00:00 |
```

---

**æ¨¡å—äºŒï¼šDeepSentimentCrawlingï¼ˆæ·±åº¦çˆ¬å–ï¼‰çš„æ•°æ®å¤„ç†**

```
æ­¥éª¤1: è·å–å…³é”®è¯
â””â”€ KeywordManager.get_latest_keywords(date, max_keywords)
   â”œâ”€ ä»daily_topicsè¡¨è¯»å–ä»Šæ—¥å…³é”®è¯
   â”œâ”€ å¦‚æœä»Šæ—¥æ²¡æœ‰ï¼Œè·å–æœ€è¿‘7å¤©çš„å…³é”®è¯
   â”œâ”€ å»é‡å¹¶éšæœºé€‰æ‹©max_keywordsä¸ª
   â””â”€ å¦‚æœéƒ½æ²¡æœ‰ï¼Œè¿”å›é»˜è®¤å…³é”®è¯

æ­¥éª¤2: é…ç½®çˆ¬è™«
â””â”€ PlatformCrawler.create_base_config(platform, keywords, max_notes)
   â”œâ”€ ä¿®æ”¹MediaCrawler/config/base_config.py
   â”‚   â”œâ”€ PLATFORM = "xhs"
   â”‚   â”œâ”€ KEYWORDS = "AIæŠ€æœ¯,è‚¡å¸‚,å¤§æ¨¡å‹,..."
   â”‚   â”œâ”€ CRAWLER_TYPE = "search"
   â”‚   â”œâ”€ CRAWLER_MAX_NOTES_COUNT = 50
   â”‚   â”œâ”€ ENABLE_GET_COMMENTS = True
   â”‚   â””â”€ CRAWLER_MAX_COMMENTS_COUNT_SINGLENOTES = 20
   â””â”€ ä¿®æ”¹MediaCrawler/config/db_config.py
       â””â”€ ä½¿ç”¨MindSpiderçš„MySQLé…ç½®

æ­¥éª¤3: æ‰§è¡Œçˆ¬å–ï¼ˆè°ƒç”¨MediaCrawlerï¼‰
â””â”€ subprocess.run(['python', 'main.py', '--platform', 'xhs', ...])
   â”œâ”€ MediaCrawlerå¯åŠ¨Playwrightæµè§ˆå™¨
   â”œâ”€ æ‰§è¡Œç™»å½•ï¼ˆå¦‚éœ€è¦ï¼‰
   â”œâ”€ æœç´¢å…³é”®è¯
   â”œâ”€ æ»šåŠ¨åŠ è½½å†…å®¹
   â”œâ”€ çˆ¬å–å¸–å­è¯¦æƒ…
   â”œâ”€ çˆ¬å–è¯„è®º
   â””â”€ å®æ—¶å†™å…¥æ•°æ®åº“
       â”œâ”€ xhs_noteè¡¨: ç¬”è®°å†…å®¹ã€ä½œè€…ã€ç‚¹èµæ•°ã€è¯„è®ºæ•°ç­‰
       â””â”€ xhs_note_commentè¡¨: è¯„è®ºå†…å®¹ã€å›å¤å…³ç³»ç­‰

æ­¥éª¤4: æ•°æ®ç›´æ¥å­˜å‚¨ï¼ˆMediaCrawlerè‡ªåŠ¨å®Œæˆï¼‰
â””â”€ çˆ¬è™«è¿‡ç¨‹ä¸­å®æ—¶å­˜å‚¨ï¼Œæ— éœ€é¢å¤–å¤„ç†
   â”œâ”€ æ•°æ®ç»“æ„å·²é¢„å®šä¹‰ï¼ˆMediaCrawlerå†…ç½®ï¼‰
   â”œâ”€ åŒ…å«source_keywordå­—æ®µï¼ˆè®°å½•æœç´¢å…³é”®è¯ï¼‰
   â””â”€ åŒ…å«ä¸°å¯Œçš„å…ƒæ•°æ®ï¼ˆå‘å¸ƒæ—¶é—´ã€äº’åŠ¨æ•°æ®ç­‰ï¼‰

æ­¥éª¤5: ç»Ÿè®¡ä¸æ—¥å¿—
â””â”€ PlatformCrawler.crawl_stats
   â”œâ”€ è®°å½•æ¯ä¸ªå¹³å°çš„çˆ¬å–ç»“æœ
   â”‚   â”œâ”€ keywords_count: å…³é”®è¯æ•°é‡
   â”‚   â”œâ”€ duration_seconds: è€—æ—¶
   â”‚   â”œâ”€ notes_count: çˆ¬å–çš„å†…å®¹æ•°
   â”‚   â””â”€ comments_count: çˆ¬å–çš„è¯„è®ºæ•°
   â””â”€ å¯ä¿å­˜ä¸ºJSONæ—¥å¿—æ–‡ä»¶
```

**å¤„ç†ç‰¹ç‚¹**:
1. **æ— åå¤„ç†**: æ•°æ®ç›´æ¥å…¥åº“ï¼Œä¸åšé¢å¤–æ¸…æ´—æˆ–è½¬æ¢
2. **å¢é‡çˆ¬å–**: é€šè¿‡source_keywordå­—æ®µå…³è”åˆ°è¯é¢˜
3. **å¼‚æ­¥å†™å…¥**: çˆ¬å–å’Œå­˜å‚¨åŒæ­¥è¿›è¡Œï¼Œæé«˜æ•ˆç‡
4. **å®¹é”™æœºåˆ¶**: å•ä¸ªå¹³å°å¤±è´¥ä¸å½±å“å…¶ä»–å¹³å°

**æ•°æ®æµå‘å›¾**:
```
13ä¸ªæ–°é—»å¹³å° â†’ NewsCollector â†’ daily_newsè¡¨
                     â†“
              DeepSeek APIåˆ†æ
                     â†“
         å…³é”®è¯ + æ€»ç»“ â†’ daily_topicsè¡¨
                     â†“
              KeywordManagerè¯»å–
                     â†“
    [AIæŠ€æœ¯, è‚¡å¸‚, å¤§æ¨¡å‹, ...] (å…³é”®è¯åˆ—è¡¨)
                     â†“
         7ä¸ªå¹³å°çˆ¬è™« (å¹¶è¡Œæ‰§è¡Œ)
         â”œâ”€ å°çº¢ä¹¦: æœç´¢"AIæŠ€æœ¯" â†’ xhs_noteè¡¨
         â”œâ”€ æŠ–éŸ³: æœç´¢"AIæŠ€æœ¯" â†’ douyin_awemeè¡¨
         â”œâ”€ Bç«™: æœç´¢"AIæŠ€æœ¯" â†’ bilibili_videoè¡¨
         â””â”€ ...
                     â†“
         InsightEngineæŸ¥è¯¢å·¥å…·é›†
         â”œâ”€ search_hot_content: æŒ‰çƒ­åº¦æ’åº
         â”œâ”€ search_topic_globally: å…¨å±€æœç´¢å…³é”®è¯
         â””â”€ get_comments_for_topic: è·å–è¯„è®º
```

**å…³é”®è®¾è®¡äº®ç‚¹**:
1. **LLMé©±åŠ¨**: ä½¿ç”¨DeepSeek APIæ™ºèƒ½æå–å…³é”®è¯ï¼Œè€Œéç®€å•çš„TF-IDF
2. **ä¸¤æ­¥çˆ¬å–**: å…ˆå¹¿åº¦é‡‡é›†è¯é¢˜ï¼Œå†æ·±åº¦çˆ¬å–ç»†èŠ‚
3. **æ— ä¸­é—´å¤„ç†**: æ•°æ®ç›´æ¥è½åº“ï¼Œå‡å°‘æ•°æ®ä¸¢å¤±é£é™©
4. **ç»“æ„åŒ–å­˜å‚¨**: é¢„å®šä¹‰Schemaï¼Œä¾¿äºåç»­æŸ¥è¯¢åˆ†æ
5. **å…³é”®è¯è¿½è¸ª**: source_keywordå­—æ®µå¯è¿½æº¯æ•°æ®æ¥æº

---

### 2.2.4 å¬å›ç‡ä¿éšœæœºåˆ¶ï¼šå¦‚ä½•ä¿è¯ç‰¹å®šä¸»é¢˜çš„å…¨æ–‡æ£€ç´¢å¬å›ï¼Ÿ

**æ ¸å¿ƒé—®é¢˜**ï¼šå½“Agentç”Ÿæˆä¸€ä¸ªæŸ¥è¯¢è¯ï¼ˆå¦‚"æ­¦æ±‰å¤§å­¦èˆ†æƒ…åˆ†æ"ï¼‰ï¼Œå¦‚ä½•ä¿è¯èƒ½ä»æ•°æ®åº“ä¸­å¬å›æ‰€æœ‰ç›¸å…³å†…å®¹ï¼Ÿ

**ä¸‰å±‚å¬å›ä¿éšœæœºåˆ¶**ï¼š

#### ç¬¬ä¸€å±‚ï¼šå…³é”®è¯ä¼˜åŒ–ä¸­é—´ä»¶ï¼ˆKeywordOptimizerï¼‰

**é—®é¢˜**ï¼šAgentç”Ÿæˆçš„æŸ¥è¯¢è¯å¯èƒ½å¤ªå®˜æ–¹ã€å¤ªä¸“ä¸šï¼Œä¸ç½‘æ°‘å®é™…ä½¿ç”¨çš„è¯æ±‡ä¸åŒ¹é…

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨å°å‚æ•°LLMï¼ˆQwen3-30Bï¼‰å°†æŸ¥è¯¢è¯æ‰©å±•ä¸º10-20ä¸ªè´´è¿‘ç½‘æ°‘è¯­è¨€çš„å…³é”®è¯

```python
# InsightEngine/tools/keyword_optimizer.py

è¾“å…¥: "æ­¦æ±‰å¤§å­¦èˆ†æƒ…ç®¡ç† æœªæ¥å±•æœ› å‘å±•è¶‹åŠ¿"

â†“ KeywordOptimizer.optimize_keywords()

System Promptæ ¸å¿ƒåŸåˆ™:
1. è´´è¿‘ç½‘æ°‘è¯­è¨€: ä½¿ç”¨æ™®é€šç½‘å‹åœ¨ç¤¾äº¤åª’ä½“ä¸Šä¼šä½¿ç”¨çš„è¯æ±‡
2. é¿å…ä¸“ä¸šæœ¯è¯­: ä¸ä½¿ç”¨"èˆ†æƒ…"ã€"ä¼ æ’­"ã€"å€¾å‘"ã€"å±•æœ›"ç­‰å®˜æ–¹è¯æ±‡
3. ç®€æ´å…·ä½“: æ¯ä¸ªå…³é”®è¯è¦éå¸¸ç®€æ´æ˜äº†
4. æƒ…æ„Ÿä¸°å¯Œ: åŒ…å«ç½‘æ°‘å¸¸ç”¨çš„æƒ…æ„Ÿè¡¨è¾¾
5. æ•°é‡æ§åˆ¶: æœ€å°‘10ä¸ªï¼Œæœ€å¤š20ä¸ªå…³é”®è¯

â†“ Qwen3-30B APIè°ƒç”¨

è¾“å‡º: 
{
    "keywords": [
        "æ­¦å¤§", "æ­¦æ±‰å¤§å­¦", "å­¦æ ¡ç®¡ç†", "å¤§å­¦", "æ•™è‚²",
        "æ­¦å¤§å­¦ç”Ÿ", "æ ¡å›­", "æ­¦æ±‰", "é«˜æ ¡", "å¤§å­¦ç”Ÿæ´»",
        "å­¦æ ¡", "æ­¦å¤§æ ¡å‹", "ççˆå±±", "æ¨±èŠ±", "æ­¦æ±‰é«˜æ ¡"
    ],
    "reasoning": "é€‰æ‹©'æ­¦å¤§'å’Œ'æ­¦æ±‰å¤§å­¦'ä½œä¸ºæ ¸å¿ƒè¯æ±‡ï¼Œè¿™æ˜¯ç½‘æ°‘æœ€å¸¸ä½¿ç”¨çš„ç§°å‘¼ï¼›
                 'å­¦æ ¡ç®¡ç†'æ¯”'èˆ†æƒ…ç®¡ç†'æ›´è´´è¿‘æ—¥å¸¸è¡¨è¾¾ï¼›
                 é¿å…ä½¿ç”¨'æœªæ¥å±•æœ›'ã€'å‘å±•è¶‹åŠ¿'ç­‰ç½‘æ°‘å¾ˆå°‘ä½¿ç”¨çš„ä¸“ä¸šæœ¯è¯­ï¼›
                 å¢åŠ 'æ¨±èŠ±'ã€'ççˆå±±'ç­‰å…³è”è¯ä»¥æé«˜å¬å›ç‡"
}

æ•ˆæœ: 
- ä»1ä¸ªæŸ¥è¯¢è¯ â†’ æ‰©å±•ä¸º15ä¸ªå…³é”®è¯
- å¬å›ç‡æå‡: 3-5å€
```

**å…³é”®è¯éªŒè¯æœºåˆ¶**ï¼š
```python
# è¿‡æ»¤ä¸è‰¯å…³é”®è¯ï¼ˆè¿‡äºä¸“ä¸šæˆ–å®˜æ–¹ï¼‰
bad_keywords = {
    'æ€åº¦åˆ†æ', 'å…¬ä¼—ååº”', 'æƒ…ç»ªå€¾å‘',
    'æœªæ¥å±•æœ›', 'å‘å±•è¶‹åŠ¿', 'æˆ˜ç•¥è§„åˆ’', 
    'æ”¿ç­–å¯¼å‘', 'ç®¡ç†æœºåˆ¶'
}

# åŸºæœ¬éªŒè¯
- é•¿åº¦: 1 <= len(keyword) <= 20
- é¿å…ç©ºæ ¼: "é›·å†›ç­äº‰è®®" âœ…, "é›·å†›ç­ äº‰è®®" âŒ
- é¿å…ä¸“ä¸šæœ¯è¯­
```

**Fallbackæœºåˆ¶**ï¼šå¦‚æœAPIè°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨ç®€å•çš„æ­£åˆ™åˆ†è¯ä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆ

---

#### ç¬¬äºŒå±‚ï¼šå¤šå­—æ®µæ¨¡ç³Šæœç´¢

**é—®é¢˜**ï¼šå†…å®¹å¯èƒ½å‡ºç°åœ¨æ ‡é¢˜ã€æ­£æ–‡ã€æ ‡ç­¾ç­‰ä¸åŒå­—æ®µ

**è§£å†³æ–¹æ¡ˆ**ï¼šå¯¹æ¯ä¸ªå…³é”®è¯ï¼Œåœ¨å¤šä¸ªå­—æ®µä¸­ä½¿ç”¨LIKEæ¨¡ç³ŠåŒ¹é…

```python
# InsightEngine/tools/search.py: search_topic_globally()

æœç´¢é…ç½®ç¤ºä¾‹ï¼ˆå°çº¢ä¹¦ï¼‰:
{
    'xhs_note': {
        'fields': ['title', 'desc', 'tag_list', 'source_keyword'],
        'type': 'note'
    }
}

ç”Ÿæˆçš„SQLæŸ¥è¯¢:
SELECT * FROM xhs_note 
WHERE 
    title LIKE '%æ­¦å¤§%' OR 
    desc LIKE '%æ­¦å¤§%' OR 
    tag_list LIKE '%æ­¦å¤§%' OR 
    source_keyword LIKE '%æ­¦å¤§%'
ORDER BY id DESC 
LIMIT 100

å¯¹15ä¸ªå…³é”®è¯ï¼Œç”Ÿæˆ15æ¡ç±»ä¼¼æŸ¥è¯¢ï¼Œç»“æœåˆå¹¶å»é‡
```

**å¤šå­—æ®µè¦†ç›–èŒƒå›´**ï¼š
```
å†…å®¹è¡¨æœç´¢å­—æ®µ:
â”œâ”€ title: æ ‡é¢˜ï¼ˆé«˜ç›¸å…³æ€§ï¼‰
â”œâ”€ desc: æè¿°/æ­£æ–‡ï¼ˆä¸­ç›¸å…³æ€§ï¼‰
â”œâ”€ tag_list: æ ‡ç­¾ï¼ˆé«˜ç›¸å…³æ€§ï¼Œç”¨æˆ·ä¸»åŠ¨æ ‡æ³¨ï¼‰
â””â”€ source_keyword: çˆ¬å–å…³é”®è¯ï¼ˆè¿½æº¯æ•°æ®æ¥æºï¼‰

è¯„è®ºè¡¨æœç´¢å­—æ®µ:
â””â”€ content: è¯„è®ºå†…å®¹ï¼ˆç”¨æˆ·çœŸå®åé¦ˆï¼‰
```

**LIKEæ¨¡ç³ŠåŒ¹é…çš„ä¼˜åŠ¿**ï¼š
- `%keyword%`: åŒ¹é…ä»»æ„ä½ç½®
- ä¾‹å¦‚ï¼š"æ­¦å¤§"å¯ä»¥åŒ¹é…"æ­¦å¤§æ¨±èŠ±"ã€"æˆ‘åœ¨æ­¦å¤§"ã€"æ­¦å¤§å­¦ç”Ÿ"
- æ— éœ€åˆ†è¯ï¼Œç®€å•é«˜æ•ˆ

---

#### ç¬¬ä¸‰å±‚ï¼šå…¨å±€è·¨è¡¨æœç´¢

**é—®é¢˜**ï¼šä¸åŒå¹³å°çš„æ•°æ®å­˜å‚¨åœ¨ä¸åŒè¡¨ä¸­ï¼Œå¦‚ä½•å…¨é¢è¦†ç›–ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼šè·¨14ä¸ªè¡¨ï¼ˆ7ä¸ªå¹³å°Ã—2ç§ç±»å‹ï¼‰å¹¶è¡Œæœç´¢

```python
# æœç´¢èŒƒå›´é…ç½®
search_configs = {
    # å†…å®¹è¡¨
    'bilibili_video': {'fields': ['title', 'desc', 'source_keyword'], 'type': 'video'},
    'douyin_aweme': {'fields': ['title', 'desc', 'source_keyword'], 'type': 'video'},
    'kuaishou_video': {'fields': ['title', 'desc', 'source_keyword'], 'type': 'video'},
    'weibo_note': {'fields': ['content', 'source_keyword'], 'type': 'note'},
    'xhs_note': {'fields': ['title', 'desc', 'tag_list', 'source_keyword'], 'type': 'note'},
    'zhihu_content': {'fields': ['title', 'desc', 'content_text', 'source_keyword'], 'type': 'content'},
    'tieba_note': {'fields': ['title', 'desc', 'source_keyword'], 'type': 'note'},
    
    # è¯„è®ºè¡¨
    'bilibili_video_comment': {'fields': ['content'], 'type': 'comment'},
    'douyin_aweme_comment': {'fields': ['content'], 'type': 'comment'},
    'kuaishou_video_comment': {'fields': ['content'], 'type': 'comment'},
    'weibo_note_comment': {'fields': ['content'], 'type': 'comment'},
    'xhs_note_comment': {'fields': ['content'], 'type': 'comment'},
    'zhihu_comment': {'fields': ['content'], 'type': 'comment'},
    'tieba_comment': {'fields': ['content'], 'type': 'comment'},
    
    # æ–°é—»è¡¨
    'daily_news': {'fields': ['title'], 'type': 'news'}
}

# æ‰§è¡Œç­–ç•¥
for table, config in search_configs.items():
    # å¯¹æ¯ä¸ªè¡¨æ‰§è¡Œæœç´¢
    results = execute_query(table, keyword, config['fields'])
    all_results.extend(results)  # åˆå¹¶ç»“æœ

# æ¯ä¸ªè¡¨æœ€å¤šè¿”å›100æ¡ï¼Œæ€»å…±æœ€å¤š14Ã—100=1400æ¡
```

**å…¨å±€æœç´¢çš„ä¼˜åŠ¿**ï¼š
- **è¦†ç›–å…¨é¢**ï¼šä¸é—æ¼ä»»ä½•å¹³å°
- **å»é‡åˆå¹¶**ï¼šè‡ªåŠ¨åˆå¹¶é‡å¤å†…å®¹
- **çµæ´»é…ç½®**ï¼šå¯ä»¥åªæœç´¢ç‰¹å®šå¹³å°ï¼ˆsearch_topic_on_platformå·¥å…·ï¼‰

---

#### å¬å›ç‡ä¿éšœæ•ˆæœåˆ†æ

**ç¤ºä¾‹ï¼šæœç´¢"æ­¦æ±‰å¤§å­¦"**

```
ç¬¬ä¸€å±‚ï¼ˆå…³é”®è¯æ‰©å±•ï¼‰ï¼š
è¾“å…¥: "æ­¦æ±‰å¤§å­¦èˆ†æƒ…ç®¡ç†"
è¾“å‡º: ["æ­¦å¤§", "æ­¦æ±‰å¤§å­¦", "å­¦æ ¡ç®¡ç†", "ççˆå±±", "æ¨±èŠ±", ...]
æ•ˆæœ: 15ä¸ªå…³é”®è¯

ç¬¬äºŒå±‚ï¼ˆå¤šå­—æ®µæœç´¢ï¼‰ï¼š
æ¯ä¸ªå…³é”®è¯æœç´¢4ä¸ªå­—æ®µï¼ˆtitle, desc, tag_list, source_keywordï¼‰
æ•ˆæœ: 15Ã—4 = 60ä¸ªå­—æ®µåŒ¹é…æ¡ä»¶ï¼ˆORè¿æ¥ï¼‰

ç¬¬ä¸‰å±‚ï¼ˆè·¨è¡¨æœç´¢ï¼‰ï¼š
14ä¸ªè¡¨ Ã— 15ä¸ªå…³é”®è¯ = 210æ¬¡æŸ¥è¯¢
æ¯æ¬¡æœ€å¤š100æ¡ â†’ ç†è®ºæœ€å¤§å¬å›: 21,000æ¡
å®é™…å»é‡å: çº¦500-2000æ¡

æœ€ç»ˆå¬å›ç‡æå‡: 
- å•å…³é”®è¯å•å­—æ®µ: å‡è®¾å¬å›50æ¡
- ä¼˜åŒ–å: å¬å›500-2000æ¡
- æå‡å€æ•°: 10-40å€
```

**å¬å›ç‡ vs å‡†ç¡®ç‡çš„æƒè¡¡**ï¼š
```
å¬å›ç‡ç­–ç•¥:
â”œâ”€ å®å¯å¤šä¸å¯å°‘ï¼ˆå¬å›ä¼˜å…ˆï¼‰
â”œâ”€ ä½¿ç”¨æ¨¡ç³ŠåŒ¹é…ï¼ˆLIKE %keyword%ï¼‰
â”œâ”€ æ‰©å±•å¤§é‡å…³é”®è¯ï¼ˆ10-20ä¸ªï¼‰
â””â”€ äº¤ç»™LLMè¿›è¡Œåç»­ç­›é€‰

å‡†ç¡®ç‡ç­–ç•¥:
â””â”€ ç”±Agentçš„SummaryNodeè¿›è¡ŒäºŒæ¬¡è¿‡æ»¤
    â”œâ”€ LLMé˜…è¯»å¬å›çš„å†…å®¹
    â”œâ”€ ç­›é€‰çœŸæ­£ç›¸å…³çš„
    â””â”€ ç”Ÿæˆé«˜è´¨é‡æ€»ç»“
```

---

#### æŠ€æœ¯äº®ç‚¹ä¸é™åˆ¶

**äº®ç‚¹**ï¼š
1. **æ™ºèƒ½æ‰©å±•**: ä¸æ˜¯ç®€å•çš„åŒä¹‰è¯æ›¿æ¢ï¼Œè€Œæ˜¯ç†è§£è¯­ä¹‰åæ‰©å±•
2. **å¤šç»´è¦†ç›–**: å­—æ®µç»´åº¦ã€å…³é”®è¯ç»´åº¦ã€å¹³å°ç»´åº¦ä¸‰é‡è¦†ç›–
3. **å®¹é”™æ€§å¼º**: å³ä½¿æŸä¸ªå…³é”®è¯æ— æ•ˆï¼Œå…¶ä»–å…³é”®è¯ä»èƒ½å¬å›
4. **å¯è§£é‡Šæ€§**: æ¯ä¸ªå…³é”®è¯çš„é€‰æ‹©éƒ½æœ‰reasoningè¯´æ˜

**é™åˆ¶**ï¼š
1. **æ€§èƒ½å¼€é”€**: 
   - 15ä¸ªå…³é”®è¯ Ã— 14ä¸ªè¡¨ Ã— 4ä¸ªå­—æ®µ = å¤§é‡SQLæŸ¥è¯¢
   - è§£å†³æ–¹æ¡ˆ: å¼‚æ­¥æŸ¥è¯¢ã€ç»“æœç¼“å­˜
2. **å™ªéŸ³é—®é¢˜**: 
   - è¿‡åº¦æ‰©å±•å¯èƒ½å¼•å…¥æ— å…³å†…å®¹
   - è§£å†³æ–¹æ¡ˆ: LLMåœ¨SummaryNodeè¿›è¡Œç²¾ç»†è¿‡æ»¤
3. **åŒéŸ³è¯è¯¯åŒ¹é…**: 
   - "æ­¦å¤§"å¯èƒ½åŒ¹é…åˆ°"æ­¦æ‰“"ã€"æ­¦å¤§éƒ"
   - è§£å†³æ–¹æ¡ˆ: ä¾èµ–LLMçš„è¯­ä¹‰ç†è§£èƒ½åŠ›
4. **âš ï¸ å…³é”®è¯ä¸ä¸€è‡´æ€§é—®é¢˜ï¼ˆæœ€ä¸¥é‡ï¼‰**:
   - **å­˜å‚¨æ—¶çš„å…³é”®è¯ä¸ä¸€è‡´**ï¼šåŒä¸€æ¦‚å¿µåœ¨ä¸åŒæ—¶é—´æå–çš„å…³é”®è¯å¯èƒ½ä¸åŒ
   - **å¯¼è‡´å¬å›ä¸å®Œæ•´**ï¼šæ— æ³•åŒ¹é…åˆ°è¯­ä¹‰ç›¸åŒä½†è¯æ±‡ä¸åŒçš„å†…å®¹
   - **å½“å‰ç³»ç»Ÿæ— æ³•è§£å†³**ï¼šKeywordOptimizeråªèƒ½åœ¨æŸ¥è¯¢æ—¶æ‰©å±•ï¼Œæ— æ³•ä¿®å¤å­˜å‚¨é—®é¢˜
   - è¯¦è§ä¸‹ä¸€èŠ‚åˆ†æ

---

#### é‡‘èåœºæ™¯çš„å¬å›ç­–ç•¥

**è‚¡ç¥¨æŸ¥è¯¢çš„ç‰¹æ®Šæ€§**ï¼š

```
é—®é¢˜: "åˆ†æè´µå·èŒ…å°(600519)çš„æŠ•èµ„ä»·å€¼"

ç¬¬ä¸€å±‚: è‚¡ç¥¨åç§°/ä»£ç æ‰©å±•
è¾“å…¥: "è´µå·èŒ…å°"
è¾“å‡º: ["è´µå·èŒ…å°", "èŒ…å°", "600519", "600519.SH", "èŒ…å°è‚¡ç¥¨", "èŒ…å°é…’", "KWEICHOW MOUTAI"]

ç¬¬äºŒå±‚: å¤šç»´åº¦æ•°æ®æº
â”œâ”€ äº¤æ˜“æ•°æ®: æŒ‰è‚¡ç¥¨ä»£ç ç²¾ç¡®åŒ¹é…ï¼ˆts_code='600519.SH'ï¼‰
â”œâ”€ è´¢åŠ¡æ•°æ®: æŒ‰è‚¡ç¥¨ä»£ç ç²¾ç¡®åŒ¹é…
â”œâ”€ æ–°é—»æ•°æ®: å¤šå…³é”®è¯æ¨¡ç³ŠåŒ¹é…ï¼ˆtitle LIKE '%èŒ…å°%'ï¼‰
â”œâ”€ å…¬å‘Šæ•°æ®: è‚¡ç¥¨ä»£ç ç²¾ç¡®åŒ¹é…
â””â”€ ç ”æŠ¥æ•°æ®: å…³é”®è¯æ¨¡ç³ŠåŒ¹é…

ç¬¬ä¸‰å±‚: æ—¶é—´ç»´åº¦
â”œâ”€ å®æ—¶æ•°æ®: æœ€æ–°è¡Œæƒ…
â”œâ”€ å†å²æ•°æ®: è¿‡å»Nå¤©/æœˆ/å¹´
â””â”€ å‘¨æœŸæ€§æ•°æ®: è´¢æŠ¥ï¼ˆå­£åº¦/å¹´åº¦ï¼‰
```

**å…³é”®å·®å¼‚**ï¼š
1. **ç»“æ„åŒ–æ•°æ®æ— éœ€å…³é”®è¯ä¼˜åŒ–**: è‚¡ç¥¨ä»£ç ç›´æ¥ç²¾ç¡®åŒ¹é…
2. **éç»“æ„åŒ–æ•°æ®éœ€è¦æ‰©å±•**: æ–°é—»ã€å…¬å‘Šã€ç ”æŠ¥ä½¿ç”¨å…³é”®è¯ä¼˜åŒ–
3. **æ··åˆæŸ¥è¯¢ç­–ç•¥**: 
   - ç»“æ„åŒ–: ç²¾ç¡®åŒ¹é…ï¼ˆWHERE stock_code='600519'ï¼‰
   - éç»“æ„åŒ–: æ¨¡ç³ŠåŒ¹é…ï¼ˆWHERE title LIKE '%èŒ…å°%'ï¼‰

---

### 2.2.5 ğŸ”´ å…³é”®è¯ä¸ä¸€è‡´æ€§é—®é¢˜ï¼šä¼ ç»Ÿæ£€ç´¢çš„è‡´å‘½ç¼ºé™·

**é—®é¢˜å‘ç°è€…**: ç”¨æˆ·åœ¨è®¨è®ºä¸­æå‡ºçš„å…³é”®è§‚å¯Ÿ

#### é—®é¢˜æè¿°

**åœºæ™¯é‡ç°**ï¼š
```
æ—¶é—´çº¿ï¼š
â”œâ”€ 2024-01-15: MindSpiderçˆ¬å–æ–‡ç« Aï¼ŒDeepSeekæå–å…³é”®è¯ â†’ "æœºå™¨äºº"
â”œâ”€ 2024-02-20: MindSpiderçˆ¬å–æ–‡ç« Bï¼ŒDeepSeekæå–å…³é”®è¯ â†’ "äººå½¢æœºå™¨"
â””â”€ 2024-03-10: ç”¨æˆ·æŸ¥è¯¢"æœºå™¨äººç›¸å…³æ–°é—»"

æŸ¥è¯¢æµç¨‹ï¼š
Step 1: KeywordOptimizeræ‰©å±• "æœºå™¨äºº" â†’ ["æœºå™¨äºº", "æœºå™¨äººæŠ€æœ¯", "AIæœºå™¨äºº", ...]
Step 2: SQLæŸ¥è¯¢ WHERE source_keyword LIKE '%æœºå™¨äºº%' OR title LIKE '%æœºå™¨äºº%'
Step 3: è¿”å›ç»“æœ

ç»“æœï¼š
âœ… æ–‡ç« Aè¢«å¬å›ï¼ˆsource_keyword="æœºå™¨äºº"ï¼Œç²¾ç¡®åŒ¹é…ï¼‰
âŒ æ–‡ç« Bè¢«é—æ¼ï¼ˆsource_keyword="äººå½¢æœºå™¨"ï¼Œæ— æ³•åŒ¹é…ï¼‰

é—®é¢˜æ ¹æºï¼š
è™½ç„¶"æœºå™¨äºº"å’Œ"äººå½¢æœºå™¨"æ˜¯åŒä¸€æ¦‚å¿µï¼Œä½†ç”±äºï¼š
1. å­˜å‚¨æ—¶æå–çš„å…³é”®è¯ä¸åŒï¼ˆLLMæ¯æ¬¡ç†è§£å¯èƒ½ä¸åŒï¼‰
2. source_keywordå­—æ®µæ˜¯å›ºå®šçš„ï¼Œæ— æ³•äº‹åä¿®æ”¹
3. å…³é”®è¯åŒ¹é…æ˜¯å­—é¢åŒ¹é…ï¼Œæ— æ³•ç†è§£è¯­ä¹‰ç›¸ä¼¼æ€§
â†’ å¯¼è‡´è¯­ä¹‰ç›¸åŒçš„æ–‡ç« æ— æ³•è¢«ä¸€èµ·å¬å›
```

---

#### é—®é¢˜æ ¹æºåˆ†æ

**æ ¹æœ¬åŸå› ï¼šå­˜å‚¨æ—¶çš„å…³é”®è¯æå–ä¸ä¸€è‡´**

```python
# MindSpider/BroadTopicExtraction/topic_extractor.py

é—®é¢˜å‘ç”Ÿåœ¨è¿™é‡Œï¼š
â”œâ”€ TopicExtractor.extract_keywords_and_summary()
â”‚   â””â”€ è°ƒç”¨ DeepSeek API æå–å…³é”®è¯
â”‚       â”œâ”€ è¾“å…¥ï¼šå½“å¤©çš„æ–°é—»æ ‡é¢˜ï¼ˆ13ä¸ªå¹³å°çš„çƒ­æœï¼‰
â”‚       â”œâ”€ è¾“å‡ºï¼š{"keywords": [...], "summary": "..."}
â”‚       â””â”€ é—®é¢˜ï¼šå¯¹äºåŒä¸€ä¸ªæ¦‚å¿µï¼Œä¸åŒæ‰¹æ¬¡çš„æ–°é—»å¯èƒ½æå–å‡ºä¸åŒå…³é”®è¯
â”‚
â”œâ”€ DatabaseManager.save_daily_topics()
â”‚   â””â”€ ä¿å­˜åˆ° daily_topics.keywordsï¼ˆJSONå­—ç¬¦ä¸²ï¼‰
â”‚       â””â”€ é—®é¢˜ï¼šä¸€æ—¦ä¿å­˜ï¼Œå…³é”®è¯å›ºå®šï¼Œæ— æ³•ç»Ÿä¸€
â”‚
â””â”€ DeepSentimentCrawling ä½¿ç”¨è¿™äº›å…³é”®è¯çˆ¬å–
    â””â”€ MediaCrawler å°† source_keyword å†™å…¥æ•°æ®åº“
        â””â”€ é—®é¢˜ï¼šä¸åŒæ‰¹æ¬¡çˆ¬å–çš„å†…å®¹ï¼Œsource_keywordä¸ä¸€è‡´
```

**å…·ä½“æ¡ˆä¾‹**ï¼š

| æ—¥æœŸ | çƒ­ç‚¹æ–°é—»æ ‡é¢˜ | DeepSeekæå–çš„å…³é”®è¯ | çˆ¬å–åˆ°çš„å†…å®¹ | source_keyword |
|------|-------------|---------------------|-------------|---------------|
| 2024-01-15 | "ç‰¹æ–¯æ‹‰å‘å¸ƒæ–°æ¬¾äººå½¢æœºå™¨äººOptimus" | "æœºå™¨äºº", "ç‰¹æ–¯æ‹‰" | å¾®åšã€çŸ¥ä¹ç›¸å…³è®¨è®º | "æœºå™¨äºº" |
| 2024-02-20 | "äººå½¢æœºå™¨äººäº§ä¸šçˆ†å‘ï¼Œå¤šå®¶å…¬å¸å¸ƒå±€" | "äººå½¢æœºå™¨", "äº§ä¸šé“¾" | Bç«™ã€å°çº¢ä¹¦ç›¸å…³è§†é¢‘ | "äººå½¢æœºå™¨" |
| 2024-03-10 | "å·¥ä¸šæœºå™¨äººé”€é‡åˆ›æ–°é«˜" | "å·¥ä¸šæœºå™¨äºº", "åˆ¶é€ ä¸š" | æŠ–éŸ³ã€å¿«æ‰‹ç›¸å…³å†…å®¹ | "å·¥ä¸šæœºå™¨äºº" |

**æŸ¥è¯¢"æœºå™¨äººç›¸å…³æ–°é—»"æ—¶çš„å¬å›æƒ…å†µ**ï¼š
```sql
-- KeywordOptimizer æ‰©å±•å‡ºçš„å…³é”®è¯
keywords = ["æœºå™¨äºº", "æœºå™¨äººæŠ€æœ¯", "AIæœºå™¨äºº", "æ™ºèƒ½æœºå™¨äºº", ...]

-- SQL æŸ¥è¯¢
SELECT * FROM xhs_note WHERE source_keyword LIKE '%æœºå™¨äºº%'

-- å¬å›ç»“æœ
âœ… 2024-01-15çš„å†…å®¹ï¼ˆsource_keyword="æœºå™¨äºº"ï¼‰ â†’ å¬å›
âŒ 2024-02-20çš„å†…å®¹ï¼ˆsource_keyword="äººå½¢æœºå™¨"ï¼‰ â†’ é—æ¼
âŒ 2024-03-10çš„å†…å®¹ï¼ˆsource_keyword="å·¥ä¸šæœºå™¨äºº"ï¼‰ â†’ é—æ¼ï¼ˆé™¤éå…³é”®è¯æ‰©å±•åŒ…å«"å·¥ä¸šæœºå™¨äºº"ï¼‰

å¬å›ç‡ï¼š33%ï¼ˆä»…å¬å›1/3ï¼‰
```

---

#### ä¸ºä»€ä¹ˆKeywordOptimizeræ— æ³•è§£å†³ï¼Ÿ

**å½“å‰KeywordOptimizerçš„ä½œç”¨èŒƒå›´**ï¼š

```
ç”¨æˆ·æŸ¥è¯¢: "åˆ†ææœºå™¨äººè¡Œä¸šè¶‹åŠ¿"
â†“
KeywordOptimizeråœ¨æŸ¥è¯¢æ—¶æ‰©å±•ï¼š
  è¾“å…¥: "æœºå™¨äººè¡Œä¸šè¶‹åŠ¿"
  è¾“å‡º: ["æœºå™¨äºº", "æœºå™¨äººæŠ€æœ¯", "AIæœºå™¨äºº", "æ™ºèƒ½æœºå™¨äºº", "æœºå™¨äººè¡Œä¸š", "äººå·¥æ™ºèƒ½"]
â†“
SQLæŸ¥è¯¢: WHERE title LIKE '%æœºå™¨äºº%' OR title LIKE '%æœºå™¨äººæŠ€æœ¯%' OR ...
â†“
é—®é¢˜ï¼šåªèƒ½åŒ¹é…title/descå­—æ®µä¸­åŒ…å«è¿™äº›è¯çš„å†…å®¹
      æ— æ³•ä¿®å¤source_keywordå­—æ®µçš„ä¸ä¸€è‡´é—®é¢˜
```

**å…³é”®çŸ›ç›¾**ï¼š
```
æŸ¥è¯¢æ—¶æ‰©å±•çš„å…³é”®è¯ â‰  å­˜å‚¨æ—¶çš„ source_keyword

ä¾‹å¦‚ï¼š
æŸ¥è¯¢æ—¶æ‰©å±•: ["æœºå™¨äºº", "æœºå™¨äººæŠ€æœ¯", "AIæœºå™¨äºº"]
å­˜å‚¨æ—¶çš„source_keyword: "äººå½¢æœºå™¨"

LIKEåŒ¹é…ç»“æœ:
  - source_keyword LIKE '%æœºå™¨äºº%' â†’ âŒ ä¸åŒ¹é…ï¼ˆ"äººå½¢æœºå™¨"ä¸åŒ…å«"æœºå™¨äºº"ï¼‰
  - title LIKE '%æœºå™¨äºº%' â†’ âœ… å¯èƒ½åŒ¹é…ï¼ˆå¦‚æœæ ‡é¢˜åŒ…å«"æœºå™¨äºº"ï¼‰
  
ç»“è®ºï¼šåªèƒ½ä¾èµ–title/descå­—æ®µï¼Œsource_keywordå­—æ®µåŸºæœ¬æ— ç”¨
```

---

#### é‡‘èåœºæ™¯çš„ä¸¥é‡æ€§

**é—®é¢˜åœ¨é‡‘èåœºæ™¯ä¼šæŒ‡æ•°çº§æ”¾å¤§**ï¼š

##### æ¡ˆä¾‹1ï¼šæ–°èƒ½æºæ±½è½¦ä¸»é¢˜
```
åŒä¸€ä¸ªæ¦‚å¿µçš„ä¸åŒè¡¨è¿°ï¼š
â”œâ”€ "æ–°èƒ½æºæ±½è½¦"
â”œâ”€ "æ–°èƒ½æºè½¦"
â”œâ”€ "ç”µåŠ¨æ±½è½¦"
â”œâ”€ "ç”µåŠ¨è½¦"
â”œâ”€ "NEV"ï¼ˆNew Energy Vehicleï¼‰
â”œâ”€ "çº¯ç”µåŠ¨è½¦"
â”œâ”€ "æ’ç”µæ··åŠ¨"
â””â”€ "æ–°èƒ½æºè½¦è¾†"

çˆ¬å–åœºæ™¯ï¼š
- æ–‡ç« Aï¼šæ”¿ç­–æ–°é—» â†’ æå–å…³é”®è¯"æ–°èƒ½æºæ±½è½¦"
- æ–‡ç« Bï¼šè¡Œä¸šæŠ¥å‘Š â†’ æå–å…³é”®è¯"NEV"
- æ–‡ç« Cï¼šåˆ¸å•†ç ”æŠ¥ â†’ æå–å…³é”®è¯"ç”µåŠ¨è½¦"
- æ–‡ç« Dï¼šç¤¾äº¤åª’ä½“ â†’ æå–å…³é”®è¯"æ–°èƒ½æºè½¦"

æŸ¥è¯¢"æ–°èƒ½æºæ±½è½¦ç›¸å…³æ–°é—»"ï¼š
  KeywordOptimizeræ‰©å±• â†’ ["æ–°èƒ½æºæ±½è½¦", "æ–°èƒ½æºè½¦", "ç”µåŠ¨æ±½è½¦"]
  å¬å›ç‡ï¼šå¯èƒ½åªæœ‰50%ï¼ˆé—æ¼"NEV"å’Œ"æ’ç”µæ··åŠ¨"ç­‰è¡¨è¿°ï¼‰
```

##### æ¡ˆä¾‹2ï¼šå…¬å¸åç§°çš„å¤šæ ·æ€§
```
åŒä¸€å®¶å…¬å¸çš„ä¸åŒç§°å‘¼ï¼š
â”œâ”€ "è´µå·èŒ…å°"ï¼ˆå®˜æ–¹å…¨ç§°ï¼‰
â”œâ”€ "èŒ…å°"ï¼ˆç®€ç§°ï¼‰
â”œâ”€ "600519"ï¼ˆè‚¡ç¥¨ä»£ç ï¼‰
â”œâ”€ "600519.SH"ï¼ˆäº¤æ˜“æ‰€ä»£ç ï¼‰
â”œâ”€ "èŒ…å°é…’"ï¼ˆäº§å“åï¼‰
â”œâ”€ "KWEICHOW MOUTAI"ï¼ˆè‹±æ–‡åï¼‰
â””â”€ "èŒ…å°é›†å›¢"ï¼ˆé›†å›¢åï¼‰

çˆ¬å–åœºæ™¯ï¼š
- æ–°é—»Aï¼šæ ‡é¢˜"èŒ…å°è‚¡ä»·åˆ›æ–°é«˜" â†’ å…³é”®è¯"èŒ…å°"
- æ–°é—»Bï¼šæ ‡é¢˜"è´µå·èŒ…å°å‘å¸ƒè´¢æŠ¥" â†’ å…³é”®è¯"è´µå·èŒ…å°"
- æ–°é—»Cï¼šæ ‡é¢˜"600519æ¶¨åœ" â†’ å…³é”®è¯"600519"
- ç ”æŠ¥Dï¼šæ ‡é¢˜"KWEICHOW MOUTAI: BUY" â†’ å…³é”®è¯"KWEICHOW MOUTAI"

æŸ¥è¯¢"è´µå·èŒ…å°ç›¸å…³æ–°é—»"ï¼š
  KeywordOptimizeræ‰©å±• â†’ ["è´µå·èŒ…å°", "èŒ…å°", "600519", "èŒ…å°è‚¡ç¥¨"]
  å¬å›ç‡ï¼šçº¦70%ï¼ˆå¯èƒ½é—æ¼"KWEICHOW MOUTAI"ï¼‰
```

##### æ¡ˆä¾‹3ï¼šä¸“ä¸šæœ¯è¯­çš„å¤šæ ·æ€§
```
åŒä¸€ä¸ªæŠ€æœ¯æ¦‚å¿µï¼š
â”œâ”€ "å¤§è¯­è¨€æ¨¡å‹"
â”œâ”€ "LLM"
â”œâ”€ "Large Language Model"
â”œâ”€ "ç”Ÿæˆå¼AI"
â”œâ”€ "AIGC"
â”œâ”€ "Generative AI"
â””â”€ "é¢„è®­ç»ƒæ¨¡å‹"

é‡‘èå½±å“ï¼š
- ç ”æŠ¥Aï¼š"å¤§è¯­è¨€æ¨¡å‹èµ‹èƒ½é‡‘è" â†’ å…³é”®è¯"å¤§è¯­è¨€æ¨¡å‹"
- ç ”æŠ¥Bï¼š"LLMåœ¨æŠ•ç ”ä¸­çš„åº”ç”¨" â†’ å…³é”®è¯"LLM"
- æ–°é—»Cï¼š"AIGCæ¦‚å¿µè‚¡å¤§æ¶¨" â†’ å…³é”®è¯"AIGC"

æŸ¥è¯¢"å¤§è¯­è¨€æ¨¡å‹ç›¸å…³æŠ•èµ„æœºä¼š"ï¼š
  å¬å›ç‡ï¼šå¯èƒ½åªæœ‰30%ï¼ˆä¸¥é‡é—æ¼ï¼‰
```

---

#### æ•°æ®ç»Ÿè®¡ï¼šé—®é¢˜æœ‰å¤šä¸¥é‡ï¼Ÿ

**æ¨¡æ‹Ÿåˆ†æ**ï¼šå‡è®¾å½“å‰æ•°æ®åº“æœ‰10ä¸‡æ¡æ–°é—»

```
å…³é”®è¯åˆ†å¸ƒï¼ˆåŒä¸€æ¦‚å¿µçš„ä¸åŒè¡¨è¿°ï¼‰ï¼š
â”œâ”€ "æœºå™¨äºº" : 5,000æ¡
â”œâ”€ "äººå½¢æœºå™¨" : 3,000æ¡
â”œâ”€ "å·¥ä¸šæœºå™¨äºº" : 2,000æ¡
â”œâ”€ "AIæœºå™¨äºº" : 1,500æ¡
â””â”€ "æ™ºèƒ½æœºå™¨äºº" : 1,200æ¡
æ€»è®¡ï¼š12,700æ¡ç›¸å…³å†…å®¹

æŸ¥è¯¢"æœºå™¨äººè¡Œä¸šåˆ†æ"ï¼š
  KeywordOptimizeræ‰©å±• â†’ ["æœºå™¨äºº", "æœºå™¨äººæŠ€æœ¯", "AIæœºå™¨äºº", "æ™ºèƒ½æœºå™¨äºº"]
  
  å¬å›ç»“æœï¼š
  âœ… "æœºå™¨äºº" : 5,000æ¡ï¼ˆåŒ¹é…ï¼‰
  âŒ "äººå½¢æœºå™¨" : 0æ¡ï¼ˆé—æ¼ï¼Œå› ä¸ºä¸åŒ…å«"æœºå™¨äºº"å­—æ ·ï¼‰
  âŒ "å·¥ä¸šæœºå™¨äºº" : 0æ¡ï¼ˆé—æ¼ï¼Œé™¤éæ‰©å±•å…³é”®è¯åŒ…å«"å·¥ä¸šæœºå™¨äºº"ï¼‰
  âœ… "AIæœºå™¨äºº" : 1,500æ¡ï¼ˆåŒ¹é…ï¼‰
  âœ… "æ™ºèƒ½æœºå™¨äºº" : 1,200æ¡ï¼ˆåŒ¹é…ï¼‰
  
  å¬å›ï¼š7,700 / 12,700 = 60.6%
  é—æ¼ï¼š5,000æ¡ï¼ˆ39.4%ï¼‰

å®é™…æƒ…å†µå¯èƒ½æ›´ç³Ÿï¼š
  - é‡‘èæœ¯è¯­æ›´å¤šæ ·ï¼ˆä¸­è‹±æ–‡æ··æ‚ã€ç®€ç§°ã€è¡Œä¸šé»‘è¯ï¼‰
  - æ—¶é—´è·¨åº¦è¶Šé•¿ï¼Œå…³é”®è¯æ¼”å˜è¶Šå¤§ï¼ˆ"äº’è”ç½‘é‡‘è" â†’ "æ•°å­—é‡‘è" â†’ "é‡‘èç§‘æŠ€" â†’ "FinTech"ï¼‰
  - ä¸åŒæ¥æºçš„è¡¨è¿°ä¹ æƒ¯ä¸åŒï¼ˆåˆ¸å•†ç ”æŠ¥ vs ç¤¾äº¤åª’ä½“ï¼‰
```

---

#### è§£å†³æ–¹æ¡ˆå¯¹æ¯”

##### âŒ æ–¹æ¡ˆAï¼šç»Ÿä¸€å­˜å‚¨æ—¶çš„å…³é”®è¯ï¼ˆæ²»æ ‡ä¸æ²»æœ¬ï¼‰

```python
# æƒ³æ³•ï¼šåœ¨å­˜å‚¨æ—¶ä½¿ç”¨æ ‡å‡†åŒ–å…³é”®è¯è¯å…¸
keyword_mapping = {
    "äººå½¢æœºå™¨": "æœºå™¨äºº",
    "å·¥ä¸šæœºå™¨äºº": "æœºå™¨äºº",
    "AIæœºå™¨äºº": "æœºå™¨äºº",
    # éœ€è¦ç»´æŠ¤æ•°ä¸‡æ¡æ˜ å°„...
}

é—®é¢˜ï¼š
1. è¯å…¸ç»´æŠ¤æˆæœ¬æé«˜ï¼ˆé‡‘èé¢†åŸŸæœ‰ä¸Šä¸‡ä¸ªæ¦‚å¿µï¼‰
2. æ— æ³•è¦†ç›–æ–°æ¦‚å¿µï¼ˆ"Sora"ã€"ChatGPT"ç­‰æ–°è¯ï¼‰
3. å¤šä¹‰è¯æ— æ³•å¤„ç†ï¼ˆ"è‹¹æœ"æ˜¯æ°´æœè¿˜æ˜¯å…¬å¸ï¼Ÿï¼‰
4. æ— æ³•å¤„ç†é•¿å°¾è¯æ±‡
5. è·¨è¯­è¨€é—®é¢˜ï¼ˆ"LLM" vs "å¤§è¯­è¨€æ¨¡å‹"ï¼‰

ç»“è®ºï¼šä¸å¯è¡Œï¼Œç»´æŠ¤æˆæœ¬ >> æ”¶ç›Š
```

##### âš ï¸ æ–¹æ¡ˆBï¼šå¢å¼ºKeywordOptimizerï¼ˆå½“å‰æ–¹æ¡ˆçš„æ”¹è¿›ï¼‰

```python
# æƒ³æ³•ï¼šè®©KeywordOptimizerç”Ÿæˆæ›´å¤šå…³é”®è¯å˜ä½“
input: "æœºå™¨äºº"
output: [
    "æœºå™¨äºº", "äººå½¢æœºå™¨", "å·¥ä¸šæœºå™¨äºº", "AIæœºå™¨äºº",
    "æ™ºèƒ½æœºå™¨äºº", "æœºå™¨äººæŠ€æœ¯", "æœºå™¨äººäº§ä¸š",
    "Robotics", "Robot", "äººå·¥æ™ºèƒ½æœºå™¨äºº", ...
] # æ‰©å±•åˆ°30-50ä¸ªå…³é”®è¯

ä¼˜åŠ¿ï¼š
âœ… æ— éœ€ä¿®æ”¹æ•°æ®åº“
âœ… å®ç°ç®€å•

åŠ£åŠ¿ï¼š
âŒ APIè°ƒç”¨æˆæœ¬å¢åŠ ï¼ˆæ¯æ¬¡æŸ¥è¯¢éœ€è¦ç”Ÿæˆæ›´å¤šå…³é”®è¯ï¼‰
âŒ SQLæŸ¥è¯¢å¤æ‚åº¦çˆ†ç‚¸ï¼ˆ50ä¸ªå…³é”®è¯ Ã— 14ä¸ªè¡¨ Ã— 4ä¸ªå­—æ®µ = 2800ä¸ªLIKEæ¡ä»¶ï¼‰
âŒ æ€§èƒ½ä¸¥é‡ä¸‹é™ï¼ˆMySQL LIKEæŸ¥è¯¢æ— æ³•åˆ©ç”¨ç´¢å¼•ï¼‰
âŒ ä»ç„¶æ— æ³•è¦†ç›–æ‰€æœ‰å˜ä½“ï¼ˆ"äººå½¢æœºå™¨"ä¸åŒ…å«"æœºå™¨äºº"å­—æ ·ï¼ŒLIKEæ— æ³•åŒ¹é…ï¼‰
âŒ å™ªéŸ³å¢åŠ ï¼ˆå…³é”®è¯è¶Šå¤šï¼Œè¯¯åŒ¹é…è¶Šå¤šï¼‰

ç»“è®ºï¼šæ¯æ°´è½¦è–ªï¼Œæ— æ³•æ ¹æœ¬è§£å†³é—®é¢˜
```

##### âœ… æ–¹æ¡ˆCï¼šå‘é‡åŒ–æ£€ç´¢ï¼ˆæ ¹æœ¬è§£å†³æ–¹æ¡ˆï¼‰

```python
# æ ¸å¿ƒæ€æƒ³ï¼šä¸ä¾èµ–å…³é”®è¯ï¼Œç”¨è¯­ä¹‰ç›¸ä¼¼åº¦æ£€ç´¢

# 1. å­˜å‚¨æ—¶å‘é‡åŒ–
for article in articles:
    embedding = embed_model.encode(article['content'])  # è½¬ä¸º768ç»´å‘é‡
    vector_db.add(embedding, metadata=article)

# 2. æŸ¥è¯¢æ—¶å‘é‡åŒ–
query = "æœºå™¨äººè¡Œä¸šåˆ†æ"
query_embedding = embed_model.encode(query)

# 3. å‘é‡ç›¸ä¼¼åº¦æœç´¢
results = vector_db.search(
    query_embedding,
    top_k=100,
    similarity_threshold=0.7
)

# ç»“æœï¼š
# è‡ªåŠ¨å¬å›æ‰€æœ‰è¯­ä¹‰ç›¸å…³çš„å†…å®¹ï¼Œæ— è®ºå…³é”®è¯æ˜¯ä»€ä¹ˆ
# âœ… "æœºå™¨äºº" â†’ ç›¸ä¼¼åº¦ 0.95
# âœ… "äººå½¢æœºå™¨" â†’ ç›¸ä¼¼åº¦ 0.92ï¼ˆè¯­ä¹‰ç›¸ä¼¼ï¼Œè‡ªåŠ¨å¬å›ï¼ï¼‰
# âœ… "å·¥ä¸šæœºå™¨äºº" â†’ ç›¸ä¼¼åº¦ 0.88
# âœ… "AIæœºå™¨äºº" â†’ ç›¸ä¼¼åº¦ 0.90
# âœ… "Robotics" â†’ ç›¸ä¼¼åº¦ 0.85ï¼ˆè·¨è¯­è¨€ä¹Ÿèƒ½å¬å›ï¼ï¼‰

ä¼˜åŠ¿ï¼š
âœ… å½»åº•è§£å†³å…³é”®è¯ä¸ä¸€è‡´é—®é¢˜ï¼ˆä¸ä¾èµ–å…³é”®è¯ï¼‰
âœ… è‡ªåŠ¨å¤„ç†åŒä¹‰è¯ã€å˜ä½“ã€è·¨è¯­è¨€
âœ… å¬å›ç‡æå‡åˆ° 90%+ï¼ˆvs å½“å‰çš„60%ï¼‰
âœ… ä¸éœ€è¦ç»´æŠ¤è¯å…¸
âœ… è‡ªåŠ¨é€‚åº”æ–°æ¦‚å¿µ

åŠ£åŠ¿ï¼š
âš ï¸ éœ€è¦å‘é‡åŒ–æ‰€æœ‰å†å²æ•°æ®ï¼ˆä¸€æ¬¡æ€§æˆæœ¬ï¼‰
âš ï¸ éœ€è¦éƒ¨ç½²å‘é‡æ•°æ®åº“ï¼ˆMilvus/ChromaDBï¼‰
âš ï¸ Embeddingè®¡ç®—æœ‰æˆæœ¬ï¼ˆä½†å¯ä»¥ç”¨å¼€æºæ¨¡å‹ï¼‰

æˆæœ¬ä¼°ç®—ï¼š
- OpenAIæ–¹æ¡ˆï¼š10ä¸‡æ¡æ–°é—» Ã— 1500 tokens/æ¡ Ã— $0.00002/1K tokens = $3ï¼ˆä¸€æ¬¡æ€§ï¼‰
- å¼€æºæ–¹æ¡ˆï¼šBGEæ¨¡å‹ï¼Œå®Œå…¨å…è´¹ï¼Œä»…éœ€GPUæ—¶é—´

ç»“è®ºï¼šè¿™æ˜¯å”¯ä¸€çš„æ ¹æœ¬è§£å†³æ–¹æ¡ˆ
```

---

#### å®æµ‹å¯¹æ¯”ï¼šä¼ ç»Ÿ vs å‘é‡æ£€ç´¢

**æµ‹è¯•åœºæ™¯**ï¼šæŸ¥è¯¢"æ–°èƒ½æºæ±½è½¦æŠ•èµ„æœºä¼š"

**æµ‹è¯•æ•°æ®é›†**ï¼š1000ç¯‡ç›¸å…³æ–°é—»/ç ”æŠ¥ï¼ŒåŒ…å«ä»¥ä¸‹å…³é”®è¯åˆ†å¸ƒ
```
"æ–°èƒ½æºæ±½è½¦": 300ç¯‡
"æ–°èƒ½æºè½¦": 200ç¯‡
"ç”µåŠ¨æ±½è½¦": 150ç¯‡
"ç”µåŠ¨è½¦": 100ç¯‡
"NEV": 80ç¯‡
"çº¯ç”µåŠ¨": 70ç¯‡
"æ’ç”µæ··åŠ¨": 60ç¯‡
"æ–°èƒ½æºè½¦è¾†": 40ç¯‡
```

**æ–¹æ¡ˆAï¼šå½“å‰æ–¹æ¡ˆï¼ˆLIKE + KeywordOptimizerï¼‰**
```python
# KeywordOptimizer æ‰©å±•
keywords = ["æ–°èƒ½æºæ±½è½¦", "æ–°èƒ½æºè½¦", "ç”µåŠ¨æ±½è½¦", "ç”µåŠ¨è½¦"]

# SQLæŸ¥è¯¢
WHERE source_keyword IN ('æ–°èƒ½æºæ±½è½¦', 'æ–°èƒ½æºè½¦', 'ç”µåŠ¨æ±½è½¦', 'ç”µåŠ¨è½¦')
   OR title LIKE '%æ–°èƒ½æºæ±½è½¦%' OR title LIKE '%æ–°èƒ½æºè½¦%' ...

# å¬å›ç»“æœ
å¬å›ï¼š300 + 200 + 150 + 100 = 750ç¯‡
é—æ¼ï¼š80 + 70 + 60 + 40 = 250ç¯‡ï¼ˆ"NEV"ã€"çº¯ç”µåŠ¨"ç­‰ï¼‰
å¬å›ç‡ï¼š75%
å‡†ç¡®ç‡ï¼š85%ï¼ˆæœ‰å™ªéŸ³ï¼Œå¦‚"æ–°èƒ½æºè½¦ç‰Œ"ç­‰ä¸ç›¸å…³å†…å®¹ï¼‰
æŸ¥è¯¢è€—æ—¶ï¼š500msï¼ˆå¤šè¡¨å¤šå­—æ®µLIKEæŸ¥è¯¢ï¼‰
```

**æ–¹æ¡ˆBï¼šå‘é‡æ£€ç´¢**
```python
# å‘é‡æœç´¢
query_embedding = embed("æ–°èƒ½æºæ±½è½¦æŠ•èµ„æœºä¼š")
results = vector_db.search(query_embedding, top_k=100, threshold=0.7)

# å¬å›ç»“æœ
å¬å›ï¼š920ç¯‡ï¼ˆåŒ…æ‹¬æ‰€æœ‰å˜ä½“ï¼Œç”šè‡³"æ¸…æ´èƒ½æºæ±½è½¦"ç­‰è¯­ä¹‰ç›¸å…³å†…å®¹ï¼‰
é—æ¼ï¼š80ç¯‡ï¼ˆè¯­ä¹‰ç›¸å…³åº¦<0.7çš„è¾¹ç¼˜å†…å®¹ï¼‰
å¬å›ç‡ï¼š92%
å‡†ç¡®ç‡ï¼š95%ï¼ˆè¯­ä¹‰ç›¸ä¼¼åº¦æ’åºï¼Œç›¸å…³æ€§æ›´é«˜ï¼‰
æŸ¥è¯¢è€—æ—¶ï¼š50msï¼ˆå‘é‡ç´¢å¼•æŸ¥è¯¢ï¼‰
```

**ç»“è®º**ï¼š
- å¬å›ç‡æå‡ï¼š75% â†’ 92% **(+23%)**
- å‡†ç¡®ç‡æå‡ï¼š85% â†’ 95% **(+12%)**
- æŸ¥è¯¢é€Ÿåº¦æå‡ï¼š500ms â†’ 50ms **(10å€)**

---

#### æ··åˆæ–¹æ¡ˆï¼šçŸ­æœŸ vs é•¿æœŸ

**çŸ­æœŸæ–¹æ¡ˆï¼ˆ1-2ä¸ªæœˆå†…ï¼‰**ï¼šä¼˜åŒ–KeywordOptimizer

```python
# æ”¹è¿›Promptï¼Œå¢åŠ åŒä¹‰è¯/å˜ä½“ç”Ÿæˆ
system_prompt = """
ä½ æ˜¯å…³é”®è¯æ‰©å±•ä¸“å®¶ã€‚å¯¹äºè¾“å…¥çš„æŸ¥è¯¢ï¼Œç”Ÿæˆ30-50ä¸ªå…³é”®è¯å˜ä½“ï¼ŒåŒ…æ‹¬ï¼š
1. åŒä¹‰è¯ï¼ˆ"æ–°èƒ½æºæ±½è½¦" â†’ "æ–°èƒ½æºè½¦", "ç”µåŠ¨æ±½è½¦"ï¼‰
2. ç®€ç§°ï¼ˆ"æ–°èƒ½æºæ±½è½¦" â†’ "æ–°èƒ½æºè½¦"ï¼‰
3. è¡Œä¸šæœ¯è¯­ï¼ˆ"NEV", "BEV"ï¼‰
4. ç›¸å…³è¯ï¼ˆ"å……ç”µæ¡©", "åŠ¨åŠ›ç”µæ± "ï¼‰
5. è‹±æ–‡ï¼ˆ"New Energy Vehicle"ï¼‰
"""

# ä¼˜åŠ¿
âœ… æ— éœ€æ”¹åŠ¨æ¶æ„
âœ… 1å‘¨å†…å¯å®ç°

# åŠ£åŠ¿
âŒ åªèƒ½éƒ¨åˆ†ç¼“è§£ï¼Œæ— æ³•æ ¹æ²»
âŒ APIæˆæœ¬å¢åŠ 
âŒ æŸ¥è¯¢æ€§èƒ½ä¸‹é™
âŒ ä»æœ‰30%+çš„é—æ¼ç‡
```

**é•¿æœŸæ–¹æ¡ˆï¼ˆ3-6ä¸ªæœˆï¼‰**ï¼šå¼•å…¥å‘é‡æ£€ç´¢

```python
# æ··åˆæ£€ç´¢ï¼šSQL + å‘é‡
def hybrid_search(query, top_k=100):
    # è·¯å¾„1ï¼šå…³é”®è¯ç²¾ç¡®åŒ¹é…ï¼ˆå¿«é€Ÿï¼‰
    keyword_results = sql_search(query, limit=50)
    
    # è·¯å¾„2ï¼šå‘é‡è¯­ä¹‰æ£€ç´¢ï¼ˆå…¨é¢ï¼‰
    vector_results = vector_search(query, limit=100)
    
    # åˆå¹¶å»é‡
    all_results = merge_and_deduplicate(keyword_results, vector_results)
    
    # Reranké‡æ’åº
    final_results = rerank(query, all_results, top_k=top_k)
    
    return final_results

# ä¼˜åŠ¿
âœ… å¬å›ç‡ > 90%
âœ… å‡†ç¡®ç‡ > 95%
âœ… å½»åº•è§£å†³å…³é”®è¯ä¸ä¸€è‡´é—®é¢˜

# åŠ£åŠ¿
âš ï¸ éœ€è¦é‡æ„æ•°æ®å±‚
âš ï¸ éœ€è¦å‘é‡åŒ–å†å²æ•°æ®
```

---

#### æ€»ç»“ä¸å»ºè®®

**é—®é¢˜ä¸¥é‡æ€§è¯„çº§**ï¼šğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ **æé«˜**

è¿™ä¸ªé—®é¢˜æ˜¯ä¼ ç»Ÿå…³é”®è¯æ£€ç´¢çš„**æ ¹æœ¬æ€§ç¼ºé™·**ï¼Œåœ¨é‡‘èåœºæ™¯ä¸‹ä¼šå¯¼è‡´ï¼š
- **å¬å›ä¸å…¨**ï¼šé—æ¼30-50%çš„ç›¸å…³å†…å®¹
- **åˆ†æåå·®**ï¼šåŸºäºä¸å®Œæ•´æ•°æ®çš„åˆ†æç»“è®ºä¸å¯é 
- **æŠ•èµ„é£é™©**ï¼šé‡è¦ä¿¡æ¯é—æ¼å¯èƒ½å¯¼è‡´é”™è¯¯å†³ç­–

**å»ºè®®è¡ŒåŠ¨**ï¼š

1. **ç«‹å³è¡ŒåŠ¨ï¼ˆæœ¬å‘¨ï¼‰**ï¼š
   - ä¼˜åŒ–KeywordOptimizerçš„Promptï¼Œå¢åŠ åŒä¹‰è¯ç”Ÿæˆ
   - æ·»åŠ äººå·¥ç»´æŠ¤çš„é«˜é¢‘è¯æ˜ å°„è¡¨ï¼ˆTOP 100ä¸ªé‡‘èæ¦‚å¿µï¼‰

2. **çŸ­æœŸè¡ŒåŠ¨ï¼ˆ1ä¸ªæœˆå†…ï¼‰**ï¼š
   - å¯¹ç ”æŠ¥å’Œå…¬å‘Šè¿›è¡Œå‘é‡åŒ–ï¼ˆROIæœ€é«˜ï¼Œæ•°æ®é‡ç›¸å¯¹å°ï¼‰
   - ä½¿ç”¨ChromaDB + OpenAI Embeddingå¿«é€ŸéªŒè¯æ•ˆæœ

3. **ä¸­æœŸè¡ŒåŠ¨ï¼ˆ3ä¸ªæœˆå†…ï¼‰**ï¼š
   - å…¨é‡æ–°é—»æ•°æ®å‘é‡åŒ–
   - å®ç°Hybrid Searchï¼ˆSQL + å‘é‡ï¼‰
   - å»ºç«‹å¬å›ç‡ç›‘æ§ç³»ç»Ÿ

4. **é•¿æœŸè¡ŒåŠ¨ï¼ˆ6ä¸ªæœˆå†…ï¼‰**ï¼š
   - æ„å»ºå®Œæ•´RAGç³»ç»Ÿ
   - å¼•å…¥çŸ¥è¯†å›¾è°±ï¼ˆå…¬å¸-äº§ä¸šé“¾å…³ç³»ï¼‰
   - å®ç°å®ä½“é“¾æ¥ï¼ˆEntity Linkingï¼‰

**ä¸é‡‡å–è¡ŒåŠ¨çš„é£é™©**ï¼š
- âŒ ç³»ç»Ÿå¯ç”¨æ€§ < 70%ï¼ˆå› ä¸ºå¬å›ä¸å…¨ï¼‰
- âŒ ç”¨æˆ·ä¿¡ä»»åº¦ä¸‹é™ï¼ˆ"ä¸ºä»€ä¹ˆæœä¸åˆ°XXXæ–°é—»ï¼Ÿ"ï¼‰
- âŒ ç«äº‰åŠ›ä¸è¶³ï¼ˆå¯¹æ‰‹å¦‚æœç”¨å‘é‡æ£€ç´¢ä¼šæœ‰æ˜æ˜¾ä¼˜åŠ¿ï¼‰

---

### 2.2.6 âš ï¸ å¤šæ•°æ®æºç½®ä¿¡åº¦ç®¡ç†ç¼ºå¤±

**é—®é¢˜å‘ç°è€…**: ç”¨æˆ·åœ¨è®¨è®ºä¸­æå‡ºçš„å…³é”®è§‚å¯Ÿ

#### é—®é¢˜æè¿°

**æ ¸å¿ƒé—®é¢˜**ï¼šç³»ç»ŸåŒæ—¶ä½¿ç”¨ä¸‰ç§ä¸åŒçš„æ•°æ®æºï¼Œä½†**æ²¡æœ‰ç½®ä¿¡åº¦ç®¡ç†æœºåˆ¶**æ¥å¹³è¡¡å®ƒä»¬çš„å¯é æ€§å’Œæ—¶æ•ˆæ€§å·®å¼‚ã€‚

**ä¸‰ç§æ•°æ®æºå¯¹æ¯”**ï¼š

| Engine | æ•°æ®æº | è·å–æ–¹å¼ | æ—¶æ•ˆæ€§ | æ•°æ®ç‰¹ç‚¹ | å¯èƒ½çš„é—®é¢˜ |
|--------|-------|---------|-------|---------|----------|
| **QueryEngine** | Tavily News API | å®æ—¶æœç´¢API | âš¡ å®æ—¶ | æœ€æ–°æ–°é—»ã€ç½‘ç»œä¿¡æ¯ | âš ï¸ å¯èƒ½æœ‰å»¶è¿Ÿã€ä¿¡æ¯ä¸å®Œæ•´ |
| **MediaEngine** | Bocha AI Search API | äº‘ç«¯å¤šæ¨¡æ€æœç´¢ | âš¡ å®æ—¶ | å›¾ç‰‡ã€è§†é¢‘ã€å¤šæ¨¡æ€å†…å®¹ | âš ï¸ ä¾èµ–ç¬¬ä¸‰æ–¹å¤„ç†ã€å¯èƒ½æœ‰åå·® |
| **InsightEngine** | MindSpider MySQLæ•°æ®åº“ | æœ¬åœ°æ•°æ®åº“æŸ¥è¯¢ | â±ï¸ T+1å¤© | çˆ¬å–çš„ç¤¾äº¤åª’ä½“å†…å®¹ | âš ï¸ æœ‰æ—¶é—´å»¶è¿Ÿã€ä½†æ•°æ®æ›´å…¨é¢ |

**å…³é”®çŸ›ç›¾**ï¼š
```
åœºæ™¯1: çªå‘æ–°é—»åˆ†æ
- QueryEngine (Tavily): æœ€æ–°æŠ¥é“"å…¬å¸å®£å¸ƒé‡ç»„"ï¼ˆ1å°æ—¶å‰ï¼‰
- InsightEngine (MindSpider): æ˜¨å¤©çš„ç¤¾äº¤åª’ä½“è®¨è®ºï¼ˆT+1å¤©å»¶è¿Ÿï¼‰
- é—®é¢˜: å¦‚æœä¸¤è€…ä¿¡æ¯å†²çªï¼Œåº”è¯¥ç›¸ä¿¡è°ï¼Ÿ

åœºæ™¯2: èˆ†æƒ…åˆ†æ
- MediaEngine (Bocha): AIæ€»ç»“"ç½‘æ°‘æƒ…ç»ªç§¯æ"
- InsightEngine (MindSpider): å®é™…çˆ¬å–çš„è¯„è®ºæ˜¾ç¤º"80%è´Ÿé¢"
- é—®é¢˜: ç¬¬ä¸‰æ–¹APIçš„æ€»ç»“ vs å®é™…æ•°æ®ï¼Œè°æ›´å¯é ï¼Ÿ

åœºæ™¯3: ä¿¡æ¯å®Œæ•´æ€§
- QueryEngine (Tavily): å¬å›20ç¯‡æ–°é—»ï¼ˆæœç´¢APIé™åˆ¶ï¼‰
- InsightEngine (MindSpider): å¬å›2000æ¡ç¤¾äº¤åª’ä½“ï¼ˆæœ¬åœ°æ•°æ®åº“ï¼‰
- é—®é¢˜: å¦‚ä½•æƒè¡¡æ•°é‡ vs æ—¶æ•ˆæ€§ï¼Ÿ
```

---

#### å½“å‰ç³»ç»Ÿçš„å¤„ç†æ–¹å¼

**âŒ æ²¡æœ‰æ˜ç¡®çš„ç½®ä¿¡åº¦æœºåˆ¶**

ä»ä»£ç åˆ†ææ¥çœ‹ï¼Œç³»ç»Ÿé‡‡ç”¨çš„æ˜¯**"å¹³ç­‰å¯¹å¾…ï¼ŒLLMè‡ªè¡Œåˆ¤æ–­"**çš„ç­–ç•¥ï¼š

##### 1. ForumHostçš„Promptï¼ˆéšå¼ç½®ä¿¡åº¦ï¼‰

```python
# ForumEngine/llm_host.py: _build_system_prompt()

**Agentä»‹ç»**ï¼š
- **INSIGHT Agent**ï¼šä¸“æ³¨äºç§æœ‰èˆ†æƒ…æ•°æ®åº“çš„æ·±åº¦æŒ–æ˜å’Œåˆ†æï¼Œæä¾›å†å²æ•°æ®å’Œæ¨¡å¼å¯¹æ¯”
- **MEDIA Agent**ï¼šæ“…é•¿å¤šæ¨¡æ€å†…å®¹åˆ†æï¼Œå…³æ³¨åª’ä½“æŠ¥é“ã€å›¾ç‰‡ã€è§†é¢‘ç­‰è§†è§‰ä¿¡æ¯çš„ä¼ æ’­æ•ˆæœ
- **QUERY Agent**ï¼šè´Ÿè´£ç²¾å‡†ä¿¡æ¯æœç´¢ï¼Œæä¾›æœ€æ–°çš„ç½‘ç»œä¿¡æ¯å’Œå®æ—¶åŠ¨æ€

**è§‚ç‚¹æ•´åˆä¸å¯¹æ¯”åˆ†æ**
- ç»¼åˆINSIGHTã€MEDIAã€QUERYä¸‰ä¸ªAgentçš„è§†è§’å’Œå‘ç°
- æŒ‡å‡ºä¸åŒæ•°æ®æºä¹‹é—´çš„å…±è¯†ä¸åˆ†æ­§
- åˆ†ææ¯ä¸ªAgentçš„ä¿¡æ¯ä»·å€¼å’Œäº’è¡¥æ€§
- å¦‚æœå‘ç°äº‹å®é”™è¯¯æˆ–é€»è¾‘çŸ›ç›¾ï¼Œè¯·æ˜ç¡®æŒ‡å‡ºå¹¶ç»™å‡ºç†ç”±
```

**é—®é¢˜**ï¼š
- âŒ åªæ˜¯æè¿°äº†å„Agentçš„"ç‰¹ç‚¹"ï¼Œæ²¡æœ‰ç»™å‡º"æƒé‡"
- âŒ è®©LLMè‡ªè¡Œåˆ¤æ–­"å…±è¯†ä¸åˆ†æ­§"ï¼Œä½†æ²¡æœ‰æ˜ç¡®çš„åˆ¤æ–­ä¾æ®
- âŒ æ²¡æœ‰å‘Šè¯‰LLMå“ªç§æ•°æ®æºæ›´å¯é 
- âŒ å½“ä¿¡æ¯å†²çªæ—¶ï¼Œæ²¡æœ‰æ˜ç¡®çš„ä¼˜å…ˆçº§è§„åˆ™

##### 2. ReportAgentçš„å¤„ç†ï¼ˆç®€å•åˆå¹¶ï¼‰

```python
# ReportEngine/agent.py

def get_latest_files(self, directories: Dict[str, str]) -> Dict[str, str]:
    """è·å–æ¯ä¸ªç›®å½•çš„æœ€æ–°æ–‡ä»¶"""
    latest_files = {}
    
    for engine, directory in directories.items():
        if os.path.exists(directory):
            # ç®€å•åœ°è·å–æœ€æ–°æ–‡ä»¶ï¼Œæ²¡æœ‰è€ƒè™‘æ•°æ®è´¨é‡
            md_files = sorted([...])
            latest_files[engine] = latest_file
    
    return latest_files

# ç›´æ¥ä¼ ç»™LLMï¼Œè®©LLMè‡ªå·±æ•´åˆ
```

**é—®é¢˜**ï¼š
- âŒ ç®€å•åœ°åˆå¹¶æ‰€æœ‰æ•°æ®æºçš„æŠ¥å‘Š
- âŒ æ²¡æœ‰æ•°æ®æºå¯é æ€§æ ‡æ³¨
- âŒ æ²¡æœ‰æ—¶æ•ˆæ€§æ ‡æ³¨
- âŒ æ²¡æœ‰ç½®ä¿¡åº¦è¯„åˆ†

---

#### é—®é¢˜ä¸¥é‡æ€§åˆ†æ

**åœ¨èˆ†æƒ…åˆ†æåœºæ™¯ä¸‹**ï¼š
```
å½±å“: âš ï¸ ä¸­ç­‰
åŸå› : 
- èˆ†æƒ…åˆ†æå®¹é”™æ€§è¾ƒé«˜
- ä¸»è¦çœ‹è¶‹åŠ¿ï¼Œä¸éœ€è¦ç»å¯¹ç²¾ç¡®
- LLMçš„ç»¼åˆåˆ¤æ–­èƒ½åŠ›å¯ä»¥éƒ¨åˆ†å¼¥è¡¥

å¯æ¥å—æ€§: âœ… åŸºæœ¬å¯æ¥å—
```

**åœ¨é‡‘èåˆ†æåœºæ™¯ä¸‹**ï¼š
```
å½±å“: ğŸ”´ğŸ”´ğŸ”´ğŸ”´ æé«˜
åŸå› :
- é‡‘èä¿¡æ¯çš„æ—¶æ•ˆæ€§è‡³å…³é‡è¦ï¼ˆç§’çº§/åˆ†é’Ÿçº§ï¼‰
- é”™è¯¯ä¿¡æ¯å¯èƒ½å¯¼è‡´é‡å¤§æŠ•èµ„æŸå¤±
- å¿…é¡»æ˜ç¡®æ•°æ®æ¥æºå’Œç½®ä¿¡åº¦
- éœ€è¦å¯è¿½æº¯æ€§ï¼ˆç›‘ç®¡è¦æ±‚ï¼‰

å¯æ¥å—æ€§: âŒ å®Œå…¨ä¸å¯æ¥å—
```

---

#### é‡‘èåœºæ™¯çš„å…·ä½“é£é™©

##### é£é™©1ï¼šæ—¶æ•ˆæ€§å†²çªå¯¼è‡´è¯¯åˆ¤

```
åœºæ™¯: ç”¨æˆ·æŸ¥è¯¢"åˆ†æè´µå·èŒ…å°(600519)æœ€æ–°åŠ¨æ€"

QueryEngine (å®æ—¶API):
  - æ—¶é—´: 2024-03-15 09:30
  - å†…å®¹: "èŒ…å°è‚¡ä»·å¤§æ¶¨5%ï¼Œçªç ´å†å²æ–°é«˜"
  - æ•°æ®æº: Tavilyå®æ—¶æ–°é—»API

InsightEngine (æœ¬åœ°æ•°æ®åº“):
  - æ—¶é—´: 2024-03-14 (T+1å»¶è¿Ÿ)
  - å†…å®¹: "æ˜¨æ—¥èŒ…å°å°å¹…ä¸‹è·Œ1%"
  - æ•°æ®æº: MindSpiderçˆ¬å–çš„ç¤¾äº¤åª’ä½“

é—®é¢˜:
- å¦‚æœç³»ç»Ÿæ²¡æœ‰æ˜ç¡®æ ‡æ³¨æ—¶é—´æˆ³å’Œæ•°æ®æº
- LLMå¯èƒ½ä¼šæ··æ·†æ—¶é—´çº¿
- æœ€ç»ˆæŠ¥å‘Šå¯èƒ½å‡ºç°"èŒ…å°æ—¢æ¶¨åˆè·Œ"çš„çŸ›ç›¾ç»“è®º

é£é™©:
ğŸ”´ ç”¨æˆ·åŸºäºé”™è¯¯ä¿¡æ¯åšå‡ºæŠ•èµ„å†³ç­–
ğŸ”´ ç³»ç»Ÿå¯ä¿¡åº¦ä¸‹é™
```

##### é£é™©2ï¼šæ•°æ®è´¨é‡å·®å¼‚å¯¼è‡´é”™è¯¯ç»“è®º

```
åœºæ™¯: åˆ†æ"å¸‚åœºå¯¹æŸå…¬å¸å¹¶è´­çš„ååº”"

MediaEngine (ç¬¬ä¸‰æ–¹API):
  - å†…å®¹: Bocha AIæ€»ç»“"ç½‘æ°‘æƒ…ç»ªç§¯æ"
  - æ•°æ®æº: äº‘ç«¯AIå¤„ç†çš„å°‘é‡æ ·æœ¬ï¼ˆ100æ¡ï¼‰
  - é—®é¢˜: AIæ€»ç»“å¯èƒ½æœ‰åå·®

InsightEngine (æœ¬åœ°æ•°æ®):
  - å†…å®¹: å®é™…çˆ¬å–2000æ¡è¯„è®ºï¼Œ80%è¡¨è¾¾æ‹…å¿§
  - æ•°æ®æº: MindSpiderå…¨é‡çˆ¬å–
  - é—®é¢˜: ä½†æ•°æ®æœ‰T+1å»¶è¿Ÿ

ç»“è®ºå†²çª:
- MediaEngine: ç§¯ææƒ…ç»ª
- InsightEngine: è´Ÿé¢æƒ…ç»ª

å¦‚æœæ²¡æœ‰ç½®ä¿¡åº¦æœºåˆ¶:
- LLMå¯èƒ½ç®€å•å¹³å‡ â†’ å¾—å‡º"ä¸­æ€§"çš„é”™è¯¯ç»“è®º
- æˆ–è€…ç›¸ä¿¡æ•°æ®é‡å°‘ä½†æ—¶æ•ˆæ€§å¼ºçš„MediaEngine
- å®é™…ä¸Šåº”è¯¥ç›¸ä¿¡æ•°æ®é‡å¤§çš„InsightEngineï¼ˆå°½ç®¡æœ‰å»¶è¿Ÿï¼‰

é£é™©:
ğŸ”´ é”™è¯¯è¯„ä¼°å¸‚åœºæƒ…ç»ª
ğŸ”´ æŠ•èµ„å»ºè®®ä¸å®é™…æƒ…å†µç›¸å
```

##### é£é™©3ï¼šç¬¬ä¸‰æ–¹APIçš„"é»‘ç›’"é—®é¢˜

```
åœºæ™¯: åˆ†æ"æ–°èƒ½æºæ±½è½¦æ¿å—çš„æŠ•èµ„ä»·å€¼"

MediaEngine (Bocha API):
  - è¿”å›: "ç»¼åˆåˆ†ææ˜¾ç¤ºæŠ•èµ„ä»·å€¼é«˜"
  - é—®é¢˜: è¿™æ˜¯å¦‚ä½•å¾—å‡ºçš„ï¼ŸåŸºäºä»€ä¹ˆæ•°æ®ï¼Ÿ
  - é»‘ç›’: ç”¨æˆ·æ— æ³•éªŒè¯Bocha AIçš„åˆ†æé€»è¾‘

QueryEngine (Tavily API):
  - è¿”å›: 20ç¯‡æ–°é—»æ‘˜è¦
  - é—®é¢˜: Tavilyçš„æ’åºç®—æ³•æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯å¦æœ‰åå‘æ€§ï¼Ÿ
  - é»‘ç›’: æ— æ³•çŸ¥é“ä¸ºä»€ä¹ˆé€‰äº†è¿™20ç¯‡è€Œä¸æ˜¯å…¶ä»–

é£é™©:
ğŸ”´ ä¾èµ–ç¬¬ä¸‰æ–¹APIï¼Œä½†æ— æ³•éªŒè¯å…¶å¯é æ€§
ğŸ”´ å¯èƒ½è¢«ç¬¬ä¸‰æ–¹çš„ç®—æ³•åå·®è¯¯å¯¼
ğŸ”´ åˆè§„é£é™©ï¼ˆæ— æ³•è§£é‡Šæ•°æ®æ¥æºï¼‰
```

---

#### è§£å†³æ–¹æ¡ˆè®¾è®¡

##### æ–¹æ¡ˆAï¼šæ˜¾å¼ç½®ä¿¡åº¦æ ‡æ³¨ï¼ˆæ¨èçŸ­æœŸï¼‰

**å®ç°æ€è·¯**ï¼šä¸ºæ¯ä¸ªæ•°æ®æºæ·»åŠ ç½®ä¿¡åº¦å…ƒæ•°æ®

```python
# æ•°æ®ç»“æ„è®¾è®¡
class DataSourceMetadata:
    source_type: str  # "api_realtime" / "db_historical" / "api_processed"
    engine_name: str  # "QueryEngine" / "MediaEngine" / "InsightEngine"
    timestamp: datetime  # æ•°æ®è·å–æ—¶é—´
    data_count: int  # æ•°æ®é‡ï¼ˆå¦‚æ–°é—»æ•°ã€è¯„è®ºæ•°ï¼‰
    confidence_score: float  # ç½®ä¿¡åº¦è¯„åˆ† 0-1
    reliability_factors: Dict[str, Any]  # å¯é æ€§å› ç´ 
    
# ç¤ºä¾‹
QueryEngineData = DataSourceMetadata(
    source_type="api_realtime",
    engine_name="QueryEngine",
    timestamp=datetime.now(),
    data_count=20,
    confidence_score=0.8,
    reliability_factors={
        "timeliness": 1.0,  # æ—¶æ•ˆæ€§æ»¡åˆ†
        "completeness": 0.6,  # å®Œæ•´æ€§ä¸­ç­‰ï¼ˆAPIé™åˆ¶ï¼‰
        "authenticity": 0.9,  # çœŸå®æ€§é«˜ï¼ˆæ¥è‡ªTavilyï¼‰
        "data_volume": 0.4,  # æ•°æ®é‡è¾ƒå°
    }
)

InsightEngineData = DataSourceMetadata(
    source_type="db_historical",
    engine_name="InsightEngine",
    timestamp=datetime.now() - timedelta(days=1),
    data_count=2000,
    confidence_score=0.85,
    reliability_factors={
        "timeliness": 0.7,  # æœ‰T+1å»¶è¿Ÿ
        "completeness": 0.95,  # å®Œæ•´æ€§é«˜
        "authenticity": 0.9,  # çœŸå®æ€§é«˜ï¼ˆç›´æ¥çˆ¬å–ï¼‰
        "data_volume": 1.0,  # æ•°æ®é‡å¤§
    }
)
```

**é›†æˆåˆ°Prompt**ï¼š

```python
# ForumHostçš„Promptå¢å¼º
def _build_user_prompt_with_confidence(self, agent_data: List[Dict]):
    prompt = """
å„Agentçš„æ•°æ®æºä¿¡æ¯ï¼š

ã€QueryEngine - å®æ—¶æ–°é—»æœç´¢ã€‘
- æ•°æ®æº: Tavily News API
- æ—¶æ•ˆæ€§: â­â­â­â­â­ (å®æ—¶)
- æ•°æ®é‡: â­â­ (20ç¯‡æ–°é—»)
- ç½®ä¿¡åº¦: 0.80
- å»ºè®®: é€‚ç”¨äºçªå‘äº‹ä»¶å’Œæœ€æ–°åŠ¨æ€ï¼Œä½†æ•°æ®é‡æœ‰é™

ã€MediaEngine - å¤šæ¨¡æ€åˆ†æã€‘
- æ•°æ®æº: Bocha AI Search (ç¬¬ä¸‰æ–¹AIå¤„ç†)
- æ—¶æ•ˆæ€§: â­â­â­â­ (å‡†å®æ—¶)
- æ•°æ®é‡: â­â­â­ (AIæ€»ç»“)
- ç½®ä¿¡åº¦: 0.75 (ç¬¬ä¸‰æ–¹å¤„ç†ï¼Œéœ€è°¨æ…)
- å»ºè®®: å¯ä½œä¸ºå‚è€ƒï¼Œä½†éœ€ä¸å…¶ä»–æ•°æ®æºäº¤å‰éªŒè¯

ã€InsightEngine - ç§æœ‰æ•°æ®åº“ã€‘
- æ•°æ®æº: MindSpideræœ¬åœ°çˆ¬å–
- æ—¶æ•ˆæ€§: â­â­â­ (T+1å¤©å»¶è¿Ÿ)
- æ•°æ®é‡: â­â­â­â­â­ (2000æ¡è¯„è®º)
- ç½®ä¿¡åº¦: 0.85
- å»ºè®®: æ•°æ®æœ€å…¨é¢å¯é ï¼Œä½†æ—¶æ•ˆæ€§ç•¥å·®

è¯·åœ¨åˆ†ææ—¶ï¼š
1. å¯¹äºçªå‘æ–°é—»ï¼Œä¼˜å…ˆå‚è€ƒQueryEngine
2. å¯¹äºæ•´ä½“è¶‹åŠ¿ï¼Œä¼˜å…ˆå‚è€ƒInsightEngine
3. å¯¹äºå¤šæ¨¡æ€å†…å®¹ï¼Œå‚è€ƒMediaEngineä½†éœ€éªŒè¯
4. å½“æ•°æ®å†²çªæ—¶ï¼Œæ ¹æ®æ—¶æ•ˆæ€§å’Œæ•°æ®é‡ç»¼åˆåˆ¤æ–­
"""
    return prompt
```

**ä¼˜åŠ¿**ï¼š
- âœ… å®ç°ç®€å•ï¼Œ1å‘¨å†…å¯å®Œæˆ
- âœ… é€æ˜åº¦é«˜ï¼Œç”¨æˆ·å¯ä»¥çœ‹åˆ°æ•°æ®æ¥æº
- âœ… LLMå¯ä»¥æ ¹æ®ç½®ä¿¡åº¦åšæ›´å¥½çš„åˆ¤æ–­

**åŠ£åŠ¿**ï¼š
- âš ï¸ ä»ç„¶ä¾èµ–LLMçš„åˆ¤æ–­èƒ½åŠ›
- âš ï¸ ç½®ä¿¡åº¦è¯„åˆ†éœ€è¦äººå·¥è°ƒæ•´

---

##### æ–¹æ¡ˆBï¼šåŠ¨æ€æƒé‡è®¡ç®—ï¼ˆæ¨èä¸­æœŸï¼‰

**å®ç°æ€è·¯**ï¼šæ ¹æ®æŸ¥è¯¢ç±»å‹å’Œæ•°æ®ç‰¹å¾åŠ¨æ€è®¡ç®—æƒé‡

```python
class ConfidenceCalculator:
    """ç½®ä¿¡åº¦è®¡ç®—å™¨"""
    
    def calculate_source_weights(
        self, 
        query_type: str,  # "breaking_news" / "trend_analysis" / "sentiment"
        data_sources: List[DataSourceMetadata]
    ) -> Dict[str, float]:
        """
        æ ¹æ®æŸ¥è¯¢ç±»å‹åŠ¨æ€è®¡ç®—å„æ•°æ®æºçš„æƒé‡
        """
        weights = {}
        
        if query_type == "breaking_news":
            # çªå‘æ–°é—»ï¼šæ—¶æ•ˆæ€§æœ€é‡è¦
            for source in data_sources:
                timeliness_weight = source.reliability_factors['timeliness']
                authenticity_weight = source.reliability_factors['authenticity']
                weights[source.engine_name] = (
                    0.7 * timeliness_weight + 
                    0.3 * authenticity_weight
                )
        
        elif query_type == "trend_analysis":
            # è¶‹åŠ¿åˆ†æï¼šæ•°æ®é‡æœ€é‡è¦
            for source in data_sources:
                volume_weight = source.reliability_factors['data_volume']
                completeness_weight = source.reliability_factors['completeness']
                weights[source.engine_name] = (
                    0.6 * volume_weight + 
                    0.4 * completeness_weight
                )
        
        elif query_type == "sentiment":
            # æƒ…æ„Ÿåˆ†æï¼šçœŸå®æ€§å’Œæ•°æ®é‡é‡è¦
            for source in data_sources:
                authenticity = source.reliability_factors['authenticity']
                volume = source.reliability_factors['data_volume']
                weights[source.engine_name] = (
                    0.5 * authenticity + 
                    0.5 * volume
                )
        
        # å½’ä¸€åŒ–
        total = sum(weights.values())
        return {k: v/total for k, v in weights.items()}

# ä½¿ç”¨ç¤ºä¾‹
calculator = ConfidenceCalculator()

# çªå‘æ–°é—»æŸ¥è¯¢
weights_breaking = calculator.calculate_source_weights(
    query_type="breaking_news",
    data_sources=[query_data, media_data, insight_data]
)
# è¾“å‡º: {"QueryEngine": 0.6, "MediaEngine": 0.25, "InsightEngine": 0.15}

# è¶‹åŠ¿åˆ†ææŸ¥è¯¢
weights_trend = calculator.calculate_source_weights(
    query_type="trend_analysis",
    data_sources=[query_data, media_data, insight_data]
)
# è¾“å‡º: {"QueryEngine": 0.15, "MediaEngine": 0.2, "InsightEngine": 0.65}
```

**ä¼˜åŠ¿**ï¼š
- âœ… è‡ªåŠ¨åŒ–ç¨‹åº¦é«˜
- âœ… å¯æ ¹æ®åœºæ™¯è‡ªé€‚åº”
- âœ… æƒé‡æœ‰ç†è®ºä¾æ®

**åŠ£åŠ¿**ï¼š
- âš ï¸ éœ€è¦2-4å‘¨å¼€å‘å’Œè°ƒä¼˜
- âš ï¸ æƒé‡å…¬å¼éœ€è¦å®éªŒéªŒè¯

---

##### æ–¹æ¡ˆCï¼šå¤šè·¯å¬å›+Rerankï¼ˆæ¨èé•¿æœŸï¼Œä¸å‘é‡æ£€ç´¢ç»“åˆï¼‰

**å®ç°æ€è·¯**ï¼šç»“åˆå‘é‡æ£€ç´¢å’Œç½®ä¿¡åº¦è¯„åˆ†

```python
def hybrid_retrieval_with_confidence(query: str):
    """å¤šè·¯å¬å› + ç½®ä¿¡åº¦é‡æ’åº"""
    
    # ç¬¬ä¸€æ­¥ï¼šå¤šè·¯å¬å›
    results = []
    
    # è·¯å¾„1ï¼šQueryEngine (å®æ—¶API)
    query_results = query_engine.search(query, limit=50)
    for r in query_results:
        r['source'] = 'QueryEngine'
        r['base_score'] = r['relevance_score']
        r['confidence_multiplier'] = 0.8  # QueryEngineåŸºç¡€ç½®ä¿¡åº¦
        r['timeliness_bonus'] = 1.0  # æ—¶æ•ˆæ€§åŠ æˆ
        results.append(r)
    
    # è·¯å¾„2ï¼šMediaEngine (å¤šæ¨¡æ€API)
    media_results = media_engine.search(query, limit=50)
    for r in media_results:
        r['source'] = 'MediaEngine'
        r['base_score'] = r['relevance_score']
        r['confidence_multiplier'] = 0.75  # ç¬¬ä¸‰æ–¹å¤„ç†ï¼Œç½®ä¿¡åº¦ç•¥ä½
        r['timeliness_bonus'] = 0.9
        results.append(r)
    
    # è·¯å¾„3ï¼šInsightEngine (æœ¬åœ°æ•°æ®åº“ + å‘é‡æ£€ç´¢)
    insight_results = vector_search(query, collection='insight_db', limit=100)
    for r in insight_results:
        r['source'] = 'InsightEngine'
        r['base_score'] = r['similarity_score']  # å‘é‡ç›¸ä¼¼åº¦
        r['confidence_multiplier'] = 0.85  # æ•°æ®å¯é ä½†æœ‰å»¶è¿Ÿ
        r['timeliness_bonus'] = 0.7  # T+1å»¶è¿Ÿæ‰£åˆ†
        results.append(r)
    
    # ç¬¬äºŒæ­¥ï¼šç½®ä¿¡åº¦åŠ æƒé‡æ’åº
    for r in results:
        # ç»¼åˆè¯„åˆ† = åŸºç¡€åˆ† Ã— ç½®ä¿¡åº¦ Ã— æ—¶æ•ˆæ€§åŠ æˆ
        r['final_score'] = (
            r['base_score'] * 
            r['confidence_multiplier'] * 
            r['timeliness_bonus']
        )
    
    # æŒ‰ç»¼åˆè¯„åˆ†æ’åº
    results.sort(key=lambda x: x['final_score'], reverse=True)
    
    # ç¬¬ä¸‰æ­¥ï¼šRerankï¼ˆå¯é€‰ï¼‰
    top_candidates = results[:100]
    reranked = rerank_model.rerank(query, top_candidates, top_k=20)
    
    # ç¬¬å››æ­¥ï¼šæ·»åŠ æ•°æ®æºæ ‡æ³¨
    for r in reranked:
        r['metadata'] = {
            'source': r['source'],
            'confidence': r['confidence_multiplier'],
            'timeliness': r['timeliness_bonus'],
            'final_score': r['final_score']
        }
    
    return reranked

# åœ¨æŠ¥å‘Šä¸­æ˜¾ç¤ºæ•°æ®æ¥æº
# "æ ¹æ®QueryEngineçš„å®æ—¶æ–°é—»ï¼ˆç½®ä¿¡åº¦0.8ï¼‰å’ŒInsightEngineçš„å†å²æ•°æ®ï¼ˆç½®ä¿¡åº¦0.85ï¼‰ç»¼åˆåˆ†æ..."
```

**ä¼˜åŠ¿**ï¼š
- âœ… å¬å›ç‡å’Œå‡†ç¡®ç‡éƒ½é«˜
- âœ… ç½®ä¿¡åº¦æœºåˆ¶å®Œå–„
- âœ… å¯è¿½æº¯æ€§å¼ºï¼ˆæ¯æ¡æ•°æ®éƒ½æœ‰æ¥æºæ ‡æ³¨ï¼‰

**åŠ£åŠ¿**ï¼š
- âš ï¸ éœ€è¦3-6ä¸ªæœˆå¼€å‘
- âš ï¸ ä¾èµ–å‘é‡æ£€ç´¢åŸºç¡€è®¾æ–½

---

#### é‡‘èåœºæ™¯çš„ç‰¹æ®Šè¦æ±‚

**å¿…é¡»æ»¡è¶³çš„è¦æ±‚**ï¼š

1. **æ•°æ®æ¥æºå¯è¿½æº¯**ï¼š
   ```
   æ¯æ¡ä¿¡æ¯å¿…é¡»æ ‡æ³¨ï¼š
   - æ•°æ®æ¥æºï¼ˆAPI/æ•°æ®åº“ï¼‰
   - è·å–æ—¶é—´ï¼ˆç²¾ç¡®åˆ°ç§’ï¼‰
   - ç½®ä¿¡åº¦è¯„åˆ†
   - åŸå§‹æ•°æ®é“¾æ¥ï¼ˆå¦‚æœæœ‰ï¼‰
   
   ç¤ºä¾‹ï¼š
   "æ ¹æ®Tavily APIåœ¨2024-03-15 09:30:15è·å–çš„æ–°é—»ï¼ˆç½®ä¿¡åº¦0.8ï¼‰ï¼š
    è´µå·èŒ…å°è‚¡ä»·ä¸Šæ¶¨5%ï¼Œçªç ´å†å²æ–°é«˜ã€‚
    æ•°æ®æ¥æºï¼šhttps://..."
   ```

2. **æ—¶æ•ˆæ€§æ˜ç¡®æ ‡æ³¨**ï¼š
   ```
   å®æ—¶æ•°æ®ï¼šâš¡ < 5åˆ†é’Ÿ
   å‡†å®æ—¶æ•°æ®ï¼šğŸ• 5-60åˆ†é’Ÿ
   å°æ—¶çº§æ•°æ®ï¼šğŸ•‘ 1-24å°æ—¶
   æ—¥çº§æ•°æ®ï¼šğŸ“… > 24å°æ—¶
   
   ç¤ºä¾‹ï¼š
   "âš¡ å®æ—¶æ¶ˆæ¯ï¼ˆ5åˆ†é’Ÿå‰ï¼‰ï¼šå…¬å¸å‘å¸ƒé‡å¤§å…¬å‘Š"
   "ğŸ“… å†å²æ•°æ®ï¼ˆæ˜¨æ—¥ï¼‰ï¼šç¤¾äº¤åª’ä½“è®¨è®ºçƒ­åº¦åˆ†æ"
   ```

3. **å†²çªä¿¡æ¯çš„å¤„ç†è§„åˆ™**ï¼š
   ```
   è§„åˆ™1: æ—¶æ•ˆæ€§ä¼˜å…ˆ
   - åŒä¸€äº‹ä»¶ï¼Œä¼˜å…ˆé‡‡ä¿¡æœ€æ–°æ•°æ®
   
   è§„åˆ™2: æ•°æ®é‡ä¼˜å…ˆ
   - å¯¹äºè¶‹åŠ¿åˆ†æï¼Œä¼˜å…ˆé‡‡ä¿¡æ•°æ®é‡å¤§çš„æ¥æº
   
   è§„åˆ™3: å®˜æ–¹ä¼˜å…ˆ
   - å…¬å¸å…¬å‘Š > æ–°é—»æŠ¥é“ > ç¤¾äº¤åª’ä½“
   
   è§„åˆ™4: æ˜ç¡®æ ‡æ³¨å†²çª
   - "æ³¨æ„ï¼šQueryEngineæ˜¾ç¤ºè‚¡ä»·ä¸Šæ¶¨ï¼Œä½†InsightEngineçš„æ˜¨æ—¥æ•°æ®æ˜¾ç¤ºä¸‹è·Œï¼Œ
      å¯èƒ½æ˜¯æ—¶é—´å·®å¼‚å¯¼è‡´ï¼Œè¯·ä»¥å®æ—¶æ•°æ®ä¸ºå‡†"
   ```

4. **åˆè§„æ€§è¦æ±‚**ï¼š
   ```
   é‡‘èç›‘ç®¡è¦æ±‚ï¼š
   - æ‰€æœ‰æŠ•èµ„å»ºè®®å¿…é¡»æ ‡æ³¨æ•°æ®æ¥æº
   - ä¸å¾—ä½¿ç”¨æœªéªŒè¯çš„ç¬¬ä¸‰æ–¹æ•°æ®
   - å¿…é¡»ä¿ç•™æ•°æ®è·å–æ—¥å¿—ï¼ˆå¯å®¡è®¡ï¼‰
   - æ•°æ®æ›´æ–°æ—¶é—´å¿…é¡»æ˜ç¡®
   ```

---

#### æ€»ç»“ä¸å»ºè®®

**é—®é¢˜ä¸¥é‡æ€§è¯„çº§**ï¼š
- èˆ†æƒ…ç³»ç»Ÿï¼šâš ï¸âš ï¸ ä¸­ç­‰ï¼ˆå¯ä»¥ä¾èµ–LLMåˆ¤æ–­ï¼‰
- é‡‘èç³»ç»Ÿï¼šğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ æé«˜ï¼ˆå¿…é¡»æœ‰æ˜¾å¼æœºåˆ¶ï¼‰

**å»ºè®®è¡ŒåŠ¨**ï¼š

1. **ç«‹å³è¡ŒåŠ¨ï¼ˆ1å‘¨å†…ï¼‰**ï¼š
   - åœ¨ForumHostçš„Promptä¸­æ·»åŠ æ•°æ®æºç½®ä¿¡åº¦è¯´æ˜
   - åœ¨ReportAgentä¸­æ·»åŠ æ•°æ®æºæ ‡æ³¨
   - ä¸ºæ¯ä¸ªæ•°æ®æºæ·»åŠ æ—¶é—´æˆ³

2. **çŸ­æœŸè¡ŒåŠ¨ï¼ˆ1ä¸ªæœˆå†…ï¼‰**ï¼š
   - å®ç°æ–¹æ¡ˆAï¼šæ˜¾å¼ç½®ä¿¡åº¦æ ‡æ³¨
   - å»ºç«‹æ•°æ®æºå…ƒæ•°æ®ç®¡ç†
   - åœ¨æœ€ç»ˆæŠ¥å‘Šä¸­æ˜ç¡®æ ‡æ³¨æ•°æ®æ¥æº

3. **ä¸­æœŸè¡ŒåŠ¨ï¼ˆ3ä¸ªæœˆå†…ï¼‰**ï¼š
   - å®ç°æ–¹æ¡ˆBï¼šåŠ¨æ€æƒé‡è®¡ç®—
   - æ ¹æ®æŸ¥è¯¢ç±»å‹è‡ªåŠ¨è°ƒæ•´æƒé‡
   - å»ºç«‹å†²çªä¿¡æ¯å¤„ç†è§„åˆ™

4. **é•¿æœŸè¡ŒåŠ¨ï¼ˆ6ä¸ªæœˆå†…ï¼‰**ï¼š
   - å®ç°æ–¹æ¡ˆCï¼šå¤šè·¯å¬å›+Rerank
   - ä¸å‘é‡æ£€ç´¢ç³»ç»Ÿé›†æˆ
   - å»ºç«‹å®Œæ•´çš„æ•°æ®è¿½æº¯ç³»ç»Ÿ

**é‡‘èç³»ç»Ÿçš„æœ€ä½è¦æ±‚**ï¼š
- âœ… å¿…é¡»å®ç°æ–¹æ¡ˆAï¼ˆæ˜¾å¼ç½®ä¿¡åº¦æ ‡æ³¨ï¼‰
- âœ… å¿…é¡»åœ¨æŠ¥å‘Šä¸­æ˜ç¡®æ ‡æ³¨æ•°æ®æ¥æºå’Œæ—¶é—´
- âœ… å¿…é¡»å»ºç«‹å†²çªä¿¡æ¯å¤„ç†è§„åˆ™
- âœ… å¿…é¡»ä¿ç•™æ•°æ®è·å–æ—¥å¿—

**ä¸å®æ–½çš„é£é™©**ï¼š
- ğŸ”´ æŠ•èµ„å»ºè®®ä¸å¯ä¿¡ï¼ˆæ— æ³•éªŒè¯æ•°æ®æ¥æºï¼‰
- ğŸ”´ æ—¶æ•ˆæ€§å†²çªå¯¼è‡´é”™è¯¯åˆ¤æ–­
- ğŸ”´ åˆè§„é£é™©ï¼ˆç›‘ç®¡è¦æ±‚å¯è¿½æº¯æ€§ï¼‰
- ğŸ”´ ç”¨æˆ·ä¿¡ä»»åº¦ä¸‹é™

---

### 2.2.7 ğŸ” å·¥ä½œæµç®¡ç†ï¼šè‡ªå®šä¹‰å®ç° vs AIæ¡†æ¶

**é—®é¢˜å‘ç°è€…**: ç”¨æˆ·åœ¨è®¨è®ºä¸­æå‡ºçš„å…³é”®è§‚å¯Ÿ

#### æ ¸å¿ƒå‘ç°

**å½“å‰ç³»ç»Ÿæ²¡æœ‰ä½¿ç”¨ä»»ä½•AIå·¥ä½œæµæ¡†æ¶**ï¼Œè€Œæ˜¯è‡ªå·±å®ç°äº†ä¸€å¥—åŸºäºNodeçš„å·¥ä½œæµç³»ç»Ÿã€‚

**âŒ æœªä½¿ç”¨çš„æ¡†æ¶**ï¼š
- âŒ LangChain
- âŒ LangGraph
- âŒ LangFlow
- âŒ CrewAI
- âŒ AutoGen
- âŒ Microsoft Semantic Kernel

**âœ… ä½¿ç”¨çš„æŠ€æœ¯**ï¼š
- âœ… è‡ªå®šä¹‰çš„ `BaseNode` æŠ½è±¡ç±»
- âœ… æ‰‹åŠ¨ç¼–æ’çš„å·¥ä½œæµï¼ˆåœ¨Agentç±»ä¸­ï¼‰
- âœ… è‡ªå®šä¹‰çš„ `State` çŠ¶æ€ç®¡ç†
- âœ… çº¯Pythonå®ç°ï¼Œæ— æ¡†æ¶ä¾èµ–

---

#### å½“å‰å®ç°æ–¹å¼

**1. NodeæŠ½è±¡å±‚**

```python
# QueryEngine/nodes/base_node.py

class BaseNode(ABC):
    """èŠ‚ç‚¹åŸºç±»"""
    
    def __init__(self, llm_client: LLMClient, node_name: str = ""):
        self.llm_client = llm_client
        self.node_name = node_name or self.__class__.__name__
    
    @abstractmethod
    def run(self, input_data: Any, **kwargs) -> Any:
        """æ‰§è¡ŒèŠ‚ç‚¹å¤„ç†é€»è¾‘"""
        pass
    
    def validate_input(self, input_data: Any) -> bool:
        """éªŒè¯è¾“å…¥æ•°æ®"""
        return True
    
    def process_output(self, output: Any) -> Any:
        """å¤„ç†è¾“å‡ºæ•°æ®"""
        return output

class StateMutationNode(BaseNode):
    """å¸¦çŠ¶æ€ä¿®æ”¹åŠŸèƒ½çš„èŠ‚ç‚¹åŸºç±»"""
    
    @abstractmethod
    def mutate_state(self, input_data: Any, state: State, **kwargs) -> State:
        """ä¿®æ”¹çŠ¶æ€"""
        pass
```

**ç‰¹ç‚¹**ï¼š
- ç®€å•çš„æŠ½è±¡æ¥å£
- æ¯ä¸ªNodeç‹¬ç«‹å¤„ç†è¾“å…¥è¾“å‡º
- é€šè¿‡ç»§æ‰¿å®ç°ä¸åŒåŠŸèƒ½

**2. æ‰‹åŠ¨å·¥ä½œæµç¼–æ’**

```python
# QueryEngine/agent.py

class DeepSearchAgent:
    def _initialize_nodes(self):
        """æ‰‹åŠ¨åˆå§‹åŒ–æ‰€æœ‰èŠ‚ç‚¹"""
        self.report_structure_node = ReportStructureNode(self.llm_client)
        self.first_search_node = FirstSearchNode(self.llm_client)
        self.reflection_node = ReflectionNode(self.llm_client)
        self.first_summary_node = FirstSummaryNode(self.llm_client)
        self.reflection_summary_node = ReflectionSummaryNode(self.llm_client)
        self.report_formatting_node = ReportFormattingNode(self.llm_client)
    
    def research(self, query: str) -> str:
        """æ‰‹åŠ¨ç¼–æ’æ‰§è¡Œæµç¨‹"""
        # æ­¥éª¤1: ç”ŸæˆæŠ¥å‘Šç»“æ„
        structure_output = self.report_structure_node.run(...)
        self.state = self.report_structure_node.mutate_state(structure_output, self.state)
        
        # æ­¥éª¤2: å¯¹æ¯ä¸ªæ®µè½è¿›è¡Œæœç´¢å’Œæ€»ç»“
        for i in range(len(self.state.paragraphs)):
            # æ­¥éª¤2.1: åˆæ­¥æœç´¢
            search_result = self._initial_search_and_summary(i)
            
            # æ­¥éª¤2.2: åæ€å¾ªç¯
            reflection_result = self._reflection_loop(i)
        
        # æ­¥éª¤3: æ ¼å¼åŒ–æŠ¥å‘Š
        final_report = self.report_formatting_node.run(...)
        
        return final_report
```

**ç‰¹ç‚¹**ï¼š
- åœ¨Agentç±»ä¸­ç¡¬ç¼–ç æ‰§è¡Œé¡ºåº
- ä½¿ç”¨forå¾ªç¯å’Œifæ¡ä»¶æ§åˆ¶æµç¨‹
- çŠ¶æ€é€šè¿‡å‚æ•°ä¼ é€’å’Œmutate_stateä¿®æ”¹

**3. çŠ¶æ€ç®¡ç†**

```python
# QueryEngine/state/state.py

@dataclass
class Paragraph:
    title: str
    content: str
    research: ResearchData = field(default_factory=ResearchData)

@dataclass
class State:
    query: str = ""
    report_title: str = ""
    paragraphs: List[Paragraph] = field(default_factory=list)
    final_report: str = ""
```

**ç‰¹ç‚¹**ï¼š
- ä½¿ç”¨ `@dataclass` å®šä¹‰çŠ¶æ€ç»“æ„
- æ‰‹åŠ¨åœ¨å„ä¸ªèŠ‚ç‚¹é—´ä¼ é€’å’Œä¿®æ”¹çŠ¶æ€
- æ— çŠ¶æ€ç‰ˆæœ¬ç®¡ç†ã€æ— å›æ»šæœºåˆ¶

---

#### ä¸AIæ¡†æ¶å¯¹æ¯”

| ç»´åº¦ | å½“å‰å®ç°ï¼ˆè‡ªå®šä¹‰ï¼‰ | LangChain | LangGraph |
|------|------------------|-----------|-----------|
| **å·¥ä½œæµå®šä¹‰** | æ‰‹åŠ¨ç¼–å†™Pythonä»£ç  | Chain API | å›¾ç»“æ„DSL |
| **èŠ‚ç‚¹æŠ½è±¡** | è‡ªå®šä¹‰BaseNode | Runnableæ¥å£ | Nodeç±» |
| **çŠ¶æ€ç®¡ç†** | æ‰‹åŠ¨ä¼ é€’Stateå¯¹è±¡ | Memoryç»„ä»¶ | StateGraph |
| **æµç¨‹æ§åˆ¶** | if/for/while | é“¾å¼è°ƒç”¨ | æ¡ä»¶è¾¹ï¼ˆConditional Edgesï¼‰ |
| **é”™è¯¯å¤„ç†** | try-exceptæ‰‹åŠ¨å¤„ç† | å†…ç½®é‡è¯•æœºåˆ¶ | é”™è¯¯èŠ‚ç‚¹ |
| **å¯è§†åŒ–** | æ—  | LangSmith | è‡ªåŠ¨ç”Ÿæˆæµç¨‹å›¾ |
| **è°ƒè¯•å·¥å…·** | print/logger | LangSmithè¿½è¸ª | çŠ¶æ€æ£€æŸ¥ç‚¹ |
| **å·¥å…·é›†æˆ** | æ‰‹åŠ¨å°è£… | å†…ç½®å¤§é‡å·¥å…· | Agent Executor |
| **å¹¶è¡Œæ‰§è¡Œ** | æ‰‹åŠ¨å¤šçº¿ç¨‹ | å†…ç½®å¹¶è¡Œæ”¯æŒ | å¹¶è¡ŒèŠ‚ç‚¹ |
| **æµç¨‹å¤ç”¨** | å¤åˆ¶ä»£ç  | Chainå¤ç”¨ | å­å›¾å¤ç”¨ |
| **å­¦ä¹ æ›²çº¿** | âœ… ä½ï¼ˆçº¯Pythonï¼‰ | âš ï¸ ä¸­ç­‰ | âš ï¸ è¾ƒé«˜ |
| **çµæ´»æ€§** | âœ… æé«˜ï¼ˆå®Œå…¨è‡ªå®šä¹‰ï¼‰ | âš ï¸ æ¡†æ¶é™åˆ¶ | âš ï¸ æ¡†æ¶é™åˆ¶ |
| **ç»´æŠ¤æˆæœ¬** | âš ï¸ é«˜ï¼ˆæ‰‹åŠ¨ç»´æŠ¤ï¼‰ | âœ… ä½ï¼ˆæ¡†æ¶ç»´æŠ¤ï¼‰ | âœ… ä½ï¼ˆæ¡†æ¶ç»´æŠ¤ï¼‰ |
| **æ€§èƒ½ä¼˜åŒ–** | æ‰‹åŠ¨ä¼˜åŒ– | å†…ç½®ä¼˜åŒ– | å†…ç½®ä¼˜åŒ– |

---

#### å½“å‰å®ç°çš„ä¼˜åŠ¿

**1. ç®€å•ç›´è§‚**
```python
# å½“å‰å®ç°ï¼šä¸€ç›®äº†ç„¶çš„æµç¨‹
def research(self, query: str):
    # 1. ç”Ÿæˆç»“æ„
    structure = self.report_structure_node.run(query)
    
    # 2. æœç´¢æ€»ç»“
    for paragraph in self.state.paragraphs:
        search_result = self.first_search_node.run(paragraph)
        summary = self.first_summary_node.run(search_result)
    
    # 3. æ ¼å¼åŒ–
    return self.report_formatting_node.run(self.state)

# vs LangGraph: éœ€è¦ç†è§£å›¾ç»“æ„
workflow = StateGraph(State)
workflow.add_node("structure", structure_node)
workflow.add_node("search", search_node)
workflow.add_conditional_edges("search", should_continue, {"continue": "search", "end": END})
```

**2. æ— ä¾èµ–**
- ä¸ä¾èµ–å¤–éƒ¨æ¡†æ¶ï¼ˆLangChainç»å¸¸breaking changesï¼‰
- æ§åˆ¶å®Œå…¨æŒæ¡åœ¨è‡ªå·±æ‰‹ä¸­
- å‡çº§Pythonä¸ç”¨æ‹…å¿ƒæ¡†æ¶å…¼å®¹æ€§

**3. è°ƒè¯•å‹å¥½**
- ç›´æ¥Pythonä»£ç ï¼ŒIDEæ–­ç‚¹è°ƒè¯•
- æ— æ¡†æ¶"é­”æ³•"ï¼Œè¡Œä¸ºå¯é¢„æµ‹
- æ—¥å¿—è¾“å‡ºè‡ªå·±æ§åˆ¶

---

#### å½“å‰å®ç°çš„åŠ£åŠ¿

**1. ç¼ºä¹å·¥ä½œæµå¯è§†åŒ–**

```
å½“å‰: åªèƒ½é€šè¿‡é˜…è¯»ä»£ç ç†è§£æµç¨‹
      â”œâ”€ research() æ–¹æ³• 300è¡Œ
      â”œâ”€ _initial_search_and_summary() 100è¡Œ
      â””â”€ _reflection_loop() 150è¡Œ
      â†’ æ€»å…±éœ€è¦é˜…è¯»500+è¡Œä»£ç æ‰èƒ½ç†è§£å®Œæ•´æµç¨‹

LangGraph: è‡ªåŠ¨ç”Ÿæˆæµç¨‹å›¾
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Structure â”‚
      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
            â†“
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  Search  â”‚â†â”€â”
      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â”‚
            â†“       â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
      â”‚ Reflectionâ”‚â”€â”€â”¤ (æ¡ä»¶å¾ªç¯)
      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
            â†“
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  Format  â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**2. ç¼ºä¹çŠ¶æ€ç®¡ç†å·¥å…·**

```python
# å½“å‰: æ‰‹åŠ¨ç®¡ç†çŠ¶æ€ï¼Œå®¹æ˜“å‡ºé”™
self.state.paragraphs[i].research.latest_summary = summary  # ç›´æ¥ä¿®æ”¹
self.state.paragraphs[i].research.search_history.append(result)  # è¿½åŠ å†å²

# é—®é¢˜ï¼š
- æ²¡æœ‰çŠ¶æ€å†å²è®°å½•
- æ— æ³•å›æ»šåˆ°ä¹‹å‰çš„çŠ¶æ€
- å¹¶å‘ä¿®æ”¹å®¹æ˜“å†²çª
- è°ƒè¯•æ—¶éš¾ä»¥è¿½è¸ªçŠ¶æ€å˜åŒ–

# LangGraph: å†…ç½®çŠ¶æ€ç®¡ç†
class State(TypedDict):
    messages: Annotated[list, add_messages]  # è‡ªåŠ¨å¤„ç†æ¶ˆæ¯è¿½åŠ 
    summary: str

# è‡ªåŠ¨ç»´æŠ¤çŠ¶æ€å†å²ï¼Œæ”¯æŒå›æ»š
```

**3. ç¼ºä¹é”™è¯¯æ¢å¤æœºåˆ¶**

```python
# å½“å‰: æ‰‹åŠ¨try-exceptï¼Œæ²¡æœ‰ç³»ç»Ÿæ€§çš„é”™è¯¯å¤„ç†
def _initial_search_and_summary(self, paragraph_index: int):
    try:
        # æ­¥éª¤1: æœç´¢
        search_result = self.first_search_node.run(...)
        
        # æ­¥éª¤2: æ€»ç»“
        summary = self.first_summary_node.run(search_result)
        
        return summary
    except Exception as e:
        logger.error(f"å¤„ç†å¤±è´¥: {e}")
        # ç„¶åå‘¢ï¼Ÿé‡è¯•ï¼Ÿè·³è¿‡ï¼Ÿé™çº§ï¼Ÿéƒ½éœ€è¦æ‰‹åŠ¨å®ç°
        return None

# LangGraph: å†…ç½®é”™è¯¯å¤„ç†å’Œé‡è¯•
@retry(max_attempts=3, backoff_factor=2.0)
def search_node(state: State) -> State:
    # è‡ªåŠ¨é‡è¯•ï¼Œè‡ªåŠ¨è®°å½•é”™è¯¯
    ...
```

**4. ç¼ºä¹æµç¨‹å¤ç”¨**

```python
# å½“å‰: QueryEngineã€MediaEngineã€InsightEngine å„è‡ªå®ç°ç›¸ä¼¼æµç¨‹
QueryEngine/agent.py:   research() - 500è¡Œ
MediaEngine/agent.py:   research() - 480è¡Œ
InsightEngine/agent.py: research() - 520è¡Œ

# å¤§é‡é‡å¤ä»£ç ï¼š
- éƒ½æœ‰æŠ¥å‘Šç»“æ„ç”Ÿæˆ
- éƒ½æœ‰æœç´¢-æ€»ç»“-åæ€å¾ªç¯
- éƒ½æœ‰æ ¼å¼åŒ–è¾“å‡º
â†’ ä»£ç é‡å¤åº¦ > 60%

# LangGraph: å¯å¤ç”¨çš„å­å›¾
search_summarize_graph = StateGraph(...)  # å®šä¹‰ä¸€æ¬¡
query_agent.add_subgraph(search_summarize_graph)  # å¤ç”¨
media_agent.add_subgraph(search_summarize_graph)  # å¤ç”¨
insight_agent.add_subgraph(search_summarize_graph)  # å¤ç”¨
```

**5. ç¼ºä¹å¹¶è¡Œæ‰§è¡Œæ”¯æŒ**

```python
# å½“å‰: ä¸²è¡Œæ‰§è¡Œï¼Œæ•ˆç‡ä½
for i in range(len(self.state.paragraphs)):
    # æ®µè½1 â†’ æ®µè½2 â†’ æ®µè½3 ï¼ˆä¸²è¡Œï¼‰
    self._initial_search_and_summary(i)  # 5ç§’
    self._reflection_loop(i)  # 10ç§’
# æ€»è€—æ—¶ï¼š3ä¸ªæ®µè½ Ã— 15ç§’ = 45ç§’

# LangGraph: è‡ªåŠ¨å¹¶è¡Œ
workflow.add_node("process_paragraphs", process_all_paragraphs, parallel=True)
# æ€»è€—æ—¶ï¼šmax(15ç§’) = 15ç§’ï¼ˆå¹¶è¡Œæ‰§è¡Œï¼‰
```

---

#### é—®é¢˜ä¸¥é‡æ€§è¯„ä¼°

**åœ¨èˆ†æƒ…åˆ†æåœºæ™¯ä¸‹**ï¼š
```
å½±å“: âš ï¸âš ï¸ ä¸­ç­‰
åŸå› :
- å·¥ä½œæµç›¸å¯¹ç®€å•ï¼ˆ6-8ä¸ªèŠ‚ç‚¹ï¼‰
- ä¸²è¡Œæ‰§è¡Œå¯æ¥å—ï¼ˆæ€»è€—æ—¶1-3åˆ†é’Ÿï¼‰
- æ‰‹åŠ¨ç®¡ç†çŠ¶æ€è¿˜ç®—æ¸…æ™°

å¯æ¥å—æ€§: âœ… å¯æ¥å—
```

**åœ¨é‡‘èåˆ†æåœºæ™¯ä¸‹**ï¼š
```
å½±å“: ğŸ”´ğŸ”´ğŸ”´ è¾ƒé«˜
åŸå› :
- é‡‘èåˆ†æéœ€è¦æ›´å¤æ‚çš„å·¥ä½œæµ
- éœ€è¦å¹¶è¡Œæ‰§è¡Œï¼ˆå®æ—¶æ€§è¦æ±‚ï¼‰
- éœ€è¦é”™è¯¯æ¢å¤ï¼ˆå¯é æ€§è¦æ±‚ï¼‰
- éœ€è¦æµç¨‹å¯è§†åŒ–ï¼ˆåˆè§„è¦æ±‚ï¼‰

å¯æ¥å—æ€§: âš ï¸ å‹‰å¼ºå¯æ¥å—ï¼Œä½†å»ºè®®æ”¹è¿›
```

---

#### é‡‘èåœºæ™¯çš„æ–°å¢éœ€æ±‚

**1. å¤æ‚å·¥ä½œæµ**

```
é‡‘èåˆ†æçš„å…¸å‹æµç¨‹ï¼ˆvs èˆ†æƒ…åˆ†æï¼‰:

èˆ†æƒ…åˆ†æ (6ä¸ªèŠ‚ç‚¹):
Structure â†’ Search â†’ Summary â†’ Reflection â†’ Format â†’ Output

é‡‘èåˆ†æ (15+ä¸ªèŠ‚ç‚¹):
â”œâ”€ åŸºæœ¬é¢åˆ†æ
â”‚   â”œâ”€ è·å–è´¢åŠ¡æ•°æ®
â”‚   â”œâ”€ è®¡ç®—è´¢åŠ¡æŒ‡æ ‡
â”‚   â”œâ”€ è¡Œä¸šå¯¹æ¯”
â”‚   â””â”€ ä¼°å€¼åˆ†æ
â”œâ”€ æŠ€æœ¯é¢åˆ†æ
â”‚   â”œâ”€ è·å–è¡Œæƒ…æ•°æ®
â”‚   â”œâ”€ è®¡ç®—æŠ€æœ¯æŒ‡æ ‡
â”‚   â”œâ”€ å½¢æ€è¯†åˆ«
â”‚   â””â”€ è¶‹åŠ¿åˆ¤æ–­
â”œâ”€ æ¶ˆæ¯é¢åˆ†æ
â”‚   â”œâ”€ æ–°é—»æœç´¢
â”‚   â”œâ”€ å…¬å‘Šåˆ†æ
â”‚   â”œâ”€ ç ”æŠ¥æ€»ç»“
â”‚   â””â”€ æƒ…ç»ªåˆ†æ
â””â”€ ç»¼åˆå†³ç­–
    â”œâ”€ å¤šç»´åº¦è¯„åˆ†
    â”œâ”€ é£é™©è¯„ä¼°
    â””â”€ æŠ•èµ„å»ºè®®

é—®é¢˜: å½“å‰æ‰‹åŠ¨ç¼–æ’æ–¹å¼ï¼Œ15+èŠ‚ç‚¹çš„ä»£ç ä¼šéå¸¸å¤æ‚
```

**2. å¹¶è¡Œæ‰§è¡Œéœ€æ±‚**

```python
# é‡‘èåˆ†æçš„å¹¶è¡Œåœºæ™¯
parallel_tasks = [
    get_financial_data(stock_code),     # 1ç§’
    get_market_data(stock_code),        # 1ç§’
    search_news(stock_code),            # 3ç§’
    search_announcements(stock_code),   # 2ç§’
    get_research_reports(stock_code),   # 2ç§’
]

# å½“å‰ä¸²è¡Œ: 1+1+3+2+2 = 9ç§’
# å¹¶è¡Œ: max(1,1,3,2,2) = 3ç§’ï¼ˆæé€Ÿ3å€ï¼‰

# æ‰‹åŠ¨å®ç°å¹¶è¡Œå¾ˆå¤æ‚
import asyncio
results = await asyncio.gather(*parallel_tasks)  # éœ€è¦æ”¹é€ æ‰€æœ‰èŠ‚ç‚¹ä¸ºasync
```

**3. æ¡ä»¶åˆ†æ”¯éœ€æ±‚**

```python
# é‡‘èåœºæ™¯çš„å¤æ‚æ¡ä»¶åˆ¤æ–­
if stock_data['market_cap'] > 1000äº¿:
    # å¤§ç›˜è‚¡åˆ†ææµç¨‹
    use_dcf_valuation()
    analyze_institutional_holding()
else:
    # å°ç›˜è‚¡åˆ†ææµç¨‹
    use_pe_valuation()
    analyze_retail_sentiment()

if latest_news['sentiment'] == 'é‡å¤§åˆ©ç©º':
    # è§¦å‘é£é™©é¢„è­¦æµç¨‹
    send_alert()
    calculate_stop_loss()
    skip_recommendation()
else:
    # æ­£å¸¸åˆ†ææµç¨‹
    continue_analysis()

# å½“å‰å®ç°: éœ€è¦å¤§é‡if-elseï¼Œä»£ç å¤æ‚åº¦æŒ‡æ•°å¢é•¿
# LangGraph: ä½¿ç”¨æ¡ä»¶è¾¹ï¼ˆConditional Edgesï¼‰æ¸…æ™°è¡¨è¾¾
```

**4. äººæœºäº¤äº’éœ€æ±‚ï¼ˆå¯é€‰ï¼‰**

```python
# é‡‘èåœºæ™¯å¯èƒ½éœ€è¦äººå·¥å®¡æ ¸
workflow:
  åˆ†æ â†’ ç”Ÿæˆå»ºè®® â†’ [äººå·¥å®¡æ ¸] â†’ å‘å¸ƒæŠ¥å‘Š
                      â†“ï¼ˆä¸é€šè¿‡ï¼‰
                   ä¿®æ­£å»ºè®®

# å½“å‰å®ç°: æ— æ³•ä¼˜é›…åœ°å¤„ç†äººæœºäº¤äº’
# LangGraph: å†…ç½®HumanInTheLoopæ”¯æŒ
```

---

#### æ”¹é€ å»ºè®®

**æ–¹æ¡ˆAï¼šä¿æŒç°çŠ¶ + å±€éƒ¨ä¼˜åŒ–ï¼ˆæ¨èçŸ­æœŸï¼‰**

**ä¼˜åŠ¿**ï¼š
- âœ… æ— éœ€é‡æ„ï¼Œé£é™©ä½
- âœ… å­¦ä¹ æˆæœ¬ä½
- âœ… 1-2å‘¨å†…å®Œæˆ

**æ”¹è¿›ç‚¹**ï¼š
1. **æ·»åŠ å·¥ä½œæµå¯è§†åŒ–**ï¼š
   ```python
   def visualize_workflow(self):
       """ç”ŸæˆMermaidæµç¨‹å›¾"""
       mermaid = """
       graph TD
       A[Report Structure] --> B[Search]
       B --> C[Summary]
       C --> D{Need Reflection?}
       D -->|Yes| B
       D -->|No| E[Format]
       """
       # ä¿å­˜ä¸ºå›¾ç‰‡æˆ–HTML
   ```

2. **ä¼˜åŒ–çŠ¶æ€ç®¡ç†**ï¼š
   ```python
   class StateManager:
       def __init__(self):
           self.history = []  # çŠ¶æ€å†å²
       
       def save_checkpoint(self, state: State):
           self.history.append(copy.deepcopy(state))
       
       def rollback(self, steps: int = 1):
           return self.history[-steps]
   ```

3. **ç»Ÿä¸€é”™è¯¯å¤„ç†**ï¼š
   ```python
   class RetryableNode(BaseNode):
       @retry(max_attempts=3, backoff=exponential_backoff)
       def run(self, *args, **kwargs):
           return super().run(*args, **kwargs)
   ```

4. **ç®€å•çš„å¹¶è¡Œæ”¯æŒ**ï¼š
   ```python
   from concurrent.futures import ThreadPoolExecutor
   
   def process_paragraphs_parallel(self):
       with ThreadPoolExecutor(max_workers=3) as executor:
           futures = [executor.submit(self._process_paragraph, i) 
                     for i in range(len(self.state.paragraphs))]
           results = [f.result() for f in futures]
   ```

---

**æ–¹æ¡ˆBï¼šè¿ç§»åˆ°LangGraphï¼ˆæ¨èä¸­æœŸï¼Œ3-6ä¸ªæœˆï¼‰**

**ä¼˜åŠ¿**ï¼š
- âœ… å·¥ä½œæµå¯è§†åŒ–
- âœ… çŠ¶æ€ç®¡ç†è‡ªåŠ¨åŒ–
- âœ… é”™è¯¯å¤„ç†å’Œé‡è¯•å†…ç½®
- âœ… å¹¶è¡Œæ‰§è¡Œæ”¯æŒ
- âœ… æµç¨‹å¤ç”¨

**åŠ£åŠ¿**ï¼š
- âš ï¸ éœ€è¦é‡æ„å¤§é‡ä»£ç ï¼ˆé¢„è®¡2-3ä¸ªæœˆï¼‰
- âš ï¸ å­¦ä¹ æ›²çº¿ï¼ˆå›¢é˜Ÿéœ€è¦1-2å‘¨ç†Ÿæ‚‰ï¼‰
- âš ï¸ æ¡†æ¶ä¾èµ–ï¼ˆLangChainæ›´æ–°é¢‘ç¹ï¼‰

**å®æ–½æ­¥éª¤**ï¼š
```python
# æ­¥éª¤1: å®šä¹‰çŠ¶æ€ï¼ˆ1å‘¨ï¼‰
from langgraph.graph import StateGraph
from typing import TypedDict, Annotated

class FinancialAnalysisState(TypedDict):
    query: str
    stock_code: str
    financial_data: dict
    market_data: dict
    news: list
    analysis_result: str

# æ­¥éª¤2: å°†ç°æœ‰Nodeæ”¹é€ ä¸ºLangGraphèŠ‚ç‚¹ï¼ˆ2-3å‘¨ï¼‰
def financial_data_node(state: FinancialAnalysisState) -> FinancialAnalysisState:
    """è·å–è´¢åŠ¡æ•°æ®"""
    data = fetch_financial_data(state['stock_code'])
    return {"financial_data": data}

def market_data_node(state: FinancialAnalysisState) -> FinancialAnalysisState:
    """è·å–å¸‚åœºæ•°æ®"""
    data = fetch_market_data(state['stock_code'])
    return {"market_data": data}

# æ­¥éª¤3: æ„å»ºå·¥ä½œæµå›¾ï¼ˆ1-2å‘¨ï¼‰
workflow = StateGraph(FinancialAnalysisState)

# æ·»åŠ èŠ‚ç‚¹
workflow.add_node("fetch_financial", financial_data_node)
workflow.add_node("fetch_market", market_data_node)
workflow.add_node("analyze", analysis_node)

# æ·»åŠ è¾¹ï¼ˆå®šä¹‰æ‰§è¡Œé¡ºåºï¼‰
workflow.add_edge(START, "fetch_financial")
workflow.add_edge(START, "fetch_market")  # å¹¶è¡Œæ‰§è¡Œ
workflow.add_edge("fetch_financial", "analyze")
workflow.add_edge("fetch_market", "analyze")
workflow.add_edge("analyze", END)

# ç¼–è¯‘
app = workflow.compile()

# æ­¥éª¤4: è¿è¡Œ
result = app.invoke({"query": "åˆ†æè´µå·èŒ…å°", "stock_code": "600519"})
```

**æˆæœ¬æ”¶ç›Šåˆ†æ**ï¼š
```
æˆæœ¬:
- å¼€å‘æ—¶é—´: 2-3ä¸ªæœˆ
- å­¦ä¹ æˆæœ¬: 1-2å‘¨
- ä»£ç é‡æ„: ~5000è¡Œä»£ç 

æ”¶ç›Š:
- å¼€å‘æ•ˆç‡æå‡: 50%ï¼ˆåç»­æ–°å¢æµç¨‹ï¼‰
- ç»´æŠ¤æˆæœ¬é™ä½: 40%ï¼ˆæ¡†æ¶è‡ªåŠ¨å¤„ç†ï¼‰
- å¹¶è¡Œæ‰§è¡ŒåŠ é€Ÿ: 2-3å€ï¼ˆå®æ—¶æ€§æå‡ï¼‰
- å¯è§†åŒ–: è‡ªåŠ¨ç”Ÿæˆæµç¨‹å›¾ï¼ˆåˆè§„+è°ƒè¯•ï¼‰

ROI: 6ä¸ªæœˆåå›æœ¬
```

---

#### æ€»ç»“ä¸å»ºè®®

**é—®é¢˜ä¸¥é‡æ€§è¯„çº§**ï¼š
- èˆ†æƒ…ç³»ç»Ÿï¼šâš ï¸âš ï¸ ä¸­ç­‰ï¼ˆå½“å‰å®ç°å¯æ¥å—ï¼‰
- é‡‘èç³»ç»Ÿï¼šğŸ”´ğŸ”´ğŸ”´ è¾ƒé«˜ï¼ˆå»ºè®®æ”¹è¿›ï¼‰

**å»ºè®®è¡ŒåŠ¨**ï¼š

1. **ç«‹å³è¡ŒåŠ¨ï¼ˆ1å‘¨å†…ï¼‰**ï¼š
   - æ·»åŠ å·¥ä½œæµå¯è§†åŒ–ï¼ˆMermaidå›¾ï¼‰
   - æ·»åŠ çŠ¶æ€å†å²è®°å½•
   - ç»Ÿä¸€é”™è¯¯å¤„ç†è£…é¥°å™¨

2. **çŸ­æœŸè¡ŒåŠ¨ï¼ˆ1ä¸ªæœˆå†…ï¼‰**ï¼š
   - å®ç°ç®€å•çš„å¹¶è¡Œæ‰§è¡Œï¼ˆThreadPoolExecutorï¼‰
   - æå–å…¬å…±æµç¨‹ä¸ºå¯å¤ç”¨å‡½æ•°
   - æ·»åŠ æ›´å¤šæ—¥å¿—å’Œè¿½è¸ª

3. **ä¸­æœŸè¡ŒåŠ¨ï¼ˆ3-6ä¸ªæœˆï¼‰**ï¼š
   - è¯„ä¼°LangGraphè¿ç§»çš„å¯è¡Œæ€§
   - å…ˆç”¨LangGraphå®ç°1-2ä¸ªæ–°æµç¨‹ï¼ˆè¯•ç‚¹ï¼‰
   - é€æ­¥è¿ç§»ç°æœ‰æµç¨‹

4. **é•¿æœŸè¡ŒåŠ¨ï¼ˆ6-12ä¸ªæœˆï¼‰**ï¼š
   - å…¨é¢è¿ç§»åˆ°LangGraph
   - å»ºç«‹æ ‡å‡†åŒ–çš„èŠ‚ç‚¹åº“
   - å®ç°å¤æ‚çš„æ¡ä»¶åˆ†æ”¯å’Œå¾ªç¯

**é‡‘èç³»ç»Ÿçš„å»ºè®®**ï¼š
- âœ… çŸ­æœŸå¿…é¡»å®ç°ï¼šå¹¶è¡Œæ‰§è¡Œã€é”™è¯¯æ¢å¤
- âš ï¸ ä¸­æœŸå»ºè®®è¯„ä¼°ï¼šæ˜¯å¦è¿ç§»åˆ°LangGraph
- âš ï¸ é•¿æœŸæ ¹æ®å¤æ‚åº¦å†³å®šï¼šå¦‚æœæµç¨‹èŠ‚ç‚¹ > 20ä¸ªï¼Œå¼ºçƒˆå»ºè®®ä½¿ç”¨æ¡†æ¶

**ä¸æ”¹è¿›çš„é£é™©**ï¼š
- âš ï¸ ä»£ç å¤æ‚åº¦éšèŠ‚ç‚¹æ•°æŒ‡æ•°å¢é•¿
- âš ï¸ ç»´æŠ¤æˆæœ¬é«˜ï¼ˆæ‰‹åŠ¨ç®¡ç†15+èŠ‚ç‚¹ï¼‰
- âš ï¸ å¼€å‘æ•ˆç‡ä½ï¼ˆæ¯æ¬¡æ–°å¢æµç¨‹é‡å¤é€ è½®å­ï¼‰
- âš ï¸ è°ƒè¯•å›°éš¾ï¼ˆæ— å¯è§†åŒ–ï¼Œéš¾ä»¥è¿½è¸ªçŠ¶æ€ï¼‰

---

### 2.2.8 âš ï¸ é‡è¦æŠ€æœ¯ç¼ºå¤±ï¼šç³»ç»Ÿæœªä½¿ç”¨å‘é‡åŒ–ä¸è¯­ä¹‰æœç´¢

**ç°çŠ¶ç¡®è®¤**ï¼šå½“å‰ç³»ç»Ÿ**å®Œå…¨æ²¡æœ‰ä½¿ç”¨**ä»¥ä¸‹æŠ€æœ¯ï¼š

#### âŒ æœªä½¿ç”¨çš„æŠ€æœ¯

1. **å‘é‡æ•°æ®åº“ï¼ˆVector Databaseï¼‰**
   - âŒ æ²¡æœ‰ Milvusã€Pineconeã€ChromaDBã€FAISSã€Weaviate
   - âŒ æ²¡æœ‰å‘é‡ç´¢å¼•
   - âŒ æ²¡æœ‰å‘é‡å­˜å‚¨

2. **Embedding æ¨¡å‹ï¼ˆç”¨äºæ£€ç´¢ï¼‰**
   - âŒ æ²¡æœ‰ä½¿ç”¨ OpenAI text-embedding-ada-002
   - âŒ æ²¡æœ‰ä½¿ç”¨ text-embedding-3-large/small
   - âŒ æ²¡æœ‰ä½¿ç”¨å¼€æº Embedding æ¨¡å‹ï¼ˆBGEã€m3eã€stellaï¼‰
   - âš ï¸ æ³¨æ„ï¼š`SentimentAnalysisModel/` ä¸‹æœ‰ Qwen3-Embeddingï¼Œä½†**ä»…ç”¨äºæƒ…æ„Ÿåˆ†ç±»è®­ç»ƒ**ï¼Œä¸ç”¨äºæ£€ç´¢

3. **RAG æ¶æ„ï¼ˆRetrieval-Augmented Generationï¼‰**
   - âŒ æ²¡æœ‰ RAG Pipeline
   - âŒ æ²¡æœ‰å‘é‡æ£€ç´¢å¬å›
   - âŒ æ²¡æœ‰è¯­ä¹‰ç›¸ä¼¼åº¦åŒ¹é…

4. **å¤šè½®å¬å›ä¸é‡æ’åºï¼ˆMulti-stage Retrievalï¼‰**
   - âŒ æ²¡æœ‰ç²—æ’ï¼ˆCoarse Rankingï¼‰
   - âŒ æ²¡æœ‰ç²¾æ’ï¼ˆFine Rankingï¼‰
   - âŒ æ²¡æœ‰ Rerank æœåŠ¡ï¼ˆå¦‚ Cohere Rerankã€BGE Rerankerï¼‰
   - âŒ æ²¡æœ‰å¤šè·¯å¬å›èåˆ

---

#### âœ… å½“å‰ä½¿ç”¨çš„æ£€ç´¢æŠ€æœ¯

**çº¯ç²¹çš„ä¼ ç»Ÿæ•°æ®åº“æ£€ç´¢**ï¼š

```python
# InsightEngine/tools/search.py

æ£€ç´¢æ–¹å¼: SQL LIKE æ¨¡ç³ŠåŒ¹é…
æŸ¥è¯¢ç¤ºä¾‹:
SELECT * FROM xhs_note 
WHERE 
    title LIKE '%æ­¦å¤§%' OR 
    desc LIKE '%æ­¦å¤§%' OR 
    tag_list LIKE '%æ­¦å¤§%' OR 
    source_keyword LIKE '%æ­¦å¤§%'
ORDER BY id DESC 
LIMIT 100

ç‰¹ç‚¹:
âœ… ç®€å•ç›´æ¥ï¼Œæ— éœ€é¢å¤–åŸºç¡€è®¾æ–½
âœ… æ— éœ€è®­ç»ƒæˆ–éƒ¨ç½² Embedding æ¨¡å‹
âœ… æ— éœ€ç»´æŠ¤å‘é‡ç´¢å¼•
âŒ åªèƒ½åšå­—é¢åŒ¹é…ï¼Œæ— æ³•ç†è§£è¯­ä¹‰
âŒ æ— æ³•å¤„ç†åŒä¹‰è¯ï¼ˆ"æ‰‹æœº"å’Œ"æ™ºèƒ½æ‰‹æœº"æ— æ³•åŒ¹é…ï¼‰
âŒ æ— æ³•å¤„ç†å¤šä¹‰è¯ï¼ˆ"è‹¹æœ"å¯èƒ½æ˜¯æ°´æœæˆ–å…¬å¸ï¼‰
âŒ ä¸­æ–‡åˆ†è¯ä¸å‹å¥½ï¼ˆ"æ­¦æ±‰å¤§å­¦"æ— æ³•åŒ¹é…"æ­¦å¤§"ï¼‰
```

---

#### æŠ€æœ¯å¯¹æ¯”ï¼šä¼ ç»Ÿæ£€ç´¢ vs å‘é‡æ£€ç´¢

| ç»´åº¦ | å½“å‰ç³»ç»Ÿï¼ˆLIKEæ¨¡ç³ŠåŒ¹é…ï¼‰ | å‘é‡æ£€ç´¢ï¼ˆRAGï¼‰ |
|------|-------------------------|-----------------|
| **æ£€ç´¢åŸç†** | å­—ç¬¦ä¸²å­ä¸²åŒ¹é… | è¯­ä¹‰ç›¸ä¼¼åº¦è®¡ç®— |
| **åŒä¹‰è¯å¤„ç†** | âŒ æ— æ³•å¤„ç† | âœ… è‡ªåŠ¨ç†è§£åŒä¹‰è¯ |
| **å¤šä¹‰è¯å¤„ç†** | âŒ æ— æ³•åŒºåˆ† | âœ… æ ¹æ®ä¸Šä¸‹æ–‡ç†è§£ |
| **è¯­ä¹‰ç†è§£** | âŒ çº¯å­—é¢åŒ¹é… | âœ… ç†è§£æ·±å±‚è¯­ä¹‰ |
| **å¬å›ç‡** | ä¾èµ–å…³é”®è¯æ‰©å±•ï¼ˆLLMç”Ÿæˆ10-20ä¸ªå…³é”®è¯ï¼‰ | å¤©ç„¶é«˜å¬å›ï¼ˆå‘é‡ç©ºé—´é‚»è¿‘æœç´¢ï¼‰ |
| **å‡†ç¡®ç‡** | å™ªéŸ³è¾ƒå¤šï¼ˆ"æ­¦å¤§"è¯¯åŒ¹é…"æ­¦æ‰“"ï¼‰ | æ›´ç²¾å‡†ï¼ˆè¯­ä¹‰ç›¸å…³æ€§æ’åºï¼‰ |
| **æ€§èƒ½** | âœ… å¿«é€Ÿï¼ˆSQLç´¢å¼•ï¼‰ | âš ï¸ éœ€è¦å‘é‡è®¡ç®— |
| **ç»´æŠ¤æˆæœ¬** | âœ… ä½ï¼ˆæ— éœ€é¢å¤–æœåŠ¡ï¼‰ | âš ï¸ é«˜ï¼ˆéœ€ç»´æŠ¤å‘é‡åº“ã€EmbeddingæœåŠ¡ï¼‰ |
| **é€‚ç”¨åœºæ™¯** | ç²¾ç¡®å…³é”®è¯æ£€ç´¢ | æ¨¡ç³Šè¯­ä¹‰æ£€ç´¢ |

---

#### ç¤ºä¾‹å¯¹æ¯”ï¼šæŸ¥è¯¢"èŒ…å°è‚¡ç¥¨è¡¨ç°"

**åœºæ™¯1ï¼šå½“å‰ç³»ç»Ÿï¼ˆLIKE + å…³é”®è¯æ‰©å±•ï¼‰**

```
Step 1: KeywordOptimizeræ‰©å±•å…³é”®è¯
è¾“å…¥: "èŒ…å°è‚¡ç¥¨è¡¨ç°"
è¾“å‡º: ["èŒ…å°", "è´µå·èŒ…å°", "600519", "èŒ…å°è‚¡ç¥¨", "èŒ…å°é…’", "ç™½é…’é¾™å¤´", ...]

Step 2: 15ä¸ªå…³é”®è¯ Ã— å¤šå­—æ®µ Ã— å¤šè¡¨
SELECT * FROM news WHERE title LIKE '%èŒ…å°%'
SELECT * FROM news WHERE title LIKE '%è´µå·èŒ…å°%'
SELECT * FROM news WHERE title LIKE '%600519%'
...

ç»“æœ:
âœ… èƒ½åŒ¹é…: "èŒ…å°è‚¡ä»·å¤§æ¶¨"ã€"è´µå·èŒ…å°è´¢æŠ¥"ã€"600519è¡Œæƒ…"
âŒ æ— æ³•åŒ¹é…: "ç™½é…’æ¿å—é¢†æ¶¨"ï¼ˆè™½ç„¶è¯­ä¹‰ç›¸å…³ï¼Œä½†æ²¡æœ‰"èŒ…å°"å­—æ ·ï¼‰
âŒ è¯¯åŒ¹é…: "èŒ…å°é•‡æ—…æ¸¸"ï¼ˆå«"èŒ…å°"ä½†ä¸ç›¸å…³ï¼‰
```

**åœºæ™¯2ï¼šå‘é‡æ£€ç´¢ï¼ˆRAGæ–¹å¼ï¼‰**

```
Step 1: å°†æŸ¥è¯¢å‘é‡åŒ–
query_embedding = embed("èŒ…å°è‚¡ç¥¨è¡¨ç°")  # â†’ [0.23, -0.45, 0.67, ...]

Step 2: å‘é‡ç›¸ä¼¼åº¦æœç´¢
ä»å‘é‡æ•°æ®åº“ä¸­æ‰¾åˆ°æœ€ç›¸ä¼¼çš„Top-Kæ–‡æ¡£

Step 3: ç›¸ä¼¼åº¦æ’åºè¿”å›
cosine_similarity(query_embedding, doc_embedding)

ç»“æœ:
âœ… èƒ½åŒ¹é…: "èŒ…å°è‚¡ä»·å¤§æ¶¨"ï¼ˆé«˜ç›¸ä¼¼åº¦ï¼‰
âœ… èƒ½åŒ¹é…: "ç™½é…’æ¿å—é¢†æ¶¨ï¼Œè´µå·èŒ…å°æ¶¨åœ"ï¼ˆè¯­ä¹‰ç›¸å…³ï¼‰
âœ… èƒ½åŒ¹é…: "600519åˆ›å†å²æ–°é«˜"ï¼ˆç†è§£è‚¡ç¥¨ä»£ç ï¼‰
âŒ ä¸åŒ¹é…: "èŒ…å°é•‡æ—…æ¸¸"ï¼ˆè¯­ä¹‰ä¸ç›¸å…³ï¼Œç›¸ä¼¼åº¦ä½ï¼‰
```

---

#### å½“å‰ç³»ç»Ÿå¦‚ä½•å¼¥è¡¥ç¼ºå¤±ï¼Ÿ

ç”±äºæ²¡æœ‰å‘é‡æ£€ç´¢ï¼Œç³»ç»Ÿé€šè¿‡ä»¥ä¸‹æ–¹å¼æé«˜å¬å›ç‡ï¼š

1. **LLM å…³é”®è¯æ‰©å±•**ï¼ˆKeywordOptimizerï¼‰
   - å°† 1 ä¸ªæŸ¥è¯¢è¯æ‰©å±•ä¸º 10-20 ä¸ªå…³é”®è¯
   - ç”¨ LLM ç†è§£è¯­ä¹‰ï¼Œç”Ÿæˆè¿‘ä¹‰è¯ã€ç›¸å…³è¯
   - ä¾‹å¦‚ï¼š"æ‰‹æœº" â†’ ["æ‰‹æœº", "æ™ºèƒ½æ‰‹æœº", "ç§»åŠ¨è®¾å¤‡", "iPhone", "Android", ...]

2. **å¤šå­—æ®µå…¨æ–‡æœç´¢**
   - åœ¨ titleã€descã€tag_listã€content ç­‰å¤šä¸ªå­—æ®µæœç´¢
   - ç”¨ OR è¿æ¥ï¼Œæ‰©å¤§è¦†ç›–èŒƒå›´

3. **è·¨è¡¨å…¨å±€æœç´¢**
   - 14 ä¸ªè¡¨å¹¶è¡Œæœç´¢
   - æ¯ä¸ªè¡¨è¿”å› Top 100
   - åˆå¹¶å»é‡

4. **LLM åç½®è¿‡æ»¤**
   - Agent çš„ SummaryNode ä½¿ç”¨ LLM é˜…è¯»å¬å›çš„å†…å®¹
   - è¿‡æ»¤æ‰ä¸ç›¸å…³çš„å™ªéŸ³æ•°æ®
   - åªä¿ç•™çœŸæ­£ç›¸å…³çš„å†…å®¹è¿›è¡Œæ€»ç»“

**æœ¬è´¨**ï¼šç”¨ LLM çš„è¯­ä¹‰ç†è§£èƒ½åŠ›**éƒ¨åˆ†æ›¿ä»£**å‘é‡æ£€ç´¢

---

#### ä¼˜åŠ¿ä¸åŠ£åŠ¿åˆ†æ

**å½“å‰æ–¹æ¡ˆçš„ä¼˜åŠ¿**ï¼š
1. âœ… **æ¶æ„ç®€å•**ï¼šæ— éœ€éƒ¨ç½²å‘é‡æ•°æ®åº“ã€Embedding æœåŠ¡
2. âœ… **å¼€å‘å¿«é€Ÿ**ï¼šç›´æ¥ä½¿ç”¨ MySQLï¼Œæ— éœ€å­¦ä¹ æ–°æŠ€æœ¯æ ˆ
3. âœ… **æˆæœ¬è¾ƒä½**ï¼šä¸éœ€è¦é¢å¤–çš„å‘é‡è®¡ç®—èµ„æº
4. âœ… **å¯è§£é‡Šæ€§å¼º**ï¼šå…³é”®è¯åŒ¹é…é€»è¾‘æ¸…æ™°
5. âœ… **é€‚åˆå°è§„æ¨¡æ•°æ®**ï¼šç™¾ä¸‡çº§æ•°æ® SQL æŸ¥è¯¢æ€§èƒ½è¶³å¤Ÿ

**å½“å‰æ–¹æ¡ˆçš„åŠ£åŠ¿**ï¼š
1. âŒ **è¯­ä¹‰ç†è§£å¼±**ï¼šæ— æ³•ç†è§£åŒä¹‰è¯ã€å¤šä¹‰è¯
2. âŒ **å¬å›æ•ˆç‡ä½**ï¼šéœ€è¦ LLM å®æ—¶æ‰©å±•å…³é”®è¯ï¼ˆå¢åŠ  API è°ƒç”¨ï¼‰
3. âŒ **å™ªéŸ³è¾ƒå¤š**ï¼šå­—é¢åŒ¹é…å®¹æ˜“è¯¯å¬å›
4. âŒ **æ‰©å±•æ€§å·®**ï¼šæ•°æ®é‡å¢å¤§åï¼ŒLIKE æŸ¥è¯¢æ€§èƒ½ä¸‹é™
5. âŒ **æ— æ³•å¤„ç†å¤æ‚æŸ¥è¯¢**ï¼šå¦‚"æƒ…æ„Ÿç§¯æçš„èŒ…å°æ–°é—»"ï¼ˆéœ€è¦è¯­ä¹‰+æƒ…æ„ŸåŒé‡ç†è§£ï¼‰

---

#### é‡‘èåœºæ™¯æ˜¯å¦éœ€è¦å‘é‡åŒ–ï¼Ÿ

**å»ºè®®ï¼šåˆ†åœºæ™¯å†³ç­–**

##### åœºæ™¯1ï¼šç»“æ„åŒ–é‡‘èæ•°æ®ï¼ˆä¸éœ€è¦å‘é‡åŒ–ï¼‰
```
æ•°æ®ç±»å‹: è‚¡ç¥¨è¡Œæƒ…ã€è´¢åŠ¡æŠ¥è¡¨ã€äº¤æ˜“æ•°æ®
ç‰¹ç‚¹: å­—æ®µæ˜ç¡®ï¼ŒæŸ¥è¯¢ç²¾ç¡®
æ£€ç´¢æ–¹å¼: 
  - WHERE stock_code = '600519'
  - WHERE trade_date BETWEEN '2024-01-01' AND '2024-12-31'
  - WHERE pe_ratio > 30
  
ç»“è®º: âœ… ä¼ ç»ŸSQLè¶³å¤Ÿï¼Œæ— éœ€å‘é‡åŒ–
```

##### åœºæ™¯2ï¼šéç»“æ„åŒ–æ–‡æœ¬æ•°æ®ï¼ˆå»ºè®®å‘é‡åŒ–ï¼‰
```
æ•°æ®ç±»å‹: æ–°é—»ã€å…¬å‘Šã€ç ”æŠ¥ã€ç¤¾äº¤åª’ä½“
ç‰¹ç‚¹: æ–‡æœ¬ä¸°å¯Œï¼Œè¯­ä¹‰å¤æ‚
å¸¸è§æŸ¥è¯¢: 
  - "æ‰¾åˆ°æ‰€æœ‰çœ‹å¥½æ–°èƒ½æºæ±½è½¦çš„ç ”æŠ¥"ï¼ˆéœ€è¦ç†è§£"çœ‹å¥½"çš„è¯­ä¹‰ï¼‰
  - "åˆ†æå¸‚åœºå¯¹èŒ…å°çš„æƒ…ç»ª"ï¼ˆéœ€è¦ç†è§£æƒ…æ„Ÿå€¾å‘ï¼‰
  - "æŸ¥æ‰¾ä¸ç¾è”å‚¨åŠ æ¯ç›¸å…³çš„æ–°é—»"ï¼ˆéœ€è¦ç†è§£ç»æµå…³è”ï¼‰
  
ç»“è®º: âš ï¸ å»ºè®®å¼•å…¥å‘é‡æ£€ç´¢ï¼Œæå‡å¬å›ç‡å’Œå‡†ç¡®æ€§
```

##### åœºæ™¯3ï¼šæ··åˆæŸ¥è¯¢ï¼ˆæ¨è Hybrid Searchï¼‰
```
æŸ¥è¯¢ç¤ºä¾‹: "æ‰¾åˆ°PE<20ä¸”è¿‘æœŸæ–°é—»æƒ…ç»ªç§¯æçš„è‚¡ç¥¨"

æ–¹æ¡ˆ1: ä¼ ç»Ÿæ£€ç´¢ï¼ˆå½“å‰ç³»ç»Ÿï¼‰
  - SQLç­›é€‰PE<20çš„è‚¡ç¥¨
  - ç”¨å…³é”®è¯åŒ¹é…æ‰¾ç›¸å…³æ–°é—»
  - ç”¨æƒ…æ„Ÿæ¨¡å‹åˆ¤æ–­æƒ…ç»ª
  - åˆå¹¶ç»“æœ
  
æ–¹æ¡ˆ2: å‘é‡æ··åˆæ£€ç´¢ï¼ˆæ¨èï¼‰
  - SQLç­›é€‰PE<20çš„è‚¡ç¥¨ â†’ å€™é€‰æ± 
  - å‘é‡æ£€ç´¢"æƒ…ç»ªç§¯æçš„æ–°é—»" â†’ ç›¸å…³æ–°é—»
  - äº¤å‰åŒ¹é…è‚¡ç¥¨ä»£ç 
  - æŒ‰ç›¸ä¼¼åº¦æ’åº
  
ä¼˜åŠ¿: æ›´é«˜çš„å¬å›ç‡å’Œå‡†ç¡®ç‡
```

---

#### æ”¹é€ å»ºè®®ï¼šæ¸è¿›å¼å¼•å…¥å‘é‡æ£€ç´¢

**é˜¶æ®µ1ï¼šä¿æŒç°çŠ¶ï¼ˆçŸ­æœŸï¼‰**
- ä¿ç•™ LIKE + KeywordOptimizer æ–¹æ¡ˆ
- é€‚ç”¨äºæ•°æ®é‡ä¸å¤§ã€æŸ¥è¯¢ç®€å•çš„åœºæ™¯
- ä¼˜åŠ¿ï¼šå¿«é€Ÿä¸Šçº¿ï¼Œæˆæœ¬ä½

**é˜¶æ®µ2ï¼šå±€éƒ¨å‘é‡åŒ–ï¼ˆä¸­æœŸï¼‰**
- ä»…å¯¹**ç ”æŠ¥ã€æ–°é—»**ç­‰é•¿æ–‡æœ¬å»ºç«‹å‘é‡ç´¢å¼•
- ç»“æ„åŒ–æ•°æ®ä»ç”¨ä¼ ç»Ÿ SQL
- å®ç° Hybrid Searchï¼ˆSQLè¿‡æ»¤ + å‘é‡æ£€ç´¢ï¼‰
- å·¥å…·ï¼šä½¿ç”¨ ChromaDB/FAISSï¼ˆè½»é‡çº§ï¼Œæ˜“éƒ¨ç½²ï¼‰

**é˜¶æ®µ3ï¼šå…¨é¢å‘é‡åŒ–ï¼ˆé•¿æœŸï¼‰**
- æ‰€æœ‰éç»“æ„åŒ–æ•°æ®å‘é‡åŒ–
- å¼•å…¥å¤šè·¯å¬å›ï¼š
  ```
  å¬å›è·¯å¾„1: å‘é‡æ£€ç´¢ï¼ˆTop 100ï¼‰
  å¬å›è·¯å¾„2: å…³é”®è¯åŒ¹é…ï¼ˆTop 100ï¼‰
  å¬å›è·¯å¾„3: å®ä½“æ£€ç´¢ï¼ˆTop 50ï¼‰
  â†“
  Rerankæ¨¡å‹é‡æ’åº â†’ Top 20
  â†“
  LLMç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ
  ```
- å·¥å…·ï¼šMilvus + BGE-M3 Embedding + BGE Reranker

---

#### å®ç°ç¤ºä¾‹ï¼šæœ€å°åŒ–å‘é‡æ£€ç´¢æ”¹é€ 

**Step 1: é€‰æ‹© Embedding æ¨¡å‹**
```python
# æ–¹æ¡ˆ1: ä½¿ç”¨ OpenAI APIï¼ˆæœ€ç®€å•ï¼‰
from openai import OpenAI
client = OpenAI()

def embed_text(text: str):
    response = client.embeddings.create(
        model="text-embedding-3-small",
        input=text
    )
    return response.data[0].embedding

# æ–¹æ¡ˆ2: ä½¿ç”¨å¼€æºæ¨¡å‹ï¼ˆæˆæœ¬æ›´ä½ï¼‰
from sentence_transformers import SentenceTransformer
model = SentenceTransformer('BAAI/bge-large-zh-v1.5')
embedding = model.encode("èŒ…å°è‚¡ç¥¨è¡¨ç°")
```

**Step 2: å»ºç«‹å‘é‡ç´¢å¼•**
```python
# ä½¿ç”¨ ChromaDBï¼ˆæœ€è½»é‡çº§ï¼‰
import chromadb

# åˆå§‹åŒ–
client = chromadb.Client()
collection = client.create_collection("financial_news")

# å‘é‡åŒ–å¹¶å­˜å‚¨æ–°é—»
for news in news_list:
    collection.add(
        documents=[news['content']],
        metadatas=[{"title": news['title'], "date": news['date']}],
        ids=[news['id']]
    )

# è¯­ä¹‰æœç´¢
results = collection.query(
    query_texts=["èŒ…å°è‚¡ç¥¨è¡¨ç°"],
    n_results=20
)
```

**Step 3: æ··åˆæ£€ç´¢ç­–ç•¥**
```python
def hybrid_search(query: str, stock_code: str = None):
    # è·¯å¾„1: SQLç²¾ç¡®ç­›é€‰
    if stock_code:
        sql_results = db.query(f"SELECT * FROM news WHERE stock_code='{stock_code}'")
    
    # è·¯å¾„2: å‘é‡è¯­ä¹‰æ£€ç´¢
    vector_results = collection.query(query_texts=[query], n_results=100)
    
    # è·¯å¾„3: å…³é”®è¯æ‰©å±•æ£€ç´¢ï¼ˆå½“å‰æ–¹æ¡ˆï¼‰
    keywords = keyword_optimizer.optimize(query)
    keyword_results = []
    for kw in keywords:
        keyword_results.extend(
            db.query(f"SELECT * FROM news WHERE title LIKE '%{kw}%'")
        )
    
    # åˆå¹¶å»é‡
    all_results = merge_and_deduplicate(sql_results, vector_results, keyword_results)
    
    # Rerankï¼ˆå¯é€‰ï¼‰
    reranked = rerank_model.rerank(query, all_results, top_k=20)
    
    return reranked
```

---

### æ€»ç»“ï¼šå‘é‡æ£€ç´¢çš„å¿…è¦æ€§

| åœºæ™¯ | å½“å‰æ–¹æ¡ˆï¼ˆLIKE + KeywordOptimizerï¼‰ | æ˜¯å¦éœ€è¦å‘é‡åŒ– |
|------|-----------------------------------|---------------|
| èˆ†æƒ…åˆ†æï¼ˆç¤¾äº¤åª’ä½“çŸ­æ–‡æœ¬ï¼‰ | âœ… è¶³å¤Ÿåº”å¯¹ | âš ï¸ å¯é€‰ï¼ˆæå‡30%å¬å›ç‡ï¼‰ |
| è‚¡ç¥¨äº¤æ˜“æ•°æ® | âœ… SQLå®Œç¾èƒœä»» | âŒ ä¸éœ€è¦ |
| é‡‘èæ–°é—»/ç ”æŠ¥åˆ†æ | âš ï¸ å¯ç”¨ä½†æœ‰å±€é™ | âœ… å¼ºçƒˆå»ºè®®ï¼ˆæå‡50%+å¬å›ç‡ï¼‰ |
| å¤æ‚è¯­ä¹‰æŸ¥è¯¢ | âŒ éš¾ä»¥åº”å¯¹ | âœ… å¿…é¡»ï¼ˆå¦åˆ™å‡†ç¡®ç‡<50%ï¼‰ |

**æœ€ç»ˆå»ºè®®**ï¼š
- **çŸ­æœŸ**ï¼šä¿æŒç°çŠ¶ï¼Œä¼˜åŒ– KeywordOptimizer çš„ prompt
- **ä¸­æœŸ**ï¼šå¯¹æ–°é—»/ç ”æŠ¥ç­‰é•¿æ–‡æœ¬å¼•å…¥å‘é‡æ£€ç´¢
- **é•¿æœŸ**ï¼šæ„å»ºå®Œæ•´çš„ Hybrid Search ç³»ç»Ÿï¼ˆSQL + å‘é‡ + å…³é”®è¯ï¼‰

**é‡‘èåœºæ™¯çš„æ”¹é€ æ–¹æ¡ˆ**ï¼š
```
ç­–ç•¥ï¼šå®Œå…¨æ›¿æ¢MindSpiderï¼Œæ”¹ä¸ºé‡‘èæ•°æ®æº

åˆ é™¤:
â”œâ”€ MindSpider/ (æ•´ä¸ªèˆ†æƒ…çˆ¬è™«ç³»ç»Ÿ)
â””â”€ ç›¸å…³çš„æ•°æ®åº“è¡¨

æ–°å¢é‡‘èæ•°æ®åº“è¡¨:
â”œâ”€ stock_basic_info (è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯)
â”œâ”€ trading_data (äº¤æ˜“æ•°æ®: Kçº¿ã€æˆäº¤é‡)
â”œâ”€ market_data (è¡Œæƒ…æ•°æ®: å¸‚å€¼ã€æ¢æ‰‹ç‡ã€PE/PB)
â”œâ”€ financial_data (è´¢åŠ¡æ•°æ®: è´¢æŠ¥ã€åˆ©æ¶¦è¡¨ã€ç°é‡‘æµ)
â”œâ”€ company_announcements (å…¬å¸å…¬å‘Š)
â”œâ”€ financial_news (è´¢ç»æ–°é—»)
â”œâ”€ analyst_reports (åˆ†æå¸ˆç ”æŠ¥)
â”œâ”€ technical_indicators (æŠ€æœ¯æŒ‡æ ‡ç¼“å­˜)
â””â”€ factor_data (å› å­æ•°æ®: ä»·å€¼ã€æˆé•¿ã€åŠ¨é‡)

StrategyEngineå·¥å…·é›†:
â”œâ”€ HistoricalDataAnalyzer (å†å²æ•°æ®åˆ†æ)
â”œâ”€ BacktestEngine (å›æµ‹å¼•æ“)
â”œâ”€ QuantitativeScorer (é‡åŒ–è¯„åˆ†)
â”œâ”€ RiskAssessor (é£é™©è¯„ä¼°)
â””â”€ FactorAnalyzer (å› å­åˆ†æï¼Œä¿ç•™sentiment_analyzer)
```

---

### 2.3 ForumEngineè®ºå›åä½œæœºåˆ¶

#### 2.3.1 ç›‘æ§ä¸è§¦å‘æµç¨‹

```
ForumEngine.monitor.monitor_logs() [åå°çº¿ç¨‹ï¼Œæ¯ç§’æ£€æŸ¥ä¸€æ¬¡]
    â†“
æ£€æµ‹ä¸‰ä¸ªæ—¥å¿—æ–‡ä»¶çš„å˜åŒ–
    â”œâ”€ logs/insight.log
    â”œâ”€ logs/media.log
    â””â”€ logs/query.log
    â†“
å‘ç°FirstSummaryNodeè¾“å‡º â†’ è§¦å‘æœç´¢ä¼šè¯
    â”œâ”€ æ¸…ç©ºforum.log
    â””â”€ is_searching = True
    â†“
æ•è·SummaryNodeè¾“å‡º (æ­£åˆ™åŒ¹é…)
    â”œâ”€ ç›®æ ‡: FirstSummaryNode, ReflectionSummaryNode
    â”œâ”€ æå–: JSONæ ¼å¼çš„æ€»ç»“å†…å®¹
    â””â”€ è§£æ: {"paragraph_latest_state": "..."}
    â†“
å†™å…¥forum.log
    æ ¼å¼: [HH:MM:SS] [AGENT_NAME] æ€»ç»“å†…å®¹
    ä¾‹å¦‚: [14:32:15] [INSIGHT] æ ¹æ®æ•°æ®åº“æŸ¥è¯¢ç»“æœï¼Œè¯¥è¯é¢˜çƒ­åº¦åœ¨...
    â†“
ç´¯ç§¯Agentå‘è¨€ (agent_speeches_buffer)
    â†“
è¾¾åˆ°é˜ˆå€¼ (5æ¡å‘è¨€) â†’ è§¦å‘ä¸»æŒäºº
    â†“
ForumEngine.llm_host.generate_host_speech(recent_5_speeches)
    â””â”€ è°ƒç”¨Qwen3-235Bæ¨¡å‹
        è¾“å…¥: æœ€è¿‘5æ¡Agentå‘è¨€
        è¾“å‡º: ä¸»æŒäººç»¼åˆåˆ†æï¼ˆ1000å­—ä»¥å†…ï¼‰
        Promptç»“æ„:
        â”œâ”€ ä¸€ã€äº‹ä»¶æ¢³ç†ä¸æ—¶é—´çº¿åˆ†æ
        â”œâ”€ äºŒã€è§‚ç‚¹æ•´åˆä¸å¯¹æ¯”åˆ†æ
        â”œâ”€ ä¸‰ã€æ·±å±‚æ¬¡åˆ†æä¸è¶‹åŠ¿é¢„æµ‹
        â””â”€ å››ã€é—®é¢˜å¼•å¯¼ä¸è®¨è®ºæ–¹å‘
    â†“
å†™å…¥forum.log
    æ ¼å¼: [HH:MM:SS] [HOST] ä¸»æŒäººå‘è¨€å†…å®¹
    â†“
Agentè¯»å–è®ºå›å†…å®¹
    â””â”€ utils/forum_reader.py:read_forum_log()
        â””â”€ å„Agentçš„ReflectionNodeä¼šè¯»å–HOSTå‘è¨€
            â””â”€ æ ¹æ®ä¸»æŒäººå¼•å¯¼è°ƒæ•´åç»­æœç´¢æ–¹å‘
```

#### 2.3.2 å…³é”®ä»£ç å®ç°

**æ—¥å¿—ç›‘æ§æ ¸å¿ƒé€»è¾‘**
```python
# ForumEngine/monitor.py:455-567
def monitor_logs(self):
    while self.is_monitoring:
        for app_name, log_file in self.monitored_logs.items():
            new_lines = self.read_new_lines(log_file, app_name)
            
            # æ•è·JSONæ ¼å¼çš„æ€»ç»“
            captured_contents = self.process_lines_for_json(new_lines, app_name)
            
            for content in captured_contents:
                source_tag = app_name.upper()  # INSIGHT/MEDIA/QUERY
                self.write_to_forum_log(content, source_tag)
                self.agent_speeches_buffer.append(log_line)
                
                # æ£€æŸ¥æ˜¯å¦è¾¾åˆ°è§¦å‘é˜ˆå€¼
                if len(self.agent_speeches_buffer) >= 5:
                    self._trigger_host_speech()  # åŒæ­¥è°ƒç”¨ï¼Œé˜»å¡ç­‰å¾…
```

**ä¸»æŒäººå‘è¨€ç”Ÿæˆ**
```python
# ForumEngine/llm_host.py:57-93
def generate_host_speech(self, forum_logs: List[str]):
    parsed_content = self._parse_forum_logs(forum_logs)
    system_prompt = self._build_system_prompt()  # è§’è‰²å®šä¹‰
    user_prompt = self._build_user_prompt(parsed_content)  # å…·ä½“ä»»åŠ¡
    
    response = self.client.chat.completions.create(
        model="Qwen/Qwen3-235B-A22B-Instruct-2507",
        messages=[
            {"role": "system", "content": system_prompt},
            {"role": "user", "content": user_prompt}
        ],
        temperature=0.6,
        top_p=0.9
    )
    return self._format_host_speech(response.choices[0].message.content)
```

---

### 2.4 ReportEngineæœ€ç»ˆæŠ¥å‘Šç”Ÿæˆ

#### 2.4.1 æŠ¥å‘Šç”Ÿæˆæµç¨‹

```
å‰ç«¯è§¦å‘ (POST /api/report/generate)
    â†“
ReportEngine.flask_interface.generate_report_api()
    â”œâ”€ æ£€æŸ¥è¾“å…¥æ–‡ä»¶å‡†å¤‡æƒ…å†µ
    â”‚   â””â”€ ReportAgent.check_input_files()
    â”‚       â””â”€ FileCountBaseline: æ¯”å¯¹åŸºå‡†æ–‡ä»¶æ•°é‡
    â”‚           â””â”€ æ£€æµ‹æ–°å¢çš„.mdæ–‡ä»¶ï¼ˆä¸‰ä¸ªAgentï¼‰
    â”‚               â”œâ”€ insight_engine_streamlit_reports/
    â”‚               â”œâ”€ media_engine_streamlit_reports/
    â”‚               â””â”€ query_engine_streamlit_reports/
    â”‚           â””â”€ æ£€æŸ¥forum.logæ˜¯å¦å­˜åœ¨
    â”‚
    â”œâ”€ åŠ è½½è¾“å…¥æ–‡ä»¶
    â”‚   â””â”€ ReportAgent.load_input_files()
    â”‚       â””â”€ è¯»å–æœ€æ–°çš„ä¸‰ä»½æŠ¥å‘Š + forum.log
    â”‚
    â””â”€ ç”Ÿæˆç»¼åˆæŠ¥å‘Š
        â””â”€ ReportAgent.generate_report(query, reports, forum_logs)
            â†“
        [æ­¥éª¤1] _select_template()
            â””â”€ TemplateSelectionNode.run()
                â””â”€ LLMè°ƒç”¨: åˆ†ææŸ¥è¯¢ç±»å‹ï¼Œé€‰æ‹©æœ€åˆé€‚çš„æŠ¥å‘Šæ¨¡æ¿
                    è¾“å…¥: ç”¨æˆ·æŸ¥è¯¢ + ä¸‰ä»½æŠ¥å‘Šæ‘˜è¦ + è®ºå›æ—¥å¿—æ‘˜è¦
                    è¾“å‡º: {"template_name": "...", "selection_reason": "..."}
                    ä½œç”¨: åŒ¹é…é¢„å®šä¹‰æ¨¡æ¿ï¼ˆç¤¾ä¼šçƒ­ç‚¹/å“ç‰Œèˆ†æƒ…/çªå‘äº‹ä»¶...ï¼‰
                    æ¨¡æ¿åº“ä½ç½®: ReportEngine/report_template/*.md
            â†“
        [æ­¥éª¤2] _generate_html_report()
            â””â”€ HTMLGenerationNode.run()
                â””â”€ LLMè°ƒç”¨: å¤šè½®ç”ŸæˆHTMLæŠ¥å‘Šï¼ˆåˆ†æ®µç”Ÿæˆï¼Œé¿å…tokené™åˆ¶ï¼‰
                    è¾“å…¥:
                    â”œâ”€ query: åŸå§‹æŸ¥è¯¢
                    â”œâ”€ query_engine_report: QueryEngineçš„æŠ¥å‘Š
                    â”œâ”€ media_engine_report: MediaEngineçš„æŠ¥å‘Š
                    â”œâ”€ insight_engine_report: InsightEngineçš„æŠ¥å‘Š
                    â”œâ”€ forum_logs: å®Œæ•´è®ºå›å¯¹è¯è®°å½•
                    â””â”€ selected_template: é€‰å®šçš„æŠ¥å‘Šæ¨¡æ¿
                    
                    ç”Ÿæˆç­–ç•¥:
                    â”œâ”€ ç¬¬1è½®: ç”ŸæˆæŠ¥å‘Šæ ‡é¢˜ã€æ‘˜è¦ã€ç›®å½•ç»“æ„
                    â”œâ”€ ç¬¬2-Nè½®: é€æ®µç”Ÿæˆè¯¦ç»†å†…å®¹
                    â”‚   â””â”€ æ¯è½®èšç„¦ä¸€ä¸ªæŠ¥å‘Šç« èŠ‚
                    â”‚       â””â”€ èåˆä¸‰ä¸ªAgentçš„åˆ†æ + è®ºå›è®¨è®º
                    â””â”€ æœ€å1è½®: ç”Ÿæˆç»“è®ºã€æ·»åŠ å›¾è¡¨ã€ç¾åŒ–CSS
                    
                    è¾“å‡º: å®Œæ•´çš„HTMLæ–‡æ¡£ï¼ˆåŒ…å«å†…è”CSSï¼‰
                    ä½œç”¨: 
                    â”œâ”€ å»é™¤å†—ä½™ä¿¡æ¯
                    â”œâ”€ ç»Ÿä¸€å™è¿°é£æ ¼
                    â”œâ”€ æ·»åŠ å¯è§†åŒ–å…ƒç´ ï¼ˆå›¾è¡¨ã€æ—¶é—´çº¿ï¼‰
                    â””â”€ ç”Ÿæˆä¸“ä¸šçº§æ’ç‰ˆ
            â†“
        [æ­¥éª¤3] _save_report(html_content)
            â””â”€ ä¿å­˜åˆ° final_reports/final_report_{timestamp}.html
```

#### 2.4.2 å…³é”®ä»£ç å®ç°

**æ¨¡æ¿é€‰æ‹©èŠ‚ç‚¹**
```python
# ReportEngine/nodes/template_selection.py
class TemplateSelectionNode:
    def run(self, input_data):
        # è¯»å–æ‰€æœ‰å¯ç”¨æ¨¡æ¿
        templates = self._load_templates()  # ä»report_template/ç›®å½•
        
        # æ„å»ºprompt
        prompt = f"""
        æŸ¥è¯¢: {input_data['query']}
        
        å¯ç”¨æ¨¡æ¿:
        {self._format_templates(templates)}
        
        è¯·åˆ†ææŸ¥è¯¢ç±»å‹ï¼Œé€‰æ‹©æœ€åˆé€‚çš„æŠ¥å‘Šæ¨¡æ¿ã€‚
        """
        
        response = self.llm_client.chat(prompt)
        return self._parse_selection(response)
```

**HTMLç”ŸæˆèŠ‚ç‚¹ï¼ˆå¤šè½®ç”Ÿæˆï¼‰**
```python
# ReportEngine/nodes/html_generation.py
class HTMLGenerationNode:
    def run(self, input_data):
        html_parts = []
        
        # ç¬¬1è½®: ç”ŸæˆæŠ¥å‘Šå¤´éƒ¨
        header = self._generate_header(input_data['query'])
        html_parts.append(header)
        
        # ç¬¬2-Nè½®: é€æ®µç”Ÿæˆå†…å®¹
        for section in self._parse_template_sections(input_data['selected_template']):
            section_html = self._generate_section(
                section,
                insight_report=input_data['insight_engine_report'],
                media_report=input_data['media_engine_report'],
                query_report=input_data['query_engine_report'],
                forum_context=input_data['forum_logs']
            )
            html_parts.append(section_html)
        
        # æœ€åä¸€è½®: æ·»åŠ CSSå’ŒJS
        final_html = self._assemble_html(html_parts)
        return final_html
```

---

## ä¸‰ã€AIä½¿ç”¨æƒ…å†µè¯¦ç»†åˆ†æ

### 3.1 AIæ¨¡å‹åœ¨ç³»ç»Ÿä¸­çš„åˆ†å¸ƒ

| AIæ¨¡å‹ | ä½¿ç”¨ä½ç½® | æ¨¡å‹é€‰å‹ | ä¸»è¦ä½œç”¨ |
|--------|---------|---------|---------|
| ä¸»åˆ†ææ¨¡å‹ | QueryEngine | DeepSeek Reasoner | é€»è¾‘æ¨ç†ã€æœç´¢ç­–ç•¥åˆ¶å®š |
| ä¸»åˆ†ææ¨¡å‹ | MediaEngine | Gemini 2.5 Pro | å¤šæ¨¡æ€ç†è§£ã€å›¾æ–‡åˆ†æ |
| ä¸»åˆ†ææ¨¡å‹ | InsightEngine | Kimi K2 | é•¿æ–‡æœ¬å¤„ç†ã€æ•°æ®æŒ–æ˜ |
| è®ºå›ä¸»æŒäºº | ForumEngine | Qwen3-235B | å¤šè§†è§’æ•´åˆã€è®¨è®ºå¼•å¯¼ |
| æŠ¥å‘Šç”Ÿæˆ | ReportEngine | Gemini 2.5 Pro | HTMLæ’ç‰ˆã€å†…å®¹æ¶¦è‰² |
| å…³é”®è¯ä¼˜åŒ– | InsightEngineä¸­é—´ä»¶ | Qwen3-30B | æœç´¢è¯æ‰©å±•ã€åŒä¹‰è¯ç”Ÿæˆ |
| æƒ…æ„Ÿåˆ†æ | InsightEngineä¸­é—´ä»¶ | å¤šè¯­è¨€BERT | æ–‡æœ¬æƒ…æ„Ÿåˆ†ç±» |

### 3.2 å„æ¨¡å—AIè°ƒç”¨è¯¦è§£

#### 3.2.1 QueryEngineçš„AIä½¿ç”¨

**èŠ‚ç‚¹1: ReportStructureNode**
```python
è¾“å…¥:
{
    "query": "æ­¦æ±‰å¤§å­¦èˆ†æƒ…åˆ†æ"
}

Promptæ¨¡æ¿: (prompts/prompts.py:REPORT_STRUCTURE_PROMPT)
"""
è¯·åˆ†æä»¥ä¸‹æŸ¥è¯¢ï¼Œç”Ÿæˆä¸€ä¸ªç»“æ„åŒ–çš„ç ”ç©¶æŠ¥å‘Šå¤§çº²ã€‚
æŸ¥è¯¢: {query}

è¦æ±‚:
1. æŠ¥å‘Šåº”åŒ…å«3-6ä¸ªæ®µè½
2. æ¯ä¸ªæ®µè½åº”èšç„¦ä¸€ä¸ªå…·ä½“æ–¹é¢
3. æ®µè½ä¹‹é—´åº”æœ‰é€»è¾‘å…³è”
4. è¾“å‡ºJSONæ ¼å¼...
"""

LLMè¾“å‡º:
{
    "report_title": "æ­¦æ±‰å¤§å­¦å“ç‰Œå£°èª‰æ·±åº¦åˆ†ææŠ¥å‘Š",
    "paragraphs": [
        {
            "title": "æ­¦æ±‰å¤§å­¦è¿‘æœŸæ–°é—»çƒ­ç‚¹æ¢³ç†",
            "content": "æ”¶é›†å¹¶åˆ†ææœ€è¿‘3ä¸ªæœˆå†…å…³äºæ­¦æ±‰å¤§å­¦çš„ä¸»è¦æ–°é—»æŠ¥é“..."
        },
        {
            "title": "ç¤¾ä¼šèˆ†è®ºæ€åº¦ä¸æƒ…æ„Ÿå€¾å‘",
            "content": "åˆ†æå…¬ä¼—å¯¹æ­¦æ±‰å¤§å­¦çš„æƒ…æ„Ÿæ€åº¦ï¼ŒåŒºåˆ†æ­£é¢ã€ä¸­æ€§ã€è´Ÿé¢è§‚ç‚¹..."
        },
        ...
    ]
}

ä½œç”¨:
- å°†æŠ½è±¡æŸ¥è¯¢å…·ä½“åŒ–ä¸ºå¯æ‰§è¡Œçš„ç ”ç©¶è®¡åˆ’
- ç¡®ä¿åˆ†æçš„å…¨é¢æ€§å’Œç³»ç»Ÿæ€§
- ä¸ºåç»­æœç´¢æä¾›æ˜ç¡®çš„æ–¹å‘
```

**èŠ‚ç‚¹2: FirstSearchNode**
```python
è¾“å…¥:
{
    "title": "æ­¦æ±‰å¤§å­¦è¿‘æœŸæ–°é—»çƒ­ç‚¹æ¢³ç†",
    "content": "æ”¶é›†å¹¶åˆ†ææœ€è¿‘3ä¸ªæœˆå†…å…³äºæ­¦æ±‰å¤§å­¦çš„ä¸»è¦æ–°é—»æŠ¥é“..."
}

Promptæ¨¡æ¿: (prompts/prompts.py:FIRST_SEARCH_PROMPT)
"""
ä½ éœ€è¦ä¸ºä»¥ä¸‹ç ”ç©¶ä»»åŠ¡ç”Ÿæˆæœ€ä¼˜çš„æœç´¢ç­–ç•¥ã€‚

æ®µè½æ ‡é¢˜: {title}
ç ”ç©¶è¦æ±‚: {content}

å¯ç”¨æœç´¢å·¥å…·:
1. basic_search_news: åŸºç¡€æ–°é—»æœç´¢ï¼ˆ7æ¡ç»“æœï¼Œé€Ÿåº¦å¿«ï¼‰
2. search_news_last_week: æœ¬å‘¨æ–°é—»ï¼ˆè¦†ç›–æœ€è¿‘7å¤©ï¼‰
3. search_news_by_date: æŒ‰æ—¥æœŸèŒƒå›´æœç´¢ï¼ˆéœ€æŒ‡å®šstart_dateå’Œend_dateï¼‰
...

è¯·è¾“å‡º:
{
    "search_query": "ç²¾ç‚¼çš„æœç´¢å…³é”®è¯",
    "search_tool": "æœ€åˆé€‚çš„å·¥å…·åç§°",
    "reasoning": "é€‰æ‹©ç†ç”±",
    "start_date": "2024-01-01",  // å¦‚ä½¿ç”¨search_news_by_date
    "end_date": "2024-03-31"
}
"""

LLMè¾“å‡º:
{
    "search_query": "æ­¦æ±‰å¤§å­¦ æ–°é—» çƒ­ç‚¹äº‹ä»¶",
    "search_tool": "search_news_last_week",
    "reasoning": "ç ”ç©¶èšç„¦è¿‘æœŸçƒ­ç‚¹ï¼Œæœ¬å‘¨æ–°é—»æœ€ä¸ºç›¸å…³ä¸”æ—¶æ•ˆæ€§å¼º"
}

æ‰§è¡Œæœç´¢:
TavilyNewsAgency.search_news_last_week("æ­¦æ±‰å¤§å­¦ æ–°é—» çƒ­ç‚¹äº‹ä»¶")
    â†’ è¿”å›7-10æ¡æ–°é—»ç»“æœ

ä½œç”¨:
- è‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„æœç´¢å·¥å…·
- ç”Ÿæˆç²¾å‡†çš„æœç´¢å…³é”®è¯
- é¿å…æ— æ•ˆæœç´¢ï¼Œæé«˜ä¿¡æ¯è´¨é‡
```

**èŠ‚ç‚¹3: FirstSummaryNode**
```python
è¾“å…¥:
{
    "title": "æ­¦æ±‰å¤§å­¦è¿‘æœŸæ–°é—»çƒ­ç‚¹æ¢³ç†",
    "content": "æ”¶é›†å¹¶åˆ†ææœ€è¿‘3ä¸ªæœˆå†…...",
    "search_query": "æ­¦æ±‰å¤§å­¦ æ–°é—» çƒ­ç‚¹äº‹ä»¶",
    "search_results": [
        {
            "title": "æ­¦æ±‰å¤§å­¦æ¨±èŠ±å­£å¼•å‘å…³æ³¨...",
            "content": "...",
            "published_date": "2024-03-20"
        },
        ...
    ]
}

Promptæ¨¡æ¿: (prompts/prompts.py:FIRST_SUMMARY_PROMPT)
"""
åŸºäºä»¥ä¸‹æœç´¢ç»“æœï¼Œæ’°å†™è¯¥æ®µè½çš„åˆæ­¥æ€»ç»“ã€‚

æ®µè½è¦æ±‚: {content}
æœç´¢ç»“æœ:
{formatted_search_results}

è¦æ±‚:
1. æå–å…³é”®ä¿¡æ¯ï¼Œå»é™¤å†—ä½™
2. ä¿æŒå®¢è§‚ä¸­ç«‹çš„å™è¿°
3. å¼•ç”¨å…·ä½“æ•°æ®å’Œäº‹å®
4. é•¿åº¦æ§åˆ¶åœ¨300-500å­—
5. ä½¿ç”¨å­¦æœ¯æŠ¥å‘Šçš„è¯­è¨€é£æ ¼
"""

LLMè¾“å‡º:
{
    "paragraph_latest_state": "æ ¹æ®è¿‘æœŸæ–°é—»æŠ¥é“ï¼Œæ­¦æ±‰å¤§å­¦åœ¨2024å¹´3æœˆå‡ºç°å¤šä¸ªçƒ­ç‚¹äº‹ä»¶ã€‚
    é¦–å…ˆæ˜¯æ¨±èŠ±å­£æœŸé—´çš„æ¸¸å®¢ç®¡ç†é—®é¢˜ï¼Œå•æ—¥æ¥å¾…é‡çªç ´10ä¸‡äººæ¬¡ï¼Œå¼•å‘æ ¡å›­ç§©åºè®¨è®º...
    ï¼ˆå¼•ç”¨å…·ä½“æ–°é—»æ¥æºå’Œæ•°æ®ï¼‰"
}

ä½œç”¨:
- ä»æµ·é‡æœç´¢ç»“æœä¸­æå–æ ¸å¿ƒä¿¡æ¯
- ç»„ç»‡æˆè¿è´¯ã€å¯è¯»çš„æ®µè½
- ä¸ºåç»­åæ€æä¾›åŸºç¡€ç‰ˆæœ¬
```

**èŠ‚ç‚¹4: ReflectionNode**
```python
è¾“å…¥:
{
    "title": "æ­¦æ±‰å¤§å­¦è¿‘æœŸæ–°é—»çƒ­ç‚¹æ¢³ç†",
    "content": "æ”¶é›†å¹¶åˆ†ææœ€è¿‘3ä¸ªæœˆå†…...",
    "paragraph_latest_state": "æ ¹æ®è¿‘æœŸæ–°é—»æŠ¥é“ï¼Œæ­¦æ±‰å¤§å­¦åœ¨2024å¹´3æœˆ..."
}

Promptæ¨¡æ¿: (prompts/prompts.py:REFLECTION_PROMPT)
"""
è¯·å®¡è§†å½“å‰æ®µè½çš„æ€»ç»“ï¼Œæ€è€ƒä»¥ä¸‹é—®é¢˜:
1. æ˜¯å¦é—æ¼äº†å…³é”®ä¿¡æ¯ï¼Ÿ
2. æ˜¯å¦å­˜åœ¨å•ä¸€è§†è§’çš„å±€é™ï¼Ÿ
3. æ˜¯å¦éœ€è¦è¡¥å……æ•°æ®æ”¯æ’‘ï¼Ÿ
4. æ˜¯å¦éœ€è¦å¯¹æ¯”åˆ†æï¼Ÿ

å½“å‰æ€»ç»“:
{paragraph_latest_state}

å¦‚æœéœ€è¦è¡¥å……ä¿¡æ¯ï¼Œè¯·è¾“å‡ºæ–°çš„æœç´¢ç­–ç•¥:
{
    "search_query": "...",
    "search_tool": "...",
    "reasoning": "å‘ç°çš„é—®é¢˜å’Œè¡¥å……ç†ç”±"
}
"""

LLMè¾“å‡º:
{
    "search_query": "æ­¦æ±‰å¤§å­¦ æ¨±èŠ±å­£ ç®¡ç†æªæ–½ åº”å¯¹æ–¹æ¡ˆ",
    "search_tool": "basic_search_news",
    "reasoning": "å½“å‰æ€»ç»“ä»…æåˆ°äº†é—®é¢˜ï¼Œç¼ºä¹å­¦æ ¡çš„åº”å¯¹æªæ–½å’Œåç»­æ”¹è¿›æ–¹æ¡ˆï¼Œ
    éœ€è¦è¡¥å……å®˜æ–¹å›åº”å’Œè§£å†³æ–¹æ¡ˆçš„ä¿¡æ¯"
}

ä½œç”¨:
- è‡ªæˆ‘å®¡è§†ï¼Œå‘ç°çŸ¥è¯†ç›²ç‚¹
- ä¸»åŠ¨è¡¥å……å¤šå…ƒè§†è§’
- æé«˜åˆ†æçš„æ·±åº¦å’Œå…¨é¢æ€§
```

**èŠ‚ç‚¹5: ReflectionSummaryNode**
```python
è¾“å…¥:
{
    "title": "...",
    "paragraph_latest_state": "æ—§ç‰ˆæ€»ç»“",
    "search_query": "è¡¥å……æœç´¢çš„æŸ¥è¯¢è¯",
    "search_results": [æ–°æœç´¢ç»“æœ]
}

Promptæ¨¡æ¿: (prompts/prompts.py:REFLECTION_SUMMARY_PROMPT)
"""
åŸºäºæ–°çš„æœç´¢ç»“æœï¼Œæ›´æ–°æ®µè½æ€»ç»“ã€‚

åŸæœ‰æ€»ç»“:
{paragraph_latest_state}

æ–°æœç´¢ç»“æœ:
{formatted_search_results}

è¦æ±‚:
1. èåˆæ–°ä¿¡æ¯ï¼Œä¿ç•™åŸæœ‰æœ‰æ•ˆå†…å®¹
2. é¿å…ç®€å•æ‹¼æ¥ï¼Œä¿æŒé€»è¾‘è¿è´¯
3. è¡¥å……ç¼ºå¤±çš„è§†è§’å’Œæ•°æ®
4. å¦‚å‘ç°çŸ›ç›¾ä¿¡æ¯ï¼Œéœ€è¯´æ˜å¹¶åˆ†æ
"""

LLMè¾“å‡º:
{
    "updated_paragraph_latest_state": "æ ¹æ®è¿‘æœŸæ–°é—»æŠ¥é“ï¼Œæ­¦æ±‰å¤§å­¦åœ¨2024å¹´3æœˆ...
    ï¼ˆåŸæœ‰å†…å®¹ï¼‰
    é’ˆå¯¹æ¸¸å®¢ç®¡ç†é—®é¢˜ï¼Œæ ¡æ–¹å·²å®æ–½é¢„çº¦åˆ¶åº¦ï¼Œå¹¶å¢æ´¾å®‰ä¿äººå‘˜200åï¼Œ
    åŒæ—¶ä¸æ­¦æ±‰å¸‚æ”¿åºœåˆä½œå¼€é€šä¸´æ—¶äº¤é€šä¸“çº¿...ï¼ˆæ–°å¢å†…å®¹ï¼‰"
}

ä½œç”¨:
- å¢é‡æ›´æ–°ï¼Œé¿å…ä¿¡æ¯ä¸¢å¤±
- èåˆå¤šæ¬¡æœç´¢çš„ç»“æœ
- å½¢æˆæ›´å®Œæ•´ã€å¹³è¡¡çš„åˆ†æ
```

**èŠ‚ç‚¹6: ReportFormattingNode**
```python
è¾“å…¥:
[
    {
        "title": "æ­¦æ±‰å¤§å­¦è¿‘æœŸæ–°é—»çƒ­ç‚¹æ¢³ç†",
        "paragraph_latest_state": "å®Œæ•´æ®µè½1å†…å®¹"
    },
    {
        "title": "ç¤¾ä¼šèˆ†è®ºæ€åº¦ä¸æƒ…æ„Ÿå€¾å‘",
        "paragraph_latest_state": "å®Œæ•´æ®µè½2å†…å®¹"
    },
    ...
]

Promptæ¨¡æ¿: (prompts/prompts.py:REPORT_FORMATTING_PROMPT)
"""
è¯·å°†ä»¥ä¸‹æ®µè½æ•´åˆä¸ºä¸€ä»½å®Œæ•´çš„Markdownæ ¼å¼æŠ¥å‘Šã€‚

è¦æ±‚:
1. æ·»åŠ åˆé€‚çš„æ ‡é¢˜å±‚çº§ï¼ˆ# ## ###ï¼‰
2. æ®µè½ä¹‹é—´æ·»åŠ è¿‡æ¸¡å¥ï¼Œä¿æŒé€»è¾‘æµç•…
3. ç»Ÿä¸€è¯­è¨€é£æ ¼ï¼Œå»é™¤é‡å¤è¡¨è¿°
4. æ·»åŠ æŠ¥å‘Šæ‘˜è¦å’Œç»“è®º
5. é€‚å½“æ·»åŠ åˆ—è¡¨ã€è¡¨æ ¼ç­‰æ ¼å¼
"""

LLMè¾“å‡º:
"""
# æ­¦æ±‰å¤§å­¦å“ç‰Œå£°èª‰æ·±åº¦åˆ†ææŠ¥å‘Š

## æ‰§è¡Œæ‘˜è¦
æœ¬æŠ¥å‘Šé’ˆå¯¹æ­¦æ±‰å¤§å­¦2024å¹´ç¬¬ä¸€å­£åº¦çš„èˆ†æƒ…çŠ¶å†µè¿›è¡Œæ·±åº¦åˆ†æ...

## ä¸€ã€è¿‘æœŸæ–°é—»çƒ­ç‚¹æ¢³ç†
...ï¼ˆæ•´åˆåçš„æ®µè½1ï¼‰

## äºŒã€ç¤¾ä¼šèˆ†è®ºæ€åº¦åˆ†æ
...ï¼ˆæ•´åˆåçš„æ®µè½2ï¼‰
...
"""

ä½œç”¨:
- ç»Ÿä¸€æŠ¥å‘Šé£æ ¼
- ä¼˜åŒ–å¯è¯»æ€§
- æ·»åŠ ä¸“ä¸šæŠ¥å‘Šç»“æ„
```

#### 3.2.2 InsightEngineçš„AIä½¿ç”¨ + ä¸­é—´ä»¶

**ç‰¹æœ‰çš„å…³é”®è¯ä¼˜åŒ–ä¸­é—´ä»¶**
```python
# InsightEngine/tools/keyword_optimizer.py

è¾“å…¥:
{
    "original_query": "æ­¦æ±‰å¤§å­¦",
    "context": "ä½¿ç”¨search_topic_globallyå·¥å…·è¿›è¡ŒæŸ¥è¯¢"
}

AIæ¨¡å‹: Qwen3-30B-A3B-Instruct (å°å‚æ•°æ¨¡å‹ï¼Œå¿«é€Ÿå“åº”)

Prompt:
"""
ä½ æ˜¯ä¸€ä¸ªå…³é”®è¯ä¼˜åŒ–ä¸“å®¶ã€‚ç”¨æˆ·è¦æœç´¢æ•°æ®åº“ä¸­çš„è¯é¢˜ï¼Œ
è¯·å°†æŸ¥è¯¢è¯æ‰©å±•ä¸ºå¤šä¸ªç›¸å…³çš„å…³é”®è¯ï¼Œä»¥æé«˜å¬å›ç‡ã€‚

åŸå§‹æŸ¥è¯¢: {original_query}

è¦æ±‚:
1. ç”Ÿæˆ2-4ä¸ªç›¸å…³å…³é”®è¯
2. åŒ…å«åŒä¹‰è¯ã€ç¼©å†™ã€å¸¸è§è¡¨è¿°
3. é¿å…è¿‡åº¦æ³›åŒ–
4. è¾“å‡ºJSONæ ¼å¼:
{
    "optimized_keywords": ["å…³é”®è¯1", "å…³é”®è¯2", ...],
    "reasoning": "ä¼˜åŒ–ç†ç”±"
}
"""

LLMè¾“å‡º:
{
    "optimized_keywords": ["æ­¦æ±‰å¤§å­¦", "æ­¦å¤§", "WHU", "Wuhan University"],
    "reasoning": "åŒ…å«å®˜æ–¹å…¨ç§°ã€å¸¸ç”¨ç®€ç§°ã€è‹±æ–‡åç§°ï¼Œè¦†ç›–ä¸åŒè¡¨è¿°ä¹ æƒ¯"
}

æ‰§è¡Œæ•ˆæœ:
åŸæœ¬åªæœç´¢"æ­¦æ±‰å¤§å­¦" â†’ ç°åœ¨å¹¶è¡Œæœç´¢4ä¸ªå…³é”®è¯ â†’ å¬å›ç‡æå‡3-5å€
```

**æƒ…æ„Ÿåˆ†æä¸­é—´ä»¶**
```python
# InsightEngine/tools/sentiment_analyzer.py

è¾“å…¥: æ•°æ®åº“æŸ¥è¯¢ç»“æœï¼ˆä¾‹å¦‚500æ¡è¯„è®ºï¼‰

æ¨¡å‹: WeiboMultilingualSentiment (åŸºäºXLM-RoBERTaï¼Œæ”¯æŒ22ç§è¯­è¨€)

å¤„ç†æµç¨‹:
1. æ‰¹é‡é¢„å¤„ç†ï¼ˆåˆ†è¯ã€æ¸…æ´—ï¼‰
2. æ¨¡å‹æ¨ç†ï¼ˆGPUåŠ é€Ÿï¼‰
   è¾“å…¥: æ–‡æœ¬åºåˆ—
   è¾“å‡º: {
       "label": "positive/neutral/negative",
       "confidence": 0.92
   }
3. èšåˆåˆ†æ
   â””â”€ ç»Ÿè®¡æƒ…æ„Ÿåˆ†å¸ƒ
   â””â”€ è®¡ç®—å¹³å‡ç½®ä¿¡åº¦
   â””â”€ ç­›é€‰é«˜ç½®ä¿¡åº¦æ ·æœ¬ï¼ˆ>0.8ï¼‰

è¾“å‡ºç¤ºä¾‹:
{
    "sentiment_distribution": {
        "positive": 312,
        "neutral": 145,
        "negative": 43
    },
    "average_confidence": 0.87,
    "high_confidence_samples": [
        {
            "text": "æ­¦å¤§æ¨±èŠ±çœŸçš„å¤ªç¾äº†ï¼",
            "sentiment": "positive",
            "confidence": 0.98
        },
        ...
    ]
}

ä½œç”¨:
- é‡åŒ–å…¬ä¼—æƒ…æ„Ÿå€¾å‘
- ä¸ºèˆ†æƒ…åˆ†ææä¾›æ•°æ®æ”¯æ’‘
- è¯†åˆ«æç«¯æƒ…ç»ªæ ·æœ¬
```

#### 3.2.3 ForumEngineçš„AIä½¿ç”¨

**ä¸»æŒäººå‘è¨€ç”Ÿæˆï¼ˆæœ€å¤æ‚çš„AIåº”ç”¨åœºæ™¯ï¼‰**
```python
# ForumEngine/llm_host.py

è¾“å…¥: æœ€è¿‘5æ¡Agentå‘è¨€
[
    "[14:30:12] [QUERY] æ ¹æ®Tavilyæœç´¢ï¼Œæ­¦æ±‰å¤§å­¦æ¨±èŠ±å­£ç›¸å…³æ–°é—»å…±47æ¡...",
    "[14:30:45] [MEDIA] Bochaå¤šæ¨¡æ€æœç´¢æ˜¾ç¤ºï¼Œç›¸å…³å›¾ç‰‡ä¼ æ’­é‡è¾¾120ä¸‡æ¬¡...",
    "[14:31:20] [INSIGHT] æ•°æ®åº“æŸ¥è¯¢åˆ°3æœˆä»½ç›¸å…³è¯é¢˜çƒ­åº¦ç¯æ¯”å¢é•¿340%...",
    "[14:32:15] [QUERY] è¡¥å……æœç´¢å‘ç°ï¼Œå®˜æ–¹å·²å‘å¸ƒé¢„çº¦åˆ¶åº¦...",
    "[14:32:50] [INSIGHT] æƒ…æ„Ÿåˆ†ææ˜¾ç¤ºï¼Œæ­£é¢è¯„ä»·å 62%ï¼Œä¸»è¦é›†ä¸­åœ¨..."
]

AIæ¨¡å‹: Qwen3-235B (å¤§å‚æ•°æ¨¡å‹ï¼Œå¼ºæ¨ç†èƒ½åŠ›)

System Prompt: (llm_host.py:134-163)
"""
ä½ æ˜¯ä¸€ä¸ªå¤šagentèˆ†æƒ…åˆ†æç³»ç»Ÿçš„è®ºå›ä¸»æŒäººã€‚

Agentä»‹ç»:
- INSIGHT Agent: ä¸“æ³¨äºç§æœ‰èˆ†æƒ…æ•°æ®åº“çš„æ·±åº¦æŒ–æ˜
- MEDIA Agent: æ“…é•¿å¤šæ¨¡æ€å†…å®¹åˆ†æ
- QUERY Agent: è´Ÿè´£ç²¾å‡†ä¿¡æ¯æœç´¢

ä½ çš„èŒè´£:
1. äº‹ä»¶æ¢³ç†: è¯†åˆ«å…³é”®äº‹ä»¶ã€æ—¶é—´èŠ‚ç‚¹
2. å¼•å¯¼è®¨è®º: å¼•å¯¼æ·±å…¥è®¨è®ºå…³é”®é—®é¢˜
3. çº æ­£é”™è¯¯: å‘ç°äº‹å®é”™è¯¯æˆ–é€»è¾‘çŸ›ç›¾
4. æ•´åˆè§‚ç‚¹: ç»¼åˆä¸åŒagentçš„è§†è§’
5. è¶‹åŠ¿é¢„æµ‹: åˆ†æèˆ†æƒ…å‘å±•è¶‹åŠ¿
6. æ¨è¿›åˆ†æ: æå‡ºæ–°çš„åˆ†æè§’åº¦
"""

User Prompt: (llm_host.py:176-207)
"""
è¯·åŸºäºä»¥ä¸Š5æ¡agentå‘è¨€è¿›è¡Œç»¼åˆåˆ†æï¼ŒæŒ‰ä»¥ä¸‹ç»“æ„ç»„ç»‡:

ä¸€ã€äº‹ä»¶æ¢³ç†ä¸æ—¶é—´çº¿åˆ†æ
äºŒã€è§‚ç‚¹æ•´åˆä¸å¯¹æ¯”åˆ†æ
ä¸‰ã€æ·±å±‚æ¬¡åˆ†æä¸è¶‹åŠ¿é¢„æµ‹
å››ã€é—®é¢˜å¼•å¯¼ä¸è®¨è®ºæ–¹å‘

æ§åˆ¶åœ¨1000å­—ä»¥å†…ã€‚
"""

LLMè¾“å‡ºç¤ºä¾‹:
"""
ä¸€ã€äº‹ä»¶æ¢³ç†ä¸æ—¶é—´çº¿åˆ†æ

ä»ä¸‰ä¸ªagentçš„å‘è¨€ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ™°åœ°å‹¾å‹’å‡ºæ­¦æ±‰å¤§å­¦æ¨±èŠ±å­£äº‹ä»¶çš„å‘å±•è„‰ç»œ:

3æœˆåˆï¼ˆçƒ­åº¦çˆ†å‘æœŸï¼‰: INSIGHTæ•°æ®æ˜¾ç¤ºç›¸å…³è¯é¢˜çƒ­åº¦ç¯æ¯”å¢é•¿340%ï¼Œ
MEDIAæ£€æµ‹åˆ°å›¾ç‰‡ä¼ æ’­é‡è¾¾120ä¸‡æ¬¡ï¼Œè¯´æ˜äº‹ä»¶åœ¨ç¤¾äº¤åª’ä½“ä¸Šå¿«é€Ÿå‘é…µ...

3æœˆä¸­æ—¬ï¼ˆé—®é¢˜æš´éœ²æœŸï¼‰: QUERYæœç´¢åˆ°çš„47æ¡æ–°é—»ä¸­ï¼Œå…³é”®è¯"æ¸¸å®¢è¿‡å¤š""ç§©åºæ··ä¹±"
å‡ºç°é¢‘ç‡æœ€é«˜...

3æœˆä¸‹æ—¬ï¼ˆåº”å¯¹è°ƒæ•´æœŸï¼‰: QUERYè¡¥å……æœç´¢å‘ç°å®˜æ–¹å·²å‘å¸ƒé¢„çº¦åˆ¶åº¦...

äºŒã€è§‚ç‚¹æ•´åˆä¸å¯¹æ¯”åˆ†æ

ä¸‰ä¸ªagentçš„æ•°æ®å‘ˆç°å‡ºæœ‰è¶£çš„äº’è¡¥æ€§:

1. æ•°æ®é‡å·®å¼‚: QUERYçš„47æ¡æ–°é—»vs MEDIAçš„120ä¸‡æ¬¡å›¾ç‰‡ä¼ æ’­ï¼Œ
   è¯´æ˜è¯¥äº‹ä»¶åœ¨è§†è§‰ä¼ æ’­å±‚é¢çš„å½±å“åŠ›è¿œè¶…æ–‡å­—æŠ¥é“...

2. æƒ…æ„Ÿå€¾å‘å¯¹æ¯”: INSIGHTçš„æƒ…æ„Ÿåˆ†ææ˜¾ç¤º62%æ­£é¢è¯„ä»·ï¼Œ
   è¿™ä¸æ–°é—»æŠ¥é“ä¸­"æ··ä¹±""é—®é¢˜"ç­‰è´Ÿé¢è¯æ±‡å½¢æˆåå·®...
   
ä¸‰ã€æ·±å±‚æ¬¡åˆ†æä¸è¶‹åŠ¿é¢„æµ‹

...

å››ã€é—®é¢˜å¼•å¯¼ä¸è®¨è®ºæ–¹å‘

åŸºäºä»¥ä¸Šåˆ†æï¼Œå»ºè®®å„agentåœ¨ä¸‹ä¸€è½®ç ”ç©¶ä¸­é‡ç‚¹å…³æ³¨:
1. INSIGHT: æ·±å…¥åˆ†ææ­£é¢è¯„ä»·çš„å…·ä½“å†…å®¹æ„æˆ...
2. MEDIA: è¿½è¸ªé¢„çº¦åˆ¶å®æ–½åçš„å›¾ç‰‡ä¼ æ’­å˜åŒ–...
3. QUERY: æœç´¢å…¶ä»–é«˜æ ¡çš„ç±»ä¼¼äº‹ä»¶å¤„ç†ç»éªŒ...
"""

ä½œç”¨:
- æ‰“ç ´ä¿¡æ¯å­¤å²›ï¼Œå®ç°è·¨AgentçŸ¥è¯†èåˆ
- å‘ç°å•ä¸€Agentæ— æ³•å¯Ÿè§‰çš„æ¨¡å¼å’ŒçŸ›ç›¾
- å¼•å¯¼åç»­åˆ†ææ–¹å‘ï¼Œé¿å…é‡å¤åŠ³åŠ¨
- æå‡æŠ¥å‘Šçš„æ·±åº¦å’Œæ´å¯ŸåŠ›
```

#### 3.2.4 ReportEngineçš„AIä½¿ç”¨

**æ¨¡æ¿é€‰æ‹©ï¼ˆå…ƒè®¤çŸ¥å±‚é¢çš„AIåº”ç”¨ï¼‰**
```python
# ReportEngine/nodes/template_selection.py

è¾“å…¥:
{
    "query": "æ­¦æ±‰å¤§å­¦èˆ†æƒ…åˆ†æ",
    "reports": [query_report, media_report, insight_report],  # æ‘˜è¦ç‰ˆ
    "forum_logs": "è®ºå›è®¨è®ºæ‘˜è¦"
}

å¯ç”¨æ¨¡æ¿åº“: (ReportEngine/report_template/)
- ç¤¾ä¼šå…¬å…±çƒ­ç‚¹äº‹ä»¶åˆ†æ.md
- å•†ä¸šå“ç‰Œèˆ†æƒ…ç›‘æµ‹.md
- æ”¿åºœæ”¿ç­–ä¼ æ’­æ•ˆæœè¯„ä¼°.md
- çªå‘å±æœºäº‹ä»¶åº”å¯¹.md
- æ•™è‚²æœºæ„å£°èª‰ç®¡ç†.md
...

Prompt:
"""
è¯·åˆ†æè¯¥æŸ¥è¯¢çš„æ€§è´¨ï¼Œé€‰æ‹©æœ€åˆé€‚çš„æŠ¥å‘Šæ¨¡æ¿ã€‚

æŸ¥è¯¢: {query}
ä¸‰ä¸ªæŠ¥å‘Šçš„ä¸»è¦å‘ç°: {reports_summary}
è®ºå›è®¨è®ºè¦ç‚¹: {forum_summary}

å¯ç”¨æ¨¡æ¿:
1. ç¤¾ä¼šå…¬å…±çƒ­ç‚¹äº‹ä»¶åˆ†æ - é€‚ç”¨äº: é‡å¤§ç¤¾ä¼šäº‹ä»¶ã€å…¬å…±è®¨è®ºè¯é¢˜...
2. å•†ä¸šå“ç‰Œèˆ†æƒ…ç›‘æµ‹ - é€‚ç”¨äº: ä¼ä¸šå“ç‰Œå½¢è±¡ã€äº§å“å£°èª‰...
3. æ•™è‚²æœºæ„å£°èª‰ç®¡ç† - é€‚ç”¨äº: å­¦æ ¡å½¢è±¡ã€æ•™è‚²æ”¿ç­–ã€æ ¡å›­äº‹ä»¶...
...

è¯·è¾“å‡º:
{
    "template_name": "æ¨¡æ¿åç§°",
    "selection_reason": "é€‰æ‹©ç†ç”±",
    "customization_suggestions": "å»ºè®®çš„å®šåˆ¶åŒ–è°ƒæ•´"
}
"""

LLMè¾“å‡º:
{
    "template_name": "æ•™è‚²æœºæ„å£°èª‰ç®¡ç†",
    "selection_reason": "æŸ¥è¯¢ä¸»ä½“ä¸ºé«˜ç­‰æ•™è‚²æœºæ„ï¼Œäº‹ä»¶æ¶‰åŠæ ¡å›­ç®¡ç†ã€
    å…¬ä¼—å½¢è±¡ï¼Œç¬¦åˆæ•™è‚²æœºæ„å£°èª‰åˆ†æçš„æ¡†æ¶",
    "customization_suggestions": "å»ºè®®å¢åŠ 'æ ¡å‹æ€åº¦'å’Œ'æ‹›ç”Ÿå½±å“'ä¸¤ä¸ªç« èŠ‚"
}

ä½œç”¨:
- è‡ªåŠ¨åŒ¹é…æœ€åˆé€‚çš„æŠ¥å‘Šæ¡†æ¶
- é¿å…ç”Ÿç¡¬å¥—ç”¨æ¨¡æ¿
- æä¾›å®šåˆ¶åŒ–å»ºè®®
```

**HTMLç”Ÿæˆï¼ˆå¤šè½®åä½œç”Ÿæˆï¼‰**
```python
# ReportEngine/nodes/html_generation.py

è¾“å…¥:
{
    "query": "æ­¦æ±‰å¤§å­¦èˆ†æƒ…åˆ†æ",
    "query_engine_report": "å®Œæ•´çš„QueryEngineæŠ¥å‘Šï¼ˆ3000å­—ï¼‰",
    "media_engine_report": "å®Œæ•´çš„MediaEngineæŠ¥å‘Šï¼ˆ2500å­—ï¼‰",
    "insight_engine_report": "å®Œæ•´çš„InsightEngineæŠ¥å‘Šï¼ˆ4000å­—ï¼‰",
    "forum_logs": "å®Œæ•´è®ºå›å¯¹è¯ï¼ˆ5000å­—ï¼‰",
    "selected_template": "æ•™è‚²æœºæ„å£°èª‰ç®¡ç†æ¨¡æ¿å†…å®¹"
}

AIæ¨¡å‹: Gemini 2.5 Pro (é•¿ä¸Šä¸‹æ–‡ï¼Œæ“…é•¿HTMLç”Ÿæˆ)

ç”Ÿæˆç­–ç•¥: åˆ†æ®µå¤šè½®ç”Ÿæˆï¼ˆé¿å…å•æ¬¡tokené™åˆ¶ï¼‰

ç¬¬1è½® - ç”ŸæˆæŠ¥å‘Šå¤´éƒ¨:
Prompt:
"""
åŸºäºä»¥ä¸‹ä¿¡æ¯ï¼Œç”ŸæˆHTMLæŠ¥å‘Šçš„å¤´éƒ¨ï¼ˆæ ‡é¢˜ã€æ‘˜è¦ã€ç›®å½•ï¼‰ã€‚

æŸ¥è¯¢: {query}
ä¸‰ä¸ªæŠ¥å‘Šçš„æ ¸å¿ƒå‘ç°: {æ‘˜è¦}
è®ºå›ä¸»è¦è®¨è®ºç‚¹: {æ‘˜è¦}

è¦æ±‚:
1. ç”Ÿæˆå¸å¼•äººçš„æ ‡é¢˜
2. 200å­—çš„æ‰§è¡Œæ‘˜è¦
3. å®Œæ•´çš„ç›®å½•ç»“æ„ï¼ˆå¸¦é”šé“¾æ¥ï¼‰
4. ä½¿ç”¨ç°ä»£åŒ–çš„CSSæ ·å¼
"""

ç¬¬2è½® - ç”Ÿæˆç¬¬ä¸€ç« :
Prompt:
"""
åŸºäºä»¥ä¸‹èµ„æ–™ï¼Œæ’°å†™æŠ¥å‘Šçš„ç¬¬ä¸€ç« "äº‹ä»¶æ¦‚å†µ"ã€‚

èµ„æ–™æ¥æº:
- QueryEngineæŠ¥å‘Šç›¸å…³ç« èŠ‚: {excerpt}
- MediaEngineæŠ¥å‘Šç›¸å…³ç« èŠ‚: {excerpt}
- InsightEngineæŠ¥å‘Šç›¸å…³ç« èŠ‚: {excerpt}
- è®ºå›è®¨è®ºç›¸å…³å†…å®¹: {excerpt}

è¦æ±‚:
1. èåˆä¸‰ä¸ªagentçš„å‘ç°
2. å¼•ç”¨è®ºå›ä¸­çš„å…³é”®è®¨è®º
3. æ·»åŠ æ—¶é—´çº¿å›¾è¡¨ï¼ˆHTML/CSSï¼‰
4. ä¿æŒå­¦æœ¯æŠ¥å‘Šçš„ä¸¥è°¨æ€§
"""

ç¬¬3-Nè½® - é€ç« ç”Ÿæˆ:
ç±»ä¼¼ç¬¬2è½®ï¼Œé’ˆå¯¹æ¯ä¸€ç« é‡å¤

æœ€åä¸€è½® - ç”Ÿæˆç»“è®ºå’ŒCSSç¾åŒ–:
Prompt:
"""
åŸºäºå‰é¢æ‰€æœ‰ç« èŠ‚ï¼Œæ’°å†™æŠ¥å‘Šç»“è®ºï¼Œå¹¶æ·»åŠ ç¾åŒ–æ ·å¼ã€‚

è¦æ±‚:
1. æ€»ç»“æ ¸å¿ƒå‘ç°ï¼ˆ5-8ä¸ªè¦ç‚¹ï¼‰
2. æå‡ºå»ºè®®ï¼ˆ3-5æ¡ï¼‰
3. æ·»åŠ å“åº”å¼CSSæ ·å¼
4. æ·»åŠ å›¾è¡¨åŠ¨ç”»æ•ˆæœ
5. ç¡®ä¿æ‰€æœ‰å†…è”æ ·å¼å®Œæ•´
"""

è¾“å‡º: å®Œæ•´çš„HTMLæ–‡æ¡£ï¼ˆ10000-15000å­—ï¼ŒåŒ…å«CSS/JSï¼‰

ä½œç”¨:
- å»é™¤ä¸‰ä¸ªæŠ¥å‘Šçš„å†—ä½™å’ŒçŸ›ç›¾
- ç»Ÿä¸€å™è¿°é£æ ¼å’Œé€»è¾‘ç»“æ„
- æ·»åŠ å¯è§†åŒ–å…ƒç´ å’Œä¸“ä¸šæ’ç‰ˆ
- ç”Ÿæˆå¯ç›´æ¥ä½¿ç”¨çš„æˆæœç‰©
```

---

## å››ã€æ•°æ®æµè½¬ä¸çŠ¶æ€ç®¡ç†

### 4.1 è·¨æ¨¡å—æ•°æ®æµ

```
ç”¨æˆ·æŸ¥è¯¢ â†’ Flaskåº”ç”¨ â†’ åˆ†å‘åˆ°ä¸‰ä¸ªAgent
    â†“
ä¸‰ä¸ªAgentå¹¶è¡Œå·¥ä½œ
    â”œâ”€ QueryEngine â†’ query_engine_streamlit_reports/report_xxx.md
    â”œâ”€ MediaEngine â†’ media_engine_streamlit_reports/report_xxx.md
    â””â”€ InsightEngine â†’ insight_engine_streamlit_reports/report_xxx.md
         â†“ (å®æ—¶å†™å…¥æ—¥å¿—)
    logs/query.log, logs/media.log, logs/insight.log
         â†“ (ForumEngineç›‘æ§)
    ForumEngine â†’ logs/forum.log
         â†“ (Agentè¯»å–)
    å„Agentçš„ReflectionNodeè¯»å–forum.log â†’ è°ƒæ•´æœç´¢ç­–ç•¥
         â†“ (å®Œæˆå)
    ReportEngineæ£€æµ‹æ–°æ–‡ä»¶ â†’ åŠ è½½ä¸‰ä»½æŠ¥å‘Š + forum.log
         â†“
    ç”ŸæˆHTML â†’ final_reports/final_report_xxx.html
```

### 4.2 StateçŠ¶æ€ç®¡ç†

**Agentçš„Stateå¯¹è±¡** (ä»¥QueryEngineä¸ºä¾‹)
```python
# QueryEngine/state/state.py

class State:
    query: str                  # åŸå§‹æŸ¥è¯¢
    report_title: str           # æŠ¥å‘Šæ ‡é¢˜
    paragraphs: List[Paragraph] # æ®µè½åˆ—è¡¨
    final_report: str           # æœ€ç»ˆæŠ¥å‘Šå†…å®¹
    status: str                 # completed/processing/error
    
    class Paragraph:
        title: str              # æ®µè½æ ‡é¢˜
        content: str            # æ®µè½è¦æ±‚
        research: ResearchData  # ç ”ç©¶æ•°æ®
        
        class ResearchData:
            search_history: List[SearchRecord]  # æœç´¢å†å²
            latest_summary: str                 # æœ€æ–°æ€»ç»“
            completed: bool
            
            class SearchRecord:
                search_query: str
                search_results: List[Dict]
                timestamp: datetime

çŠ¶æ€æ›´æ–°æ—¶æœº:
1. ç”ŸæˆæŠ¥å‘Šç»“æ„å â†’ æ›´æ–°paragraphs
2. æ¯æ¬¡æœç´¢å â†’ æ·»åŠ search_history
3. æ¯æ¬¡æ€»ç»“å â†’ æ›´æ–°latest_summary
4. æ®µè½å®Œæˆå â†’ æ ‡è®°completed=True
5. æœ€ç»ˆæŠ¥å‘Šç”Ÿæˆå â†’ æ›´æ–°final_report, status='completed'
```

### 4.3 æ–‡ä»¶ç³»ç»Ÿä½œä¸ºé€šä¿¡åª’ä»‹

ç³»ç»Ÿä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿå®ç°è·¨è¿›ç¨‹é€šä¿¡ï¼ˆè€Œéæ¶ˆæ¯é˜Ÿåˆ—æˆ–RPCï¼‰ï¼ŒåŸå› :
1. **ç®€å•å¯é **: é¿å…å¼•å…¥é¢å¤–çš„ä¸­é—´ä»¶ï¼ˆRedis/RabbitMQï¼‰
2. **å¯å®¡è®¡**: æ‰€æœ‰ä¸­é—´ç»“æœå¯è¿½æº¯ã€å¯æ£€æŸ¥
3. **å®¹é”™æ€§**: æŸä¸ªAgentå´©æºƒä¸å½±å“å…¶ä»–Agent
4. **å¯è§†åŒ–**: ç”¨æˆ·å¯å®æ—¶æŸ¥çœ‹å„Agentçš„è¿›åº¦

å…³é”®æ–‡ä»¶:
```
logs/
â”œâ”€ insight.log      # InsightEngineçš„æ§åˆ¶å°è¾“å‡ºï¼ˆå«SummaryNodeç»“æœï¼‰
â”œâ”€ media.log        # MediaEngineçš„æ§åˆ¶å°è¾“å‡º
â”œâ”€ query.log        # QueryEngineçš„æ§åˆ¶å°è¾“å‡º
â””â”€ forum.log        # ForumEngineç”Ÿæˆçš„è®ºå›å¯¹è¯è®°å½•

{engine}_streamlit_reports/
â””â”€ deep_search_report_xxx_{timestamp}.md  # å„Agentçš„æœ€ç»ˆæŠ¥å‘Š

final_reports/
â””â”€ final_report_xxx_{timestamp}.html  # ç»¼åˆHTMLæŠ¥å‘Š
```

---

## äº”ã€å…³é”®æŠ€æœ¯è¦ç‚¹

### 5.1 å¹¶è¡Œå¯åŠ¨æœºåˆ¶

**å®ç°æ–¹å¼**: å¤šè¿›ç¨‹ + å¼‚æ­¥ç›‘æ§
```python
# app.py:229-295
def initialize_system_components():
    # å¹¶è¡Œå¯åŠ¨ä¸‰ä¸ªStreamlitå­è¿›ç¨‹
    for app_name in ['insight', 'media', 'query']:
        process = subprocess.Popen(...)  # éé˜»å¡
        threading.Thread(target=read_process_output, daemon=True).start()
    
    # å¯åŠ¨ForumEngineåå°çº¿ç¨‹
    threading.Thread(target=monitor_logs, daemon=True).start()
```

ä¼˜åŠ¿:
- ä¸‰ä¸ªAgentå®Œå…¨ç‹¬ç«‹ï¼Œäº’ä¸å½±å“
- å•ä¸ªAgentå´©æºƒä¸ä¼šå¯¼è‡´ç³»ç»Ÿç˜«ç—ª
- èµ„æºåˆ©ç”¨ç‡é«˜ï¼ˆCPU/GPUå¯å¹¶è¡Œï¼‰

### 5.2 åæ€å¾ªç¯ (Reflection Loop)

**æ ¸å¿ƒæ€æƒ³**: è‡ªæˆ‘å®¡è§† + å¢é‡æ”¹è¿›

```python
for i in range(MAX_REFLECTIONS):  # é»˜è®¤3æ¬¡
    # 1. åæ€å½“å‰æ€»ç»“
    reflection = ReflectionNode.run(current_summary)
    
    # 2. æ ¹æ®åæ€ç»“æœæœç´¢æ–°ä¿¡æ¯
    new_results = search_tool(reflection['search_query'])
    
    # 3. èåˆæ–°ä¿¡æ¯ï¼Œæ›´æ–°æ€»ç»“
    updated_summary = ReflectionSummaryNode.run(
        old_summary=current_summary,
        new_info=new_results
    )
    
    current_summary = updated_summary
```

ç±»ä¼¼ç®—æ³•:
- **è¿­ä»£ä¼˜åŒ–**: ç±»ä¼¼æ¢¯åº¦ä¸‹é™ï¼Œé€æ­¥é€¼è¿‘æœ€ä¼˜è§£
- **ä¸»åŠ¨å­¦ä¹ **: è¯†åˆ«çŸ¥è¯†ç›²ç‚¹ï¼Œä¸»åŠ¨è·å–ä¿¡æ¯
- **å¤šè½®å¯¹è¯**: ç±»ä¼¼ChatGPTçš„å¤šè½®é—®ç­”æœºåˆ¶

æ•ˆæœ:
- åˆå§‹æ€»ç»“ï¼ˆ0è½®åæ€ï¼‰: è¦†ç›–ç‡60%ï¼Œæ·±åº¦â˜…â˜…
- 1è½®åæ€å: è¦†ç›–ç‡80%ï¼Œæ·±åº¦â˜…â˜…â˜…
- 3è½®åæ€å: è¦†ç›–ç‡95%ï¼Œæ·±åº¦â˜…â˜…â˜…â˜…

### 5.3 è®ºå›åä½œæœºåˆ¶

**åˆ›æ–°ç‚¹**: å¼•å…¥"è¾©è®ºä¸»æŒäºº"è§’è‰²

ä¼ ç»Ÿå¤šAgentç³»ç»Ÿé—®é¢˜:
- **ä¿¡æ¯å­¤å²›**: å„Agentç‹¬ç«‹å·¥ä½œï¼Œäº’ä¸çŸ¥æ™“
- **é‡å¤åŠ³åŠ¨**: å¯èƒ½æœç´¢ç›¸åŒæˆ–å†—ä½™çš„ä¿¡æ¯
- **è§†è§’å•ä¸€**: ç¼ºä¹è·¨è§†è§’çš„æ•´åˆ

è§£å†³æ–¹æ¡ˆ:
1. **å®æ—¶æ—¥å¿—ç›‘æ§**: ForumEngineç›‘æ§ä¸‰ä¸ªAgentçš„è¾“å‡º
2. **å‘¨æœŸæ€§æ€»ç»“**: æ¯5æ¡å‘è¨€è§¦å‘ä¸€æ¬¡ä¸»æŒäººä»‹å…¥
3. **å¼•å¯¼å¼åä½œ**: ä¸»æŒäººæå‡ºé—®é¢˜ï¼Œå¼•å¯¼åç»­ç ”ç©¶æ–¹å‘
4. **åé¦ˆé—­ç¯**: Agentè¯»å–ä¸»æŒäººå‘è¨€ï¼Œè°ƒæ•´ç­–ç•¥

å®é™…æ•ˆæœ:
```
ç¬¬1è½®Agentå‘è¨€:
- QUERY: æ‰¾åˆ°47æ¡æ–°é—»
- MEDIA: å‘ç°120ä¸‡æ¬¡å›¾ç‰‡ä¼ æ’­
- INSIGHT: æ•°æ®åº“æ˜¾ç¤ºçƒ­åº¦å¢é•¿340%

ç¬¬1æ¬¡ä¸»æŒäººä»‹å…¥:
"MEDIAçš„å›¾ç‰‡ä¼ æ’­é‡è¿œè¶…QUERYçš„æ–°é—»æ•°é‡ï¼Œè¯´æ˜è§†è§‰ä¼ æ’­æ˜¯ä¸»è¦é€”å¾„ã€‚
å»ºè®®INSIGHTåˆ†æå›¾ç‰‡ç±»è¯„è®ºçš„æƒ…æ„Ÿå€¾å‘ï¼ŒQUERYæœç´¢è§†è§‰ä¼ æ’­ç›¸å…³çš„æ·±åº¦æŠ¥é“ã€‚"

ç¬¬2è½®Agentå‘è¨€:
- INSIGHT: æŒ‰ä¸»æŒäººå»ºè®®ï¼Œåˆ†æå›¾ç‰‡ç±»è¯„è®ºï¼Œå‘ç°...
- QUERY: æœç´¢"æ¨±èŠ± ä¼ æ’­ ç¤¾äº¤åª’ä½“"ï¼Œæ‰¾åˆ°...
```

### 5.4 å…³é”®è¯ä¼˜åŒ–ä¸­é—´ä»¶

**é—®é¢˜**: ç”¨æˆ·æŸ¥è¯¢"æ­¦æ±‰å¤§å­¦" â†’ æ•°æ®åº“ä¸­å¯èƒ½å­˜å‚¨ä¸º"æ­¦å¤§""WHU""Wuhan University"

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨å°å‚æ•°LLMè¿›è¡Œå…³é”®è¯æ‰©å±•

```python
åŸå§‹æŸ¥è¯¢: "æ­¦æ±‰å¤§å­¦"
    â†“
keyword_optimizer (Qwen3-30B)
    â†“
ä¼˜åŒ–å: ["æ­¦æ±‰å¤§å­¦", "æ­¦å¤§", "WHU", "Wuhan University"]
    â†“
å¹¶è¡Œæœç´¢4ä¸ªå…³é”®è¯
    â†“
ç»“æœå»é‡åˆå¹¶
    â†“
å¬å›ç‡æå‡3-5å€
```

ä¸ºä»€ä¹ˆä¸ç”¨è§„åˆ™/è¯å…¸:
- **çµæ´»æ€§**: èƒ½ç†è§£ä¸Šä¸‹æ–‡ï¼ˆ"æ­¦å¤§"å¯èƒ½æ˜¯æ­¦æ±‰å¤§å­¦æˆ–æ­¦æ±‰å¤§å­¦äººæ°‘åŒ»é™¢ï¼‰
- **æ‰©å±•æ€§**: è‡ªåŠ¨å‘ç°æ–°çš„è¡¨è¿°æ–¹å¼
- **å¤šè¯­è¨€**: æ”¯æŒä¸­è‹±æ··åˆã€æ–¹è¨€ä¿šè¯­

### 5.5 å¤šè½®ç”Ÿæˆç­–ç•¥

**é—®é¢˜**: å•æ¬¡ç”Ÿæˆ15000å­—HTMLæŠ¥å‘Šå®¹æ˜“è¶…è¿‡LLMçš„tokené™åˆ¶

**è§£å†³æ–¹æ¡ˆ**: åˆ†æ®µç”Ÿæˆ + ä¸Šä¸‹æ–‡ä¼ é€’

```python
ç¬¬1è½®: ç”Ÿæˆæ ‡é¢˜+æ‘˜è¦+ç›®å½• (500 tokens)
    â†“ (ä¼ é€’ä¸Šä¸‹æ–‡)
ç¬¬2è½®: ç”Ÿæˆç¬¬ä¸€ç«  (1500 tokens)
    è¾“å…¥: ç¬¬1è½®ç»“æœ + ç›¸å…³èµ„æ–™
    â†“
ç¬¬3è½®: ç”Ÿæˆç¬¬äºŒç«  (1500 tokens)
    è¾“å…¥: ç¬¬1-2è½®ç»“æœæ‘˜è¦ + ç›¸å…³èµ„æ–™
    â†“
...
    â†“
ç¬¬Nè½®: ç”Ÿæˆç»“è®º + æ·»åŠ CSS (1000 tokens)
    è¾“å…¥: æ‰€æœ‰ç« èŠ‚æ‘˜è¦
```

ä¼˜åŠ¿:
- **çªç ´é™åˆ¶**: ç†è®ºä¸Šå¯ç”Ÿæˆæ— é™é•¿æŠ¥å‘Š
- **è´¨é‡ä¿è¯**: æ¯ä¸€æ®µéƒ½æœ‰å……åˆ†çš„ä¸Šä¸‹æ–‡
- **èµ„æºä¼˜åŒ–**: é¿å…ä¸€æ¬¡æ€§åŠ è½½æµ·é‡æ•°æ®

### 5.6 æƒ…æ„Ÿåˆ†æçš„å·¥ç¨‹åŒ–å®ç°

**æŒ‘æˆ˜**: å¯¹500æ¡è¯„è®ºè¿›è¡Œæƒ…æ„Ÿåˆ†æ

æœ´ç´ æ–¹æ¡ˆ:
```python
results = []
for comment in comments:  # 500æ¬¡å¾ªç¯
    result = model.predict(comment)  # å•æ¬¡æ¨ç†
    results.append(result)
# æ€»è€—æ—¶: 500 * 0.1ç§’ = 50ç§’
```

ä¼˜åŒ–æ–¹æ¡ˆ:
```python
# 1. æ‰¹é‡é¢„å¤„ç†
batches = split_into_batches(comments, batch_size=32)  # åˆ†æ‰¹

# 2. GPUæ‰¹é‡æ¨ç†
results = []
for batch in batches:  # 16æ¬¡å¾ªç¯
    batch_results = model.predict_batch(batch)  # æ‰¹é‡æ¨ç†
    results.extend(batch_results)
# æ€»è€—æ—¶: 16 * 0.5ç§’ = 8ç§’

# 3. åå¤„ç†
high_confidence = [r for r in results if r['confidence'] > 0.8]
# åªä¿ç•™é«˜ç½®ä¿¡åº¦ç»“æœï¼Œæé«˜å¯ä¿¡åº¦
```

æ€§èƒ½æå‡:
- é€Ÿåº¦: 50ç§’ â†’ 8ç§’ (6.25å€)
- å‡†ç¡®æ€§: é€šè¿‡ç½®ä¿¡åº¦ç­›é€‰ï¼Œä¿è¯è´¨é‡

---

## å…­ã€æ€»ç»“

### 6.1 ç³»ç»Ÿçš„æ ¸å¿ƒä¼˜åŠ¿

1. **å¤šæ™ºèƒ½ä½“åä½œ**: ä¸‰ä¸ªAgentä»ä¸åŒè§†è§’åˆ†æï¼Œå½¢æˆäº’è¡¥
2. **å¾ªç¯åæ€æœºåˆ¶**: è‡ªæˆ‘å®¡è§†ã€ä¸»åŠ¨è¡¥å……ï¼Œæå‡åˆ†ææ·±åº¦
3. **è®ºå›å¼•å¯¼**: æ‰“ç ´ä¿¡æ¯å­¤å²›ï¼Œå®ç°è·¨AgentçŸ¥è¯†èåˆ
4. **ä¸­é—´ä»¶å¢å¼º**: å…³é”®è¯ä¼˜åŒ–ã€æƒ…æ„Ÿåˆ†æç­‰å·¥å…·æå‡æ•°æ®è´¨é‡
5. **å¤šè½®ç”Ÿæˆ**: çªç ´LLMé™åˆ¶ï¼Œç”Ÿæˆé«˜è´¨é‡é•¿æ–‡æœ¬
6. **å¯å®¡è®¡æ€§**: æ‰€æœ‰ä¸­é—´ç»“æœå¯è¿½æº¯ã€å¯æ£€æŸ¥

### 6.2 AIåœ¨ç³»ç»Ÿä¸­çš„è§’è‰²åˆ†å·¥

| AIç±»å‹ | å…·ä½“æ¨¡å‹ | ä¸»è¦èŒè´£ | è°ƒç”¨é¢‘ç‡ |
|--------|---------|---------|---------|
| å¤§è¯­è¨€æ¨¡å‹ | Kimi/Gemini/DeepSeek | ç†è§£ã€åˆ†æã€ç”Ÿæˆæ–‡æœ¬ | æ¯ä¸ªæ®µè½10-15æ¬¡ |
| å°å‚æ•°æ¨¡å‹ | Qwen3-30B | å…³é”®è¯ä¼˜åŒ–ã€å¿«é€Ÿå†³ç­– | æ¯æ¬¡æœç´¢1æ¬¡ |
| åˆ¤åˆ«æ¨¡å‹ | å¤šè¯­è¨€BERT | æƒ…æ„Ÿåˆ†ç±» | æ‰¹é‡å¤„ç†ï¼ˆ500æ¡/æ¬¡ï¼‰ |
| å…ƒæ¨¡å‹ | Qwen3-235B | æ•´åˆå¤šAgentè§‚ç‚¹ã€å¼•å¯¼è®¨è®º | æ¯5æ¡å‘è¨€1æ¬¡ |

### 6.3 æ•°æ®æµæ€»ç»“

```
ç”¨æˆ·è¾“å…¥ (æŸ¥è¯¢)
    â†“
ä¸»åº”ç”¨åˆ†å‘
    â†“
ä¸‰ä¸ªAgentå¹¶è¡Œåˆ†æ (å„10-20æ¬¡LLMè°ƒç”¨)
    â”œâ”€ ç”Ÿæˆç»“æ„ (1æ¬¡)
    â”œâ”€ åˆå§‹æœç´¢+æ€»ç»“ (æ¯æ®µ2æ¬¡)
    â””â”€ åæ€å¾ªç¯ (æ¯æ®µ6-9æ¬¡)
    â†“
æ—¥å¿—è¾“å‡º
    â†“
ForumEngineç›‘æ§+ä¸»æŒäººä»‹å…¥ (2-3æ¬¡LLMè°ƒç”¨)
    â†“
Agentè¯»å–è®ºå› â†’ è°ƒæ•´ç­–ç•¥
    â†“
ç”Ÿæˆä¸‰ä»½ç‹¬ç«‹æŠ¥å‘Š
    â†“
ReportEngineæ•´åˆ (5-8æ¬¡LLMè°ƒç”¨)
    â”œâ”€ æ¨¡æ¿é€‰æ‹© (1æ¬¡)
    â””â”€ å¤šè½®HTMLç”Ÿæˆ (4-7æ¬¡)
    â†“
æœ€ç»ˆHTMLæŠ¥å‘Š
```

**æ€»è®¡**: ä¸€æ¬¡å®Œæ•´åˆ†æçº¦éœ€**50-80æ¬¡LLMè°ƒç”¨**ï¼Œè€—æ—¶**10-20åˆ†é’Ÿ**ï¼ˆå–å†³äºæœç´¢é€Ÿåº¦å’Œæ•°æ®é‡ï¼‰ã€‚

---

## é™„å½•ï¼šå…³é”®ä»£ç ä½ç½®ç´¢å¼•

| åŠŸèƒ½æ¨¡å— | æ–‡ä»¶è·¯å¾„ | å…³é”®å‡½æ•°/ç±» |
|---------|---------|-----------|
| ä¸»åº”ç”¨å…¥å£ | `app.py` | `initialize_system_components()`, `start_streamlit_app()` |
| é…ç½®ç®¡ç† | `config.py` | `Settings` (Pydanticæ¨¡å‹) |
| QueryEngine | `QueryEngine/agent.py` | `DeepSearchAgent.research()` |
| MediaEngine | `MediaEngine/agent.py` | `DeepSearchAgent.research()` |
| InsightEngine | `InsightEngine/agent.py` | `DeepSearchAgent.research()` |
| è®ºå›ç›‘æ§ | `ForumEngine/monitor.py` | `LogMonitor.monitor_logs()` |
| è®ºå›ä¸»æŒäºº | `ForumEngine/llm_host.py` | `ForumHost.generate_host_speech()` |
| æŠ¥å‘Šç”Ÿæˆ | `ReportEngine/agent.py` | `ReportAgent.generate_report()` |
| æ¨¡æ¿é€‰æ‹© | `ReportEngine/nodes/template_selection.py` | `TemplateSelectionNode.run()` |
| HTMLç”Ÿæˆ | `ReportEngine/nodes/html_generation.py` | `HTMLGenerationNode.run()` |
| å…³é”®è¯ä¼˜åŒ– | `InsightEngine/tools/keyword_optimizer.py` | `KeywordOptimizer.optimize_keywords()` |
| æƒ…æ„Ÿåˆ†æ | `InsightEngine/tools/sentiment_analyzer.py` | `SentimentAnalyzer.analyze_batch()` |
| Promptæ¨¡æ¿ | `{Engine}/prompts/prompts.py` | å„ç±»Promptå¸¸é‡ |
| çŠ¶æ€ç®¡ç† | `{Engine}/state/state.py` | `State`, `Paragraph`, `ResearchData` |

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**ç”Ÿæˆæ—¶é—´**: 2025-11-06  
**åˆ†ææ·±åº¦**: ä»£ç çº§å®Œæ•´è°ƒç”¨é“¾ + AIä½¿ç”¨è¯¦è§£
